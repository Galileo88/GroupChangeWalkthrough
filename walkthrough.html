<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Group Change Walkthrough Form</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // ============================================================
    // ICON COMPONENTS
    // ============================================================

    const ChevronRight = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
      </svg>
    );

    const ChevronLeft = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
      </svg>
    );

    const CheckCircle2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const Circle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" strokeWidth={2} />
      </svg>
    );

    const X = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
      </svg>
    );

    // ============================================================
    // MAIN FORM COMPONENT
    // ============================================================

    const WalkthroughForm = () => {

      // -------------------- State Variables --------------------
      const [currentPage, setCurrentPage] = useState(0);
      const [formData, setFormData] = useState({});
      const [showImageModal, setShowImageModal] = useState(false);
      const [showNextStepsModal, setShowNextStepsModal] = useState(false);
      const [outreachNotes, setOutreachNotes] = useState([]);
      const [showOutreachModal, setShowOutreachModal] = useState(false);
      const [currentOutreachReason, setCurrentOutreachReason] = useState('');
      const [showViewNotesModal, setShowViewNotesModal] = useState(false);
      const [enrolledProviders, setEnrolledProviders] = useState([]);
      const [showEnrolledProvidersModal, setShowEnrolledProvidersModal] = useState(false);
      const [providerManualNotes, setProviderManualNotes] = useState({});
      const [currentEnrollingProviderIndex, setCurrentEnrollingProviderIndex] = useState(null);
      const [currentAddingProviderIndex, setCurrentAddingProviderIndex] = useState(null);
      const [visitedPages, setVisitedPages] = useState(new Set([0]));
      const [unableToVerifyFields, setUnableToVerifyFields] = useState(new Set());
      const [pendingUnableToVerifyField, setPendingUnableToVerifyField] = useState(null);
      const [confirmDialog, setConfirmDialog] = useState({ show: false, message: '', onConfirm: null, onCancel: null });
      const [alertDialog, setAlertDialog] = useState({ show: false, message: '', onClose: null });

      // -------------------- Reference Images --------------------
      const groupPracticeAppImage = './images/groupchange_application.jpg';
      const question6Image = './images/question6.jpg';
      const paytoMailtoImage = './images/payto_mailto.jpg';
      const paytoMailtoCICSImage = './images/payto_mailto_CICS.png';
      const contactInfoImage = './images/contactinfo.jpg';
      const emailFieldImage = './images/emailfield.png';
      const practitionersImage = './images/practitioners.jpg';
      const questions21to24Image = './images/21_24.jpg';
      const createEnrollmentImage = './images/CreateEnrollment.png';
      const newProviderWindowImage = './images/newproviderwindow.png';
      const groupSpecialtyImage = './images/groupspecialty.png';
      const enrollmentTabImage = './images/enrollmenttab.png';
      const providerAddressImage = './images/provideraddress.png';
      const mailingAddressImage = './images/mailingaddress.png';
      const providerInfoTabImage = './images/providerinfotab.jpg';
      const npiTabImage = './images/npitab.png';
      const specTabImage = './images/spectab.png';
      const claimTabImage = './images/claimtab.png';
      const licenseDeaTabImage = './images/lictab.png';
      const mainframeImage = './images/mainframe.png';
      const cicsImage = './images/CICS.png';
      const addProvImage = './images/addprov.png';
      const enrollmentTaskImage = './images/enrollmenttask.png';
      const checklistImage = './images/checklist.png';
      const addToGroupImage = './images/addtogroup.png';
      const letterTaskImage = './images/lettertask.png';
      const letterSelectImage = './images/letterselect.png';
      const letterProvImage = './images/letterprov.png';
      const generateLetterImage = './images/generateletter.png';
      const closeLetterImage = './images/closeletter.png';

      // -------------------- Helper Functions --------------------

      // Custom confirmation dialog
      const showConfirm = (message) => {
        return new Promise((resolve) => {
          setConfirmDialog({
            show: true,
            message,
            onConfirm: () => {
              setConfirmDialog({ show: false, message: '', onConfirm: null, onCancel: null });
              resolve(true);
            },
            onCancel: () => {
              setConfirmDialog({ show: false, message: '', onConfirm: null, onCancel: null });
              resolve(false);
            }
          });
        });
      };

      // Custom alert dialog
      const showAlert = (message) => {
        return new Promise((resolve) => {
          setAlertDialog({
            show: true,
            message,
            onClose: () => {
              setAlertDialog({ show: false, message: '', onClose: null });
              resolve();
            }
          });
        });
      };

      // ============================================================
      // PAGES CONFIGURATION (44 Pages)
      // ============================================================
      // This section defines all the walkthrough pages and their
      // fields, validation rules, and conditional display logic.
      // ============================================================

      const pages = [
        // -------------------- Initial Setup Pages --------------------
        {
          id: 'welcome',
          title: 'Welcome',
          description: 'Let\'s get started with your walkthrough',
          fields: [
            {
              name: 'userName',
              label: 'Your Name',
              type: 'text',
              required: true,
              placeholder: 'Enter your full name',
              validation: (value) => value && value.length >= 2
            },
            {
              name: 'pwoNumber',
              label: 'PWO #',
              type: 'text',
              required: true,
              placeholder: 'Enter PWO number',
              validation: (value) => value && value.trim().length > 0
            }
          ]
        },
        {
          id: 'group-practice',
          title: 'Group Practice Application',
          description: 'Please confirm the application details',
          fields: [
            {
              name: 'groupPracticeAttached',
              label: 'Does the application have the Group Practice Application attached?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            },
            {
              name: 'questionsAnswered',
              label: 'Are questions 2, 4, 5 and 5C answered on the Group Change Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'groupPracticeAttached', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Questions 2, 4, 5, 5C are required to be answered. Compare the list from question 5 and 5C to CICS pg13.',
                'If the group is a non-profit, they will not have owners. They will have "controlling interests" and will have an ownership type of "C" on the ownership page in CICS. Controlling interests can be treated like managing employees and can be added at any time.',
                'If they are not a non-profit, and question 5 includes an owner that is not listed on the ownership file on pg13 in CICS, this may be a CHOW. Please let leadership know so they can advise you on next steps.',
                'Individuals list under question 5C should also be listed on the ownership file on pg13 in CICS. If an individual is not listed in CICS on pg13, we will add them with a status of "S" indicated they are managing staff.'
              ]
            }
          ]
        },
        {
          id: 'question-6',
          title: 'Practice Address Verification',
          description: 'Verify practice address information',
          fields: [
            {
              name: 'question6Answered',
              label: 'Is question 6 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Check the groups addresses to ensure this practice address exists. The 09 page in CICS shows a list of 8 practice addresses.',
                'If you cannot locate the address on the 09 page or in the event the 09 page is full, navigate to the notes page (F6) and look through the notes to see if the address can be found there.',
                'If not, you will add the new practice address to the notes screen.'
              ]
            }
          ]
        },
        {
          id: 'payto-mailto',
          title: 'Pay To / Mail To Address',
          description: 'Verify Pay To and Mail To address information',
          fields: [
            {
              name: 'paytoMailtoMatch',
              label: 'Does the pay-to and mail-to address on questions 7 and 8 in the Group Practice Application match what we have in CICS for the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            },
            {
              name: 'paytoMailtoComplete',			
              label: 'Complete: Update the mail-to and pay-to addresses in CICS to match the application.',
              type: 'checkbox',
              required: true,
              showWhen: { field: 'paytoMailtoMatch', value: 'No' },
              validation: (value) => value === true,
              helperNotes: [
                'Update the mail-to and pay-to addresses in CICS to match the application.',
                'From the 02 screen in CICS, hit F5 three times to reach the Pay To and Mail To addresses.'
              ]
            }
          ],
          displayImage: paytoMailtoImage
        },
        {
          id: 'questions-9-17',
          title: 'Additional Questions Verification',
          description: 'Verify required questions are answered',
          fields: [
            {
              name: 'questions9to17Answered',
              label: 'Are questions 9, 11, 12, 16 and 17 are answered?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            }
          ],
          pageNotes: [
            'If questions 10, 13, 14, 15, 18 or 19 are answered and are different than what we have in CICS, we can add or update the information.',
            'If these optional questions are blank, it is ok and does not stop us from moving forward.',
            'If the group answers 18 and 19 provides a CLIA# or a Mammography Cert#, they should include a copy of the certificates attached to the application. If they do not include a copy of certificate, we cannot add it to CICS until they do.'
          ],
          displayImage: contactInfoImage
        },
        {
          id: 'email-to-snow',
          title: 'Add contact E-Mail to SNOW',
          description: 'Add contact email information to SNOW',
          fields: [
            {
              name: 'emailAddedToSNOW',
              label: 'Add the contact email information to the email field in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          pageNotes: [
            'If no contact email is provided, you will need to manually send out the letter by placing it in the S-Drive at the end.'
          ],
          displayImage: emailFieldImage
        },
        {
          id: 'question-20',
          title: 'Provider Info Verification',
          description: 'Verify provider information from Question 20',
          fields: [
            {
              name: 'question20Answered',
              label: 'Is question 20 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Practitioner Name, SSN, NPI and DOB are required.',
                'There may be multiple providers the group is trying to add, and they will all be listed within question 20 in sections A-H. If there are more providers than what the application can fit, additional pages will be attached.'
              ]
            },
            {
              name: 'providerAlreadyEnrolled',
              label: 'Is the provider already enrolled?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'question20Answered', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, this will be noted for the provider and you will proceed to the next question.',
                'If No, the checklist will be displayed.'
              ]
            },
            {
              name: 'providerInGroup',
              label: 'Is the provider already in the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'providerAlreadyEnrolled', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, you will be given the option to reject this as a duplicate application.',
                'If No, this will be noted for the provider and the checklist will be displayed.'
              ]
            },
            {
              name: 'ssnVerified',
              label: 'SSN - Verify SSN using SOVOS if a Social Security Card is not attached to the application',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              sovosUrl: 'https://taxport.sovos.com/login'
            },
            {
              name: 'dexSanctionsCheck',
              label: 'DEX and Sanctions in WVT - Check all providers being added',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'dobVerified',
              label: 'DOB - Verify DOB in PECOS (new providers may not be in PECOS, so just use their DOB on the application)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'npiVerified',
              label: 'NPI - Verify in either the WVT or at npiregistry.cms.hhs.gov to ensure the NPI belongs to the provider',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              npiRegistryUrl: 'https://npiregistry.cms.hhs.gov'
            },
            {
              name: 'licensesVerified',
              label: 'Licenses and Board Certificates - APN, CRNA, CNM require RN license, APN license, and board certification',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'doctorLicenseVerified',
              label: 'Doctors are required to have a copy of their license (Board Certification is not required, but can be updated if included)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'deaEffectiveDates',
              label: 'DEA effective dates - Compare expiration dates and update if newer. Add DEA information for new providers if attached',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'effectiveDatesChecked',
              label: 'Effective Dates - If no Requested Effective Date is provided, effective date goes one year back from stamped date (as long as license covers it)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            }
          ]
        },
        // -------------------- Completion & Special Pages --------------------
        {
          id: 'question-20-unable-to-verify-completion',
          title: 'UNABLE TO VERIFY - OUTREACH REQUIRED',
          description: 'Providers with unverifiable items require outreach',
          instructionText: 'You have finished processing all providers in this application. Some providers have items that could not be verified and require outreach.\n\nPlease download your notes to review all providers and the items requiring verification, then reach out to gather the missing information.\n\nOnce you have the required information, you can start a new application to complete the enrollment process.',
          isCompletionPage: true,
          fields: []
        },
        {
          id: 'duplicate-rejection-completion',
          title: 'APPLICATION REJECTED',
          description: 'Duplicate provider application rejected',
          instructionText: 'Application rejected as duplicate. The rejection has been added to the notes.\n\nYou can now:\n- Download the notes using the button below\n- Start a new application for another provider',
          isCompletionPage: true,
          isDuplicateRejection: true,
          fields: []
        },
        // -------------------- Additional Verification Pages --------------------
        {
          id: 'questions-21-23',
          title: 'Additional Questions (21-23) Verification',
          description: 'Verify questions 21, 22 and 23 are answered correctly',
          fields: [
            {
              name: 'question21Answered',
              label: 'Are questions 21 a-e completed and further explained if necessary on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Questions 21 a-e must be completed and further explained, if necessary.',
                'If a question is answered "yes" and includes further explanation, it could be an Adverse Action situation and will need to be forwarded to the state. Please reach out to leadership to determine next steps.'
              ]
            },
            {
              name: 'question22Answered',
              label: 'Is question 22 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Question 22 needs to be answered.',
                'If "Yes" is selected, an explanation is required.',
                'If they are currently employed, a list of hours and days of employment is needed.'
              ]
            },
            {
              name: 'question23Answered',
              label: 'Is question 23 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Question 23 needs to be answered.',
                'If "Yes" is selected, an explanation is required.'
              ]
            }
          ]
        },
        // -------------------- Provider Type Selection --------------------
        {
          id: 'provider-type-selection',
          title: 'Provider Enrollment Type',
          description: (formData) => {
            const isAlreadyEnrolled =
              formData.nextProviderAlreadyEnrolled === 'Yes' ||
              formData.finalProviderAlreadyEnrolled === 'Yes' ||
              formData.providerAlreadyEnrolled === 'Yes';

            const providerType = isAlreadyEnrolled ? 'Existing Provider' : 'New Provider';
            return `Based on previous answers, you are adding a${providerType === 'New Provider' ? '' : 'n'} ${providerType}`;
          },
          fields: [
            {
              name: 'providerEnrollmentType',
              label: (formData) => {
                const isAlreadyEnrolled =
                  formData.nextProviderAlreadyEnrolled === 'Yes' ||
                  formData.finalProviderAlreadyEnrolled === 'Yes' ||
                  formData.providerAlreadyEnrolled === 'Yes';

                const providerType = isAlreadyEnrolled ? 'Existing Provider' : 'New Provider';
                return `Based on previous answers, you are adding a${providerType === 'New Provider' ? '' : 'n'} ${providerType}`;
              },
              type: 'radio',
              required: true,
              options: (formData) => {
                const isAlreadyEnrolled =
                  formData.nextProviderAlreadyEnrolled === 'Yes' ||
                  formData.finalProviderAlreadyEnrolled === 'Yes' ||
                  formData.providerAlreadyEnrolled === 'Yes';

                return isAlreadyEnrolled ? ['Existing Provider'] : ['New Provider'];
              },
              validation: (value) => value === 'New Provider' || value === 'Existing Provider'
            }
          ]
        },
        // ================== EXISTING PROVIDER WORKFLOW ==================
        // These pages handle adding an already-enrolled provider to a group
        {
          id: 'existing-provider-open-cics',
          title: 'OPEN CICS',
          description: 'Access the provider in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderOpenCicsComplete',
              label: 'Complete: Access the provider in CICS.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'In CICS, set the OPTION # to 12, the TRANS. TYPE to "U" and enter the groups provider number and press enter.',
          displayImage: cicsImage
        },
        {
          id: 'existing-provider-add-to-group',
          title: 'ADDING A PROVIDER TO THE GROUP',
          description: 'Add the provider to the group in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderAddToGroupComplete',
              label: 'Complete: Add the provider to the group in CICS.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'You will see list of all of the individual providers in the group.\n\nOne the first line, you will add a letter "A" to let CICS know you intend to Add a provider to this group.\n\nNext, tab over to the provider number and overwrite it with the new provider number that was just generated. (don\'t worry, you are not overwriting an existing provider).\n\nNext, tab over to the BEGIN DATE, and enter the begin date for the new provider.\nYou can get the BEGIN DATE by looking at Eligibility Begin in the Provider Information tab in SNOW.\n\nFinally, tab over to the END DATE and add 12319999 as the end date. If the date is already 12319999, you can leave it.\n\nOnce you hit ENTER, the provider will be added to the group.\n\nYou can check to see if the provider was successfully added by searching for their provider number where it says "NEXT MEMBER" and hitting enter. This will show you the provider you just added.\n\nAdditionally, check the notes page F6 to make sure a note was added stating you added the provider to the group.\n\nYou will do this for each provider you are adding',
          displayImage: addProvImage
        },
        {
          id: 'existing-provider-verify-info',
          title: 'VERIFYING PROVIDER INFO IS CORRECT',
          description: 'Verify all provider information in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          pageNotes: [
            'Board Certification Indicators:',
            'APN, CRNA, CNM will always remain a 0',
            'Doctors, and PA\'s will get a 1 if they provided a board eligibility letter',
            'Doctors, and PA\'s will get a 2 if they provided a board certificate',
            'Otherwise they will remain a 0'
          ],
          fields: [
            {
              name: 'providerNameFormatting02',
              label: 'Check the formatting of the providers name on 02 page',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'mailToPayToAddresses',
              label: 'Update the Mail To and Pay To addresses, and make sure the providers name is also formatted correctly there as well',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'cancelCodes',
              label: 'Check Cancel codes',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'effectiveDates',
              label: 'Check the effective dates for the DEA, Licenses, Specialties, Claim Types',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'boardCertificationIndicators',
              label: 'Check Board Certification Indicators',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'programCode54PA',
              label: 'Program Code 54 for PA on 04 page',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ]
        },
        {
          id: 'existing-provider-close-enrollment',
          title: 'CLOSING THE ENROLLMENT TASK',
          description: 'Close the enrollment task in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCloseEnrollmentComplete',
              label: 'Complete: Close the enrollment task in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'In the Enrollment work object, once you refresh the screen, you should see an Enrollment Task titled "Verify CICS".\n\nClick the PWT number and close the task. Work notes can state that you are just "closing to task".\n\nThis will close the enrollment.\n\nNavigate back to the Group Change work object.',
          displayImage: enrollmentTaskImage
        },
        {
          id: 'existing-provider-finish-group-change',
          title: 'FINISHING UP THE GROUP CHANGE',
          description: 'Complete the group change process in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderFinishGroupChangeComplete',
              label: 'Complete: Input the email address into the email field in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in the Group Change work object, Open the application, and find question 17 in the Group Practice Application to find the email address for the group.\n\nInput that email address into the email field in SNOW.',
          displayImage: emailFieldImage
        },
        {
          id: 'existing-provider-create-checklist',
          title: 'CREATE A CHECKLIST',
          description: 'Add verification checklist in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCreateChecklistComplete',
              label: 'Complete: Add verification checklist in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Add a checklist and check off everything that you verified.\n\nIf you did not use part of the checklist, do not mark it off. Only mark off what was verified.',
          displayImage: checklistImage
        },
        {
          id: 'existing-provider-approve-group-change',
          title: 'APPROVING THE GROUP CHANGE',
          description: 'Approve the group change in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderApproveGroupChangeComplete',
              label: 'Complete: Approve the group change in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Click one the approve button and make a comment stating the provider(s) has been added to the group.\n\nClick Approve.',
          displayImage: addToGroupImage
        },
        {
          id: 'existing-provider-open-letter-task',
          title: 'OPENING THE LETTER TASK',
          description: 'Navigate to the letter task in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderOpenLetterTaskComplete',
              label: 'Complete: Navigate to the letter task in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once you have clicked approve, a new task will generate in the Group Change Task tab.\n\nClick the PWT number to go to the letter task.',
          displayImage: letterTaskImage
        },
        {
          id: 'existing-provider-select-letter',
          title: 'SELECTING THE LETTER',
          description: 'Select the group change letter and enter effective date',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderSelectLetterComplete',
              label: 'Complete: Select the group change letter and enter effective date.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once in the letter task, click on the blue Select Letter button and select GroupChangeAdd\n\nAlso enter the effective date that was given to the provider.',
          displayImage: letterSelectImage
        },
        {
          id: 'existing-provider-add-to-letter',
          title: 'ADDING THE PROVIDER TO THE LETTER',
          description: 'Add provider details to the letter',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderAddToLetterComplete',
              label: 'Complete: Add provider details to the letter.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Near the bottom of the letter task, click on the blue "New" button.\n\nIn the Provider field, enter the provider number of the individual we just added to the group.\n\nIn the Effective Date field, enter the effective date given to the provider.\n\nHit Submit.\n\nYou will do this for each provider you added to the group.',
          displayImage: letterProvImage
        },
        {
          id: 'existing-provider-finish-letter',
          title: 'FINISHING THE LETTER',
          description: 'Create, verify, and save the approval letter',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderFinishLetterComplete',
              label: 'Complete: Create, verify, and save the approval letter.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'IMPORTANT: Before creating the letter, verify the address matches the groups Mail To address on CICS. From the 02 screen in CICS, hit F5 3 times to view the Mail To address.\n\nOnce the letter has been selected, the effective date entered, and the provider(s) are added to the letter, click on the "Create Letter" button at the top right.\n\nThis will create an approval letter, and it will be attached to the top of the page.\n\nOpen the letter by clicking "view" next to the attached letter and verify that all the information on the letter is correct.\n\nDownload the letter by clicking directly on the letter attachment.\nIn your Downloads folder, locate the letter and rename it to the following format:\n\nGroupChangeAdd_GroupName_ICN#_Date\n\nExample:\nGroupChangeAdd_CMC DEPT OF MEDICINE GRP_24226304109_2024-08-20\n\nOnce renamed place the letter into the SDRIVE folder:\n\\\\192.60.36.175\\shared\\Provider Services\\Enrollment\\2-PE Letters',
          displayImage: generateLetterImage
        },
        {
          id: 'existing-provider-close-letter-task',
          title: 'CLOSING THE LETTER TASK',
          description: 'Close the letter task and complete the group change',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCloseLetterTaskComplete',
              label: 'Complete: Close the letter task and complete the group change.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Add a work note stating you have "Generated the approval letter"\n\nChange the Group Change Task State to Closed\n\nClick on the "Save" button\n\nThis will close the letter task and the Group Change work object all at one.',
          displayImage: closeLetterImage
        },
        {
          id: 'existing-provider-completion',
          title: 'Provider Added to Group',
          description: 'Check if there are more providers to add to the group',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'additionalExistingProvidersNeeded',
              label: 'Are there additional providers that need to be added to the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            }
          ],
          instructionText: 'If you have more providers to add to this group, select "Yes" to continue adding another provider. The current provider information will be saved.\n\nIf you have finished adding all providers to the group, select "No" to complete the walkthrough.',
          isCompletionPage: false
        },
        {
          id: 'final-completion',
          title: 'Walkthrough Complete!',
          description: 'ALL PROVIDERS HAVE BEEN ENROLLED AND ADDED TO THE GROUP',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [],
          instructionText: 'Congratulations! You have successfully completed the group change walkthrough.\n\nAll providers have been enrolled and added to the group.\n\nYou can now:\n- Download your notes and answers\n- Start a new application',
          isCompletionPage: true
        },
        // ================== NEW PROVIDER WORKFLOW ==================
        // These pages handle enrolling a new provider into CICS
        {
          id: 'create-enrollment',
          title: 'Create Enrollment in SNOW',
          description: 'Begin the new provider enrollment process',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'createEnrollmentComplete',
              label: 'Complete: Clicked the "Create Enrollment" button in SNOW',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Begin enrolling a new provider by clicking on the blue "Create Enrollment" button within your work object in SNOW.',
          noteText: 'NOTE: You will do this for each new provider that needs to be enrolled into CICS, but do it one at a time to avoid making a mistake.',
          displayImage: createEnrollmentImage
        },
        {
          id: 'fill-provider-info',
          title: 'Fill in Provider Information',
          description: 'Enter the provider details in the enrollment window',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerInfoComplete',
              label: 'Complete: Filled in the provider information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Fill in the information for the individual provider you are enrolling into the window that pops up.',
          nameFormatNote: 'When entering the providers name, it should be in all CAPS and the format should be LAST FIRST MI and the professional title. ex: SMITH JOHN J. MD',
          displayImage: newProviderWindowImage,
          resourceText: 'Be sure to check the individual providers license and utilize the links below to help determine the provider type and specialty:',
          resources: [
            { label: '2025 Legal Quick Guide', url: './2025LegalQuickGuide.pdf', type: 'pdf' },
            { label: 'Provider Types and Specialties', url: './ProviderTypesSpecialties.pdf', type: 'pdf' }
          ]
        },
        {
          id: 'check-group-specialties',
          title: 'Check Group Specialties',
          description: 'Verify the group can accept the provider specialty',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'groupSpecialtiesChecked',
              label: 'Complete: Verified the group specialties',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in CICS, under the group, be sure to check what kind of specialties the group can take. From the 02 page in CICS, press F5 and take a look at the specialties that are already added to the group. If you do not see the providers specialty, check to see if the specialty is covered under another specialty, e.g. 420, 110, 750 etc.\n\nIf necessary, add the specialty to the group. The specialty will get the same effective date as the provider you are adding.',
          displayImage: groupSpecialtyImage,
          pageNotes: [
            'If you are still unsure, please reach out in the chat, or to leadership so that you can get the answer you need.'
          ]
        },
        {
          id: 'enrollment-applications-tab',
          title: 'Enrollment Applications Tab',
          description: 'Navigate to the Enrollment Applications tab in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'enrollmentTabComplete',
              label: 'Complete: Navigate to the enrollment application you just created',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in SNOW, navigate to the bottom of the PWO and locate the "Enrollment Applications" tab.\n\nYou will see a new Enrollment Application associated with the provider information you just entered.\n\nClick on the PWO to take you to the enrollment application.',
          displayImage: enrollmentTabImage
        },
        {
          id: 'verify-enrollment-application',
          title: 'Verify Enrollment Application',
          description: 'Verify and complete the enrollment application information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerNameCorrect',
              label: 'Complete: Check the provider\'s name is correct',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'providerTypeCorrect',
              label: 'Complete: Check the provider type is correct',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'applicationDateAdded',
              label: 'Complete: Add the Application Date -- This is the stamped date on the application',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'cancelReasonCode',
              label: 'Complete: Cancel Reason Code should remain 00',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once you are in the Enrollment Application, check the name, provider type, application date and cancel reason code to ensure you entered the providers data correctly.'
        },
        {
          id: 'provider-address-tab',
          title: 'Provider Address Tab',
          description: 'Enter the provider address information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerAddressComplete',
              label: 'Complete: Enter the provider address information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The street address will be the practice address found on question 6 of the Group Practice Application.\n\nThe phone number, and fax number can be found on questions 11 and 14 in the Group Practice Application',
          displayImage: providerAddressImage
        },
        {
          id: 'payment-mailing-address-tab',
          title: 'Payment Address and Mailing Address Tab',
          description: 'Review payment and mailing address settings',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'paymentMailingAddressComplete',
              label: 'Complete: Review payment and mailing address settings',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'By default these inherit the street address from the Provider Address tab. These do not need to be changed in SNOW, but will need to be updated in CICS once the provider is added to the group.',
          displayImage: mailingAddressImage
        },
        {
          id: 'provider-information-tab',
          title: 'Provider Information Tab',
          description: 'Set eligibility dates and Medicare information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerInfoTabComplete',
              label: 'Complete: Set eligibility dates and Medicare information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The Eligibility Begin date will be the Requested Effective Date on question 20 of the Group Practice Application.\n\nA Requested Effective Date might not be provided. If that is the case, The effective date will go one year back from the stamped date as long as the license can cover it.\n\nIf the Requested Effective Date is further than a year back, we will go back 1 year from the stamped date on the application, as long as the individual providers license covers that far back. If the license does not cover that far back, you can only go as far back as the issue date of the license.\n\nThe Eligibility End date will remain blank.\n\nIf the provider has a Medicare Number, you can enter it in the Medicare Number field.',
          displayImage: providerInfoTabImage
        },
        {
          id: 'npi-tab',
          title: 'NPI Tab',
          description: 'Verify or enter the NPI number',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'npiTabComplete',
              label: 'Complete: Verify or enter the NPI number',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The NPI number for the individual provider should already be populated into this tab. If it is not, you will enter it here.',
          displayImage: npiTabImage
        },
        {
          id: 'specialty-tab',
          title: 'Specialty Tab',
          description: 'Set specialty dates for the provider',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'specialtyTabComplete',
              label: 'Complete: Set specialty and specialty effective dates for the provider',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'This is a good time to triple check the specialty.\n\nSpecialty 1 Begin Date will be the same as the Eligibility Begin date as on the Provider Information tab.\n\nFor NURSES, Specialty 1 End Date will be the date their Board Certificate expires\n\nFor DOCTORS & PAs, Specialty 1 End Date will remain blank',
          displayImage: specTabImage
        },
        {
          id: 'claim-type-tab',
          title: 'Claim Type Tab',
          description: 'Set claim types for the provider',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'claimTypeTabComplete',
              label: 'Complete: Set claim types for the provider',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Claim Types can be determined by using the resource below.',
          resourceText: 'Use this resource to determine claim types:',
          resources: [
            { label: 'Provider Types and Specialties', url: './ProviderTypesSpecialties.pdf', type: 'pdf' }
          ],
          displayImage: claimTabImage,
          pageNotes: [
            'Example: A Provider Type 70 with a Specialty of 190 will get Claim Types 13, 15, 22',
            'Claim Type 1 Begin Date will be the same as the Eligibility Begin date as on the Provider Information tab.',
            'Claim Type 1 End Date will remain blank.',
            'NOTE: Not all specialties have 3 claim types like this example. Some will have 1 and some will have 2. The begin dates for each claim type will be the same date.'
          ]
        },
        {
          id: 'license-dea-tab',
          title: 'License and DEA Tab',
          description: 'Enter license and DEA information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'licenseDeaTabComplete',
              label: 'Complete: Enter license and DEA information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'License information can be pulled from the license provided in the application, or from the verification site. If the license is not in the application, and you have not obtained a screenshot of the license from the verification site, do so now.',
          resourceText: 'Use this resource to verify license:',
          resources: [
            { label: 'Verify License', url: 'https://miamifrp.com/verification/', type: 'link' }
          ],
          displayImage: licenseDeaTabImage,
          pageNotes: [
            'Input the License Number along with the License Effective Date and License Expiration Date.',
            'The License Effective Date is the issue date of the license',
            'The License Expiration Date is the Expiration Date of the License',
            'The DEA Number is listed on question 20 of the Group Practice Application but should also be attached to the application. If not, DEA can be validated using DEA lookup in the West Virginia Tool. Take a screenshot of the validated DEA and attach it to the work object.',
            'DEA Effective Date is the issue date of the DEA',
            'DEA End Date is the expiration date of the DEA'
          ]
        },
        {
          id: 'enroll-on-mainframe',
          title: 'Enrolling on Mainframe',
          description: 'Complete the enrollment process on the mainframe',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'enrollOnMainframeComplete',
              label: 'Complete: Complete the enrollment process on the mainframe',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once all of the information has been filled out accurately, click "Save" at the top of the screen and then you can proceed to click on "Enroll On Mainframe".\n\nThis may take a moment to process, but eventually you should see a blue banner stating "PROVIDER XXXXXXX SUCCESSFULLY ADDED"\n\nThe provider now has a provider ID.',
          displayImage: mainframeImage
        },
        {
          id: 'additional-providers-check',
          title: 'Additional Provider Enrollment',
          description: 'Check if there are more providers to enroll',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'additionalProvidersNeeded',
              label: 'Are there additional providers that need to be enrolled?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            }
          ],
          instructionText: 'If you have more providers to enroll for this group change, select "Yes" to continue enrolling another provider. Your previous enrollment information will be saved.\n\nIf you have finished enrolling all providers, select "No" to continue to the next step.'
        },
        {
          id: 'next-provider-ready-check',
          title: 'Final Provider Verification',
          description: 'Last chance to verify all provider information before enrollment',
          showWhen: { field: 'additionalProvidersNeeded', value: 'Yes' },
          fields: [
            {
              name: 'nextProviderFinalVerificationConfirm',
              label: 'Is question 20 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Practitioner Name, SSN, NPI and DOB are required.',
                'There may be multiple providers the group is trying to add, and they will all be listed within question 20 in sections A-H. If there are more providers than what the application can fit, additional pages will be attached.'
              ]
            },
            {
              name: 'nextProviderAlreadyEnrolled',
              label: 'Is the provider already enrolled?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'nextProviderFinalVerificationConfirm', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, this will be noted for the provider and you will proceed to the next question.',
                'If No, the checklist will be displayed.'
              ]
            },
            {
              name: 'nextProviderInGroup',
              label: 'Is the provider already in the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'nextProviderAlreadyEnrolled', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, you will be given the option to reject this as a duplicate application.',
                'If No, this will be noted for the provider and the checklist will be displayed.'
              ]
            },
            {
              name: 'nextProviderFinalSsnVerified',
              label: 'SSN - Verify SSN using SOVOS if a Social Security Card is not attached to the application',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              sovosUrl: 'https://taxport.sovos.com/login'
            },
            {
              name: 'nextProviderFinalDexSanctionsCheck',
              label: 'DEX and Sanctions in WVT - Check all providers being added',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalDobVerified',
              label: 'DOB - Verify DOB in PECOS (new providers may not be in PECOS, so just use their DOB on the application)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalNpiVerified',
              label: 'NPI - Verify in either the WVT or at npiregistry.cms.hhs.gov to ensure the NPI belongs to the provider',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              npiRegistryUrl: 'https://npiregistry.cms.hhs.gov'
            },
            {
              name: 'nextProviderFinalLicensesVerified',
              label: 'Licenses and Board Certificates - APN, CRNA, CNM require RN license, APN license, and board certification',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalDoctorLicenseVerified',
              label: 'Doctors are required to have a copy of their license (Board Certification is not required, but can be updated if included)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalDeaEffectiveDates',
              label: 'DEA effective dates - Compare expiration dates and update if newer. Add DEA information for new providers if attached',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalEffectiveDatesChecked',
              label: 'Effective Dates - If no Requested Effective Date is provided, effective date goes one year back from stamped date (as long as license covers it)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            }
          ]
        }
      ];

      // ============================================================
      // VALIDATION & PAGE LOGIC
      // ============================================================

      // Check if current page requirements are met
      const isPageValid = () => {
        const page = pages[currentPage];
        return page.fields.every(field => {
          if (field.showWhen) {
            let conditionMet;
            if (typeof field.showWhen === 'function') {
              conditionMet = field.showWhen(formData);
            } else {
              conditionMet = formData[field.showWhen.field] === field.showWhen.value;
            }
            if (!conditionMet) return true;
          }
          if (!field.required) return true;

          if (unableToVerifyFields.has(field.name)) return true;

          const value = formData[field.name];
          return field.validation ? field.validation(value) : !!value;
        });
      };

      const handleFieldChange = (fieldName, value) => {
        setFormData(prev => ({ ...prev, [fieldName]: value }));

        const enrollmentFields = [
          'createEnrollmentComplete',
          'providerInfoComplete',
          'groupSpecialtiesChecked',
          'enrollmentTabComplete',
          'providerNameCorrect',
          'providerTypeCorrect',
          'applicationDateAdded',
          'cancelReasonCode',
          'providerAddressComplete',
          'paymentMailingAddressComplete',
          'providerInfoTabComplete',
          'npiTabComplete',
          'specialtyTabComplete',
          'claimTypeTabComplete',
          'licenseDeaTabComplete',
          'enrollOnMainframeComplete'
        ];

        if (currentEnrollingProviderIndex !== null && enrollmentFields.includes(fieldName)) {
          setEnrolledProviders(prev => {
            const updated = [...prev];
            if (updated[currentEnrollingProviderIndex]) {
              updated[currentEnrollingProviderIndex] = {
                ...updated[currentEnrollingProviderIndex],
                [fieldName]: value
              };
              console.log(`Updated enrollment detail for provider ${currentEnrollingProviderIndex + 1}: ${fieldName} = ${value}`);
            }
            return updated;
          });
        }
      };

      const shouldShowPage = (pageIndex) => {
        const page = pages[pageIndex];
        if (!page.showWhen) return true;
        return formData[page.showWhen.field] === page.showWhen.value;
      };

      // ============================================================
      // EVENT HANDLERS
      // ============================================================

      // Handle navigation to next page with complex routing logic
      const handleNext = async () => {
        const currentPageData = pages[currentPage];

        if (currentPageData.id === 'question-20') {
          const moreProviders = await showConfirm('Are there more providers to verify in this application?');

          const question20VerifyFields = ['ssnVerified', 'dexSanctionsCheck', 'dobVerified', 'npiVerified', 'licensesVerified', 'doctorLicenseVerified'];
          const hasUnableToVerify = question20VerifyFields.some(field => unableToVerifyFields.has(field));

          if (hasUnableToVerify) {
            const providerData = {
              status: 'Unable to Verify - Requires Outreach',
              question20Answered: formData.question20Answered,
              providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
              providerInGroup: formData.providerInGroup,
              ssnVerified: formData.ssnVerified,
              dexSanctionsCheck: formData.dexSanctionsCheck,
              dobVerified: formData.dobVerified,
              npiVerified: formData.npiVerified,
              licensesVerified: formData.licensesVerified,
              doctorLicenseVerified: formData.doctorLicenseVerified,
              deaEffectiveDates: formData.deaEffectiveDates,
              effectiveDatesChecked: formData.effectiveDatesChecked,
              outreachNotes: [...outreachNotes]
            };

            setEnrolledProviders(prev => {
              const updatedProviders = [...prev, providerData];
              console.log(`Provider with unable-to-verify items saved. Total providers: ${updatedProviders.length}`);
              return updatedProviders;
            });
          } else if (moreProviders) {
            let providerStatus = 'Verified - Ready to Enroll';
            if (formData.providerAlreadyEnrolled === 'Yes') {
              if (formData.providerInGroup === 'Yes') {
                providerStatus = 'Verified - Already in the Group';
              } else {
                providerStatus = 'Verified - Ready to Add to Group';
              }
            }

            const providerData = {
              status: providerStatus,
              question20Answered: formData.question20Answered,
              providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
              providerInGroup: formData.providerInGroup,
              ssnVerified: formData.ssnVerified,
              dexSanctionsCheck: formData.dexSanctionsCheck,
              dobVerified: formData.dobVerified,
              npiVerified: formData.npiVerified,
              licensesVerified: formData.licensesVerified,
              doctorLicenseVerified: formData.doctorLicenseVerified,
              deaEffectiveDates: formData.deaEffectiveDates,
              effectiveDatesChecked: formData.effectiveDatesChecked,
              outreachNotes: [...outreachNotes]
            };

            setEnrolledProviders(prev => {
              const updatedProviders = [...prev, providerData];
              console.log(`Fully verified provider saved. Total providers: ${updatedProviders.length}`);
              return updatedProviders;
            });
          }

          if (moreProviders) {
            const clearedData = { ...formData };
            delete clearedData.question20Answered;
            delete clearedData.providerAlreadyEnrolled;
            delete clearedData.providerInGroup;
            delete clearedData.ssnVerified;
            delete clearedData.dexSanctionsCheck;
            delete clearedData.dobVerified;
            delete clearedData.npiVerified;
            delete clearedData.licensesVerified;
            delete clearedData.doctorLicenseVerified;
            delete clearedData.deaEffectiveDates;
            delete clearedData.effectiveDatesChecked;

            clearedData.expectedProviderCount = enrolledProviders.length + 1;

            setFormData(clearedData);

            setUnableToVerifyFields(prev => {
              const newSet = new Set(prev);
              question20VerifyFields.forEach(field => newSet.delete(field));
              return newSet;
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });

            return;
          } else {
            if (hasUnableToVerify) {
              const providerData = {
                status: 'Unable to Verify - Requires Outreach',
                question20Answered: formData.question20Answered,
                providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                providerInGroup: formData.providerInGroup,
                ssnVerified: formData.ssnVerified,
                dexSanctionsCheck: formData.dexSanctionsCheck,
                dobVerified: formData.dobVerified,
                npiVerified: formData.npiVerified,
                licensesVerified: formData.licensesVerified,
                doctorLicenseVerified: formData.doctorLicenseVerified,
                deaEffectiveDates: formData.deaEffectiveDates,
                effectiveDatesChecked: formData.effectiveDatesChecked,
                outreachNotes: [...outreachNotes]
              };

              setEnrolledProviders(prev => {
                const updatedProviders = [...prev, providerData];
                console.log(`Final provider with unable-to-verify items saved. Total providers: ${updatedProviders.length}`);
                return updatedProviders;
              });

              const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
              if (completionIndex !== -1) {
                setCurrentPage(completionIndex);
                setVisitedPages(prev => new Set([...prev, completionIndex]));
              }
              return;
            } else {
              let providerStatus = 'Verified - Ready to Enroll';
              if (formData.providerAlreadyEnrolled === 'Yes') {
                if (formData.providerInGroup === 'Yes') {
                  providerStatus = 'Verified - Already in the Group';
                } else {
                  providerStatus = 'Verified - Ready to Add to Group';
                }
              }

              const providerData = {
                status: providerStatus,
                question20Answered: formData.question20Answered,
                providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                providerInGroup: formData.providerInGroup,
                ssnVerified: formData.ssnVerified,
                dexSanctionsCheck: formData.dexSanctionsCheck,
                dobVerified: formData.dobVerified,
                npiVerified: formData.npiVerified,
                licensesVerified: formData.licensesVerified,
                doctorLicenseVerified: formData.doctorLicenseVerified,
                deaEffectiveDates: formData.deaEffectiveDates,
                effectiveDatesChecked: formData.effectiveDatesChecked,
                outreachNotes: [...outreachNotes]
              };

              setEnrolledProviders(prev => {
                const updatedProviders = [...prev, providerData];
                console.log(`Final verified provider saved. Total providers: ${updatedProviders.length}`);

                const needsEnrollment = updatedProviders.some(p =>
                  p.status === 'Verified - Ready to Enroll' &&
                  p.providerAlreadyEnrolled === 'No'
                );

                if (needsEnrollment) {
                  const firstReadyIndex = updatedProviders.findIndex(p =>
                    p.status === 'Verified - Ready to Enroll' &&
                    p.providerAlreadyEnrolled === 'No'
                  );

                  if (firstReadyIndex !== -1) {
                    updatedProviders[firstReadyIndex] = {
                      ...updatedProviders[firstReadyIndex],
                      createEnrollmentComplete: false,
                      providerInfoComplete: false,
                      groupSpecialtiesChecked: false,
                      enrollmentTabComplete: false,
                      providerNameCorrect: false,
                      providerTypeCorrect: false,
                      applicationDateAdded: false,
                      cancelReasonCode: false,
                      providerAddressComplete: false,
                      paymentMailingAddressComplete: false,
                      providerInfoTabComplete: false,
                      npiTabComplete: false,
                      specialtyTabComplete: false,
                      claimTypeTabComplete: false,
                      licenseDeaTabComplete: false,
                      enrollOnMainframeComplete: false
                    };

                    setCurrentEnrollingProviderIndex(firstReadyIndex);
                    console.log(`Starting enrollment for provider ${firstReadyIndex + 1} of ${updatedProviders.length}`);

                    const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
                    if (createEnrollmentIndex !== -1) {
                      setFormData(prev => ({ ...prev, providerEnrollmentType: 'New Provider' }));
                      setCurrentPage(createEnrollmentIndex);
                      setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
                    }
                  }
                } else {
                  const hasExistingProviders = updatedProviders.some(p =>
                    p.status === 'Verified - Ready to Add to Group' ||
                    p.status === 'Enrolled - Ready to be Added to Group'
                  );

                  if (hasExistingProviders) {
                    updatedProviders.forEach((provider, idx) => {
                      if (provider.status === 'Verified - Ready to Add to Group') {
                        updatedProviders[idx] = { ...provider, status: 'Enrolled - Ready to be Added to Group' };
                      }
                    });

                    setFormData(prev => ({
                      ...prev,
                      providerEnrollmentType: 'Existing Provider'
                    }));

                    const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
                    if (openCicsIndex !== -1) {
                      const firstProviderIndex = updatedProviders.findIndex(p =>
                        p.status === 'Enrolled - Ready to be Added to Group'
                      );

                      if (firstProviderIndex !== -1) {
                        setCurrentAddingProviderIndex(firstProviderIndex);
                        console.log(`Starting to add provider ${firstProviderIndex + 1} to group`);
                      }

                      setCurrentPage(openCicsIndex);
                      setVisitedPages(prev => new Set([...prev, openCicsIndex]));
                    }
                  }
                }

                return updatedProviders;
              });

            }
          }
        }

        if (currentPageData.id === 'existing-provider-completion' && formData.additionalExistingProvidersNeeded === 'Yes') {
          const nextReadyIndex = enrolledProviders.findIndex((p, idx) =>
            idx > currentAddingProviderIndex &&
            (p.status === 'Enrolled - Ready to be Added to Group' ||
             p.status === 'Verified - Ready to Add to Group')
          );

          if (nextReadyIndex !== -1) {
            setEnrolledProviders(prev => {
              const updated = [...prev];

              if (currentAddingProviderIndex !== null && updated[currentAddingProviderIndex]) {
                updated[currentAddingProviderIndex] = {
                  ...updated[currentAddingProviderIndex],
                  status: 'Complete - Enrolled and Added to Group'
                };
                console.log(`Provider ${currentAddingProviderIndex + 1} added to group.`);
              }

              return updated;
            });

            setCurrentAddingProviderIndex(nextReadyIndex);
            console.log(`Moving to next provider: ${nextReadyIndex + 1}`);

            setFormData(prev => {
              const clearedData = { ...prev };
              delete clearedData.additionalExistingProvidersNeeded;
              delete clearedData.existingProviderOpenCicsComplete;
              delete clearedData.existingProviderAddToGroupComplete;
              delete clearedData.providerNameFormatting02;
              delete clearedData.mailToPayToAddresses;
              delete clearedData.cancelCodes;
              delete clearedData.effectiveDates;
              delete clearedData.boardCertificationIndicators;
              delete clearedData.programCode54PA;
              delete clearedData.existingProviderCloseEnrollmentComplete;
              delete clearedData.existingProviderFinishGroupChangeComplete;
              delete clearedData.existingProviderCreateChecklistComplete;
              delete clearedData.existingProviderApproveGroupChangeComplete;
              delete clearedData.existingProviderOpenLetterTaskComplete;
              delete clearedData.existingProviderSelectLetterComplete;
              delete clearedData.existingProviderAddToLetterComplete;
              delete clearedData.existingProviderFinishLetterComplete;
              delete clearedData.existingProviderCloseLetterTaskComplete;
              return clearedData;
            });

            const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
            if (openCicsIndex !== -1) {
              setCurrentPage(openCicsIndex);
              setVisitedPages(prev => new Set([...prev, openCicsIndex]));
            }
          } else {
            if (currentAddingProviderIndex !== null) {
              setEnrolledProviders(prev => {
                const updated = [...prev];
                if (updated[currentAddingProviderIndex]) {
                  updated[currentAddingProviderIndex] = {
                    ...updated[currentAddingProviderIndex],
                    status: 'Complete - Enrolled and Added to Group'
                  };
                  console.log(`Final provider ${currentAddingProviderIndex + 1} added to group.`);
                }
                return updated;
              });

              setCurrentAddingProviderIndex(null);
            }
          }
          return;
        }

        if (currentPageData.id === 'existing-provider-completion' && formData.additionalExistingProvidersNeeded === 'No') {
          if (currentAddingProviderIndex !== null) {
            setEnrolledProviders(prev => {
              const updated = [...prev];
              if (updated[currentAddingProviderIndex]) {
                updated[currentAddingProviderIndex] = {
                  ...updated[currentAddingProviderIndex],
                  status: 'Complete - Enrolled and Added to Group'
                };
                console.log(`Final provider ${currentAddingProviderIndex + 1} added to group.`);
              }
              return updated;
            });

            setCurrentAddingProviderIndex(null);
          }

          const finalCompletionIndex = pages.findIndex(page => page.id === 'final-completion');
          if (finalCompletionIndex !== -1) {
            setCurrentPage(finalCompletionIndex);
            setVisitedPages(prev => new Set([...prev, finalCompletionIndex]));
          }
          return;
        }

        if (currentPageData.id === 'additional-providers-check' && formData.additionalProvidersNeeded === 'Yes') {
          const nextReadyIndex = enrolledProviders.findIndex((p, idx) =>
            idx > currentEnrollingProviderIndex &&
            p.status === 'Verified - Ready to Enroll' &&
            p.providerAlreadyEnrolled === 'No'
          );

          if (nextReadyIndex !== -1) {
            setEnrolledProviders(prev => {
              const updated = [...prev];

              if (currentEnrollingProviderIndex !== null && updated[currentEnrollingProviderIndex]) {
                updated[currentEnrollingProviderIndex] = {
                  ...updated[currentEnrollingProviderIndex],
                  status: 'Enrolled - Ready to be Added to Group'
                };
                console.log(`Provider ${currentEnrollingProviderIndex + 1} enrollment completed.`);
              }

              if (updated[nextReadyIndex]) {
                updated[nextReadyIndex] = {
                  ...updated[nextReadyIndex],
                  createEnrollmentComplete: false,
                  providerInfoComplete: false,
                  groupSpecialtiesChecked: false,
                  enrollmentTabComplete: false,
                  providerNameCorrect: false,
                  providerTypeCorrect: false,
                  applicationDateAdded: false,
                  cancelReasonCode: false,
                  providerAddressComplete: false,
                  paymentMailingAddressComplete: false,
                  providerInfoTabComplete: false,
                  npiTabComplete: false,
                  specialtyTabComplete: false,
                  claimTypeTabComplete: false,
                  licenseDeaTabComplete: false,
                  enrollOnMainframeComplete: false
                };
              }

              return updated;
            });

            setCurrentEnrollingProviderIndex(nextReadyIndex);
            console.log(`Moving to next provider: ${nextReadyIndex + 1}`);

            const clearedData = { ...formData };
            delete clearedData.createEnrollmentComplete;
            delete clearedData.providerInfoComplete;
            delete clearedData.groupSpecialtiesChecked;
            delete clearedData.enrollmentTabComplete;
            delete clearedData.providerNameCorrect;
            delete clearedData.providerTypeCorrect;
            delete clearedData.applicationDateAdded;
            delete clearedData.cancelReasonCode;
            delete clearedData.providerAddressComplete;
            delete clearedData.paymentMailingAddressComplete;
            delete clearedData.providerInfoTabComplete;
            delete clearedData.npiTabComplete;
            delete clearedData.specialtyTabComplete;
            delete clearedData.claimTypeTabComplete;
            delete clearedData.licenseDeaTabComplete;
            delete clearedData.enrollOnMainframeComplete;
            delete clearedData.additionalProvidersNeeded;
            delete clearedData.duplicateProviderSaved;

            clearedData.providerEnrollmentType = 'New Provider';

            setFormData(clearedData);

            setUnableToVerifyFields(new Set());

            const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
            if (createEnrollmentIndex !== -1) {
              setCurrentPage(createEnrollmentIndex);
              setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
            }
          } else {
            await showAlert('No more providers are ready to enroll. You will be directed to complete the existing provider steps.');

            setEnrolledProviders(prev => {
              return prev.map(provider => {
                if (provider.status === 'Verified - Ready to Add to Group') {
                  return { ...provider, status: 'Enrolled - Ready to be Added to Group' };
                }
                return provider;
              });
            });

            setFormData(prev => ({
              ...prev,
              providerEnrollmentType: 'Existing Provider'
            }));

            const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
            if (openCicsIndex !== -1) {
              const firstProviderIndex = enrolledProviders.findIndex(p =>
                p.status === 'Enrolled - Ready to be Added to Group' ||
                p.status === 'Verified - Ready to Add to Group'
              );

              if (firstProviderIndex !== -1) {
                setCurrentAddingProviderIndex(firstProviderIndex);
                console.log(`Starting to add provider ${firstProviderIndex + 1} to group`);
              }

              setCurrentPage(openCicsIndex);
              setVisitedPages(prev => new Set([...prev, openCicsIndex]));
            }
          }
          return;
        }

        if (currentPageData.id === 'additional-providers-check' && formData.additionalProvidersNeeded === 'No') {
          if (currentEnrollingProviderIndex !== null) {
            setEnrolledProviders(prev => {
              const updated = [...prev];
              if (updated[currentEnrollingProviderIndex]) {
                updated[currentEnrollingProviderIndex] = {
                  ...updated[currentEnrollingProviderIndex],
                  status: 'Enrolled - Ready to be Added to Group'
                };
                console.log(`Final provider ${currentEnrollingProviderIndex + 1} enrollment completed.`);
              }

              return updated.map(provider => {
                if (provider.status === 'Verified - Ready to Add to Group') {
                  return { ...provider, status: 'Enrolled - Ready to be Added to Group' };
                }
                return provider;
              });
            });

            setCurrentEnrollingProviderIndex(null);
          }

          setFormData(prev => ({
            ...prev,
            providerEnrollmentType: 'Existing Provider'
          }));

          const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
          if (openCicsIndex !== -1) {
            const firstProviderIndex = enrolledProviders.findIndex(p =>
              p.status === 'Enrolled - Ready to be Added to Group' ||
              p.status === 'Verified - Ready to Add to Group'
            );

            if (firstProviderIndex !== -1) {
              setCurrentAddingProviderIndex(firstProviderIndex);
              console.log(`Starting to add provider ${firstProviderIndex + 1} to group`);
            }

            setCurrentPage(openCicsIndex);
            setVisitedPages(prev => new Set([...prev, openCicsIndex]));
          }
          return;
        }

        if (currentPageData.id === 'next-provider-ready-check') {
          const providerTypeIndex = pages.findIndex(page => page.id === 'provider-type-selection');
          if (providerTypeIndex !== -1) {
            const isAlreadyEnrolled = formData.nextProviderAlreadyEnrolled === 'Yes';
            const autoSelectedType = isAlreadyEnrolled ? 'Existing Provider' : 'New Provider';
            setFormData(prev => ({ ...prev, providerEnrollmentType: autoSelectedType }));

            setCurrentPage(providerTypeIndex);
            setVisitedPages(prev => new Set([...prev, providerTypeIndex]));
          }
          return;
        }

        if (currentPageData.id === 'provider-type-selection' && formData.nextProviderFinalVerificationConfirm) {
          const clearedData = { ...formData };
          delete clearedData.nextProviderFinalVerificationConfirm;
          delete clearedData.nextProviderAlreadyEnrolled;
          delete clearedData.nextProviderInGroup;
          delete clearedData.nextProviderFinalSsnVerified;
          delete clearedData.nextProviderFinalDexSanctionsCheck;
          delete clearedData.nextProviderFinalDobVerified;
          delete clearedData.nextProviderFinalNpiVerified;
          delete clearedData.nextProviderFinalLicensesVerified;
          delete clearedData.nextProviderFinalDoctorLicenseVerified;
          delete clearedData.nextProviderFinalDeaEffectiveDates;
          delete clearedData.nextProviderFinalEffectiveDatesChecked;

          setFormData(clearedData);

          const fieldsToRemove = ['nextProviderFinalSsnVerified', 'nextProviderFinalDexSanctionsCheck', 'nextProviderFinalDobVerified', 'nextProviderFinalNpiVerified', 'nextProviderFinalLicensesVerified', 'nextProviderFinalDoctorLicenseVerified'];
          setUnableToVerifyFields(prev => {
            const newSet = new Set(prev);
            fieldsToRemove.forEach(field => newSet.delete(field));
            return newSet;
          });
        }

        if (isPageValid() && currentPage < pages.length - 1) {
          let nextPage = currentPage + 1;
          while (nextPage < pages.length && !shouldShowPage(nextPage)) {
            nextPage++;
          }
          if (nextPage < pages.length) {
            setCurrentPage(nextPage);
            setVisitedPages(prev => new Set([...prev, nextPage]));

            const nextPageData = pages[nextPage];
            if (nextPageData.id === 'provider-type-selection') {
              const isAlreadyEnrolled =
                formData.nextProviderAlreadyEnrolled === 'Yes' ||
                formData.finalProviderAlreadyEnrolled === 'Yes' ||
                formData.providerAlreadyEnrolled === 'Yes';

              const autoSelectedType = isAlreadyEnrolled ? 'Existing Provider' : 'New Provider';
              setFormData(prev => ({ ...prev, providerEnrollmentType: autoSelectedType }));
            }

            if (nextPageData.showWhen?.field === 'providerEnrollmentType' &&
                nextPageData.showWhen?.value === 'Existing Provider' &&
                currentAddingProviderIndex === null) {
              const firstProviderIndex = enrolledProviders.findIndex(p =>
                p.status === 'Enrolled - Ready to be Added to Group' ||
                p.status === 'Verified - Ready to Add to Group'
              );

              if (firstProviderIndex !== -1) {
                setCurrentAddingProviderIndex(firstProviderIndex);
                console.log(`Starting existing provider branch - adding provider ${firstProviderIndex + 1} to group`);
              }
            }

          }
        }
      };

      const handlePrevious = () => {
        if (currentPage > 0) {
          let prevPage = currentPage - 1;
          while (prevPage >= 0 && !shouldShowPage(prevPage)) {
            prevPage--;
          }
          if (prevPage >= 0) {
            setCurrentPage(prevPage);
          }
        }
      };

      const handleSubmit = async () => {
        if (isPageValid()) {
          console.log('Form submitted:', formData);
          await showAlert('Form submitted successfully! Check console for data.');
        }
      };

      const handleDownloadNotes = () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `PROVIDER ENROLLMENT NOTES\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        if (enrolledProviders.length > 0) {
          textContent += `ENROLLED PROVIDERS (${enrolledProviders.length} total)\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          enrolledProviders.forEach((provider, index) => {
            textContent += `PROVIDER ${index + 1}\n`;
            textContent += `Status: ${provider.status || 'Successfully Enrolled'}\n\n`;

            textContent += `Enrollment Details:\n`;
            textContent += `   Enrollment Created: ${provider.createEnrollmentComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Info Complete: ${provider.providerInfoComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Group Specialties Checked: ${provider.groupSpecialtiesChecked ? 'Yes' : 'No'}\n`;
            textContent += `   Enrollment Tab Complete: ${provider.enrollmentTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Name Correct: ${provider.providerNameCorrect ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Type Correct: ${provider.providerTypeCorrect ? 'Yes' : 'No'}\n`;
            textContent += `   Application Date Added: ${provider.applicationDateAdded ? 'Yes' : 'No'}\n`;
            textContent += `   Cancel Reason Code: ${provider.cancelReasonCode ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Address Complete: ${provider.providerAddressComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Payment/Mailing Address Complete: ${provider.paymentMailingAddressComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Info Tab Complete: ${provider.providerInfoTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   NPI Tab Complete: ${provider.npiTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Specialty Tab Complete: ${provider.specialtyTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Claim Type Tab Complete: ${provider.claimTypeTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   License/DEA Tab Complete: ${provider.licenseDeaTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Mainframe Enrollment Complete: ${provider.enrollOnMainframeComplete ? 'Yes' : 'No'}\n`;

            if (providerManualNotes[index]) {
              textContent += `\nManual Notes:\n`;
              textContent += `  ${providerManualNotes[index].split('\n').join('\n  ')}\n`;
            }

            if (provider.outreachNotes && provider.outreachNotes.length > 0) {
              textContent += `\nnotes:\n`;
              provider.outreachNotes.forEach((note, noteIndex) => {
                textContent += `  ${noteIndex + 1}. ${note}\n`;
              });
            }

            textContent += `\n${'-'.repeat(80)}\n\n`;
          });
        } else {
          textContent += `No providers enrolled yet.\n\n`;
        }

        if (outreachNotes.length > 0) {
          textContent += `CURRENT OUTREACH NOTES (${outreachNotes.length})\n`;
          textContent += `${'-'.repeat(80)}\n`;
          outreachNotes.forEach((note, index) => {
            textContent += `${index + 1}. ${note}\n`;
          });
          textContent += `\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const dataBlob = new Blob([textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `provider-enrollment-notes-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const handleDownloadOutreachNotes = () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `OUTREACH NOTES\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        if (outreachNotes.length > 0) {
          textContent += `CURRENT OUTREACH NOTES (${outreachNotes.length})\n`;
          textContent += `${'-'.repeat(80)}\n`;
          outreachNotes.forEach((note, index) => {
            textContent += `${index + 1}. ${note}\n`;
          });
          textContent += `\n`;
        } else {
          textContent += `No outreach notes yet.\n\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const dataBlob = new Blob([textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `outreach-notes-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const handleDownloadEnrolledProviders = () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `ENROLLED PROVIDERS REPORT\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        if (enrolledProviders.length > 0) {
          // SECTION 1: PROVIDER MANUAL NOTES
          textContent += `PROVIDER MANUAL NOTES\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          enrolledProviders.forEach((provider, index) => {
            textContent += `PROVIDER ${index + 1}\n`;
            textContent += `Status: ${provider.status || 'Successfully Enrolled'}\n\n`;

            textContent += `Enrollment Details:\n`;
            textContent += `   Enrollment Created: ${provider.createEnrollmentComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Info Complete: ${provider.providerInfoComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Group Specialties Checked: ${provider.groupSpecialtiesChecked ? 'Yes' : 'No'}\n`;
            textContent += `   Enrollment Tab Complete: ${provider.enrollmentTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Name Correct: ${provider.providerNameCorrect ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Type Correct: ${provider.providerTypeCorrect ? 'Yes' : 'No'}\n`;
            textContent += `   Application Date Added: ${provider.applicationDateAdded ? 'Yes' : 'No'}\n`;
            textContent += `   Cancel Reason Code: ${provider.cancelReasonCode ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Address Complete: ${provider.providerAddressComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Payment/Mailing Address Complete: ${provider.paymentMailingAddressComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Provider Info Tab Complete: ${provider.providerInfoTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   NPI Tab Complete: ${provider.npiTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Specialty Tab Complete: ${provider.specialtyTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Claim Type Tab Complete: ${provider.claimTypeTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   License/DEA Tab Complete: ${provider.licenseDeaTabComplete ? 'Yes' : 'No'}\n`;
            textContent += `   Mainframe Enrollment Complete: ${provider.enrollOnMainframeComplete ? 'Yes' : 'No'}\n`;

            if (providerManualNotes[index]) {
              textContent += `\nManual Notes:\n`;
              textContent += `  ${providerManualNotes[index].split('\n').join('\n  ')}\n`;
            } else {
              textContent += `\nManual Notes: None\n`;
            }

            textContent += `\n${'-'.repeat(80)}\n\n`;
          });

          // SECTION 2: OUTREACH NOTES
          textContent += `\nOUTREACH NOTES\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          let hasOutreachNotes = false;
          enrolledProviders.forEach((provider, index) => {
            if (provider.outreachNotes && provider.outreachNotes.length > 0) {
              hasOutreachNotes = true;
              textContent += `PROVIDER ${index + 1}:\n`;
              provider.outreachNotes.forEach((note, noteIndex) => {
                textContent += `  ${noteIndex + 1}. ${note}\n`;
              });
              textContent += `\n`;
            }
          });

          if (!hasOutreachNotes) {
            textContent += `No outreach notes for any providers.\n\n`;
          }
        } else {
          textContent += `No providers enrolled yet.\n\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const dataBlob = new Blob([textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `enrolled-providers-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const handleStartNewApplication = async () => {
        if (await showConfirm('Are you sure you want to start a new application? All current data will be lost.')) {
          setFormData({});
          setOutreachNotes([]);
          setEnrolledProviders([]);
          setProviderManualNotes({});
          setUnableToVerifyFields(new Set());
          setPendingUnableToVerifyField(null);
          setVisitedPages(new Set([0]));
          setCurrentPage(0);
        }
      };

      const handleRejectDuplicate = async () => {
        if (await showConfirm('Are you sure you want to reject this application as a duplicate? This provider is already in the group and does not need to be enrolled.')) {
          const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
          const duplicateNote = `[${stepInfo}] Rejected as a duplicate - provider is already in the group`;
          setOutreachNotes(prev => [...prev, duplicateNote]);

          const completionIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
          if (completionIndex !== -1) {
            setCurrentPage(completionIndex);
            setVisitedPages(prev => new Set([...prev, completionIndex]));
          }
        }
      };

      const handleNextProvider = async () => {
        const expectedProviderCount = formData.expectedProviderCount || 0;
        if (enrolledProviders.length > expectedProviderCount) {
          await showAlert('This provider has already been saved. Please proceed to the next step.');
          return;
        }

        const moreProviders = await showConfirm('Are there additional providers in this application to process?\n\nThis will save the current provider as "already enrolled and in group" and reset the form for the next provider.');

        const duplicateNote = 'Provider already enrolled and in group - no action needed';

        const providerData = {
          status: 'Already Enrolled and In Group',
          question20Answered: formData.question20Answered,
          providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
          providerInGroup: formData.providerInGroup,
          nextProviderFinalVerificationConfirm: formData.nextProviderFinalVerificationConfirm,
          nextProviderAlreadyEnrolled: formData.nextProviderAlreadyEnrolled,
          nextProviderInGroup: formData.nextProviderInGroup,
          outreachNotes: [duplicateNote]
        };

        if (moreProviders) {
          // Save the duplicate provider and prepare for the next provider
          setEnrolledProviders(prev => {
            const updatedProviders = [...prev, providerData];
            console.log(`Provider saved as duplicate. Total providers: ${updatedProviders.length}`);
            return updatedProviders;
          });
          const clearedData = { ...formData };

          delete clearedData.question20Answered;
          delete clearedData.providerAlreadyEnrolled;
          delete clearedData.providerInGroup;
          delete clearedData.ssnVerified;
          delete clearedData.dexSanctionsCheck;
          delete clearedData.dobVerified;
          delete clearedData.npiVerified;
          delete clearedData.licensesVerified;
          delete clearedData.doctorLicenseVerified;
          delete clearedData.deaEffectiveDates;
          delete clearedData.effectiveDatesChecked;

          delete clearedData.nextProviderFinalVerificationConfirm;
          delete clearedData.nextProviderAlreadyEnrolled;
          delete clearedData.nextProviderInGroup;
          delete clearedData.nextProviderFinalSsnVerified;
          delete clearedData.nextProviderFinalDexSanctionsCheck;
          delete clearedData.nextProviderFinalDobVerified;
          delete clearedData.nextProviderFinalNpiVerified;
          delete clearedData.nextProviderFinalLicensesVerified;
          delete clearedData.nextProviderFinalDoctorLicenseVerified;
          delete clearedData.nextProviderFinalDeaEffectiveDates;
          delete clearedData.nextProviderFinalEffectiveDatesChecked;

          clearedData.expectedProviderCount = enrolledProviders.length + 1;

          setFormData(clearedData);

          const fieldsToRemove = ['nextProviderFinalSsnVerified', 'nextProviderFinalDexSanctionsCheck', 'nextProviderFinalDobVerified', 'nextProviderFinalNpiVerified', 'nextProviderFinalLicensesVerified', 'nextProviderFinalDoctorLicenseVerified'];
          setUnableToVerifyFields(prev => {
            const newSet = new Set(prev);
            fieldsToRemove.forEach(field => newSet.delete(field));
            return newSet;
          });

          await showAlert('Provider saved. You can now enter information for the next provider.');
        } else {
          const allProviders = [...enrolledProviders, providerData];

          if (allProviders.length === 1 && providerData.status === 'Already Enrolled and In Group') {
            const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
            const rejectionNote = `[${stepInfo}] Application rejected as duplicate - only provider is already enrolled and in group`;
            const updatedProviderData = {
              ...providerData,
              outreachNotes: [duplicateNote, rejectionNote]
            };

            setEnrolledProviders([updatedProviderData]);
            setOutreachNotes(prev => [...prev, rejectionNote]);

            const completionIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
            if (completionIndex !== -1) {
              setCurrentPage(completionIndex);
              setVisitedPages(prev => new Set([...prev, completionIndex]));
            }
            return;
          }

          const hasUnverifiedItems = allProviders.some(provider =>
            provider.outreachNotes && provider.outreachNotes.length > 0 &&
            provider.status === 'Unable to Verify - Requires Outreach'
          );

          if (hasUnverifiedItems) {
            // Save all providers including the current one
            setEnrolledProviders(allProviders);

            const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
            if (completionIndex !== -1) {
              setCurrentPage(completionIndex);
              setVisitedPages(prev => new Set([...prev, completionIndex]));
            }
          } else {
            const needsEnrollment = allProviders.some(p =>
              p.status === 'Verified - Ready to Enroll' &&
              p.providerAlreadyEnrolled === 'No'
            );

            if (needsEnrollment) {
              const firstReadyIndex = allProviders.findIndex(p =>
                p.status === 'Verified - Ready to Enroll' &&
                p.providerAlreadyEnrolled === 'No'
              );

              if (firstReadyIndex !== -1) {
                setEnrolledProviders(() => {
                  const updated = [...allProviders];
                  updated[firstReadyIndex] = {
                    ...updated[firstReadyIndex],
                    createEnrollmentComplete: false,
                    providerInfoComplete: false,
                    groupSpecialtiesChecked: false,
                    enrollmentTabComplete: false,
                    providerNameCorrect: false,
                    providerTypeCorrect: false,
                    applicationDateAdded: false,
                    cancelReasonCode: false,
                    providerAddressComplete: false,
                    paymentMailingAddressComplete: false,
                    providerInfoTabComplete: false,
                    npiTabComplete: false,
                    specialtyTabComplete: false,
                    claimTypeTabComplete: false,
                    licenseDeaTabComplete: false,
                    enrollOnMainframeComplete: false
                  };
                  return updated;
                });

                setCurrentEnrollingProviderIndex(firstReadyIndex);
                console.log(`Starting enrollment for provider ${firstReadyIndex + 1}`);

                const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
                if (createEnrollmentIndex !== -1) {
                  setFormData(prev => ({ ...prev, providerEnrollmentType: 'New Provider' }));
                  setCurrentPage(createEnrollmentIndex);
                  setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
                }
              }
            } else {
              // Save all providers including the current duplicate
              setEnrolledProviders(allProviders);

              setFormData(prev => ({
                ...prev,
                providerEnrollmentType: 'Existing Provider'
              }));

              const addToGroupIndex = pages.findIndex(page => page.id === 'existing-provider-add-to-group');
              if (addToGroupIndex !== -1) {
                const firstProviderIndex = allProviders.findIndex(p =>
                  p.status === 'Enrolled - Ready to be Added to Group'
                );

                if (firstProviderIndex !== -1) {
                  setCurrentAddingProviderIndex(firstProviderIndex);
                  console.log(`Starting to add provider ${firstProviderIndex + 1} to group`);
                }

                setCurrentPage(addToGroupIndex);
                setVisitedPages(prev => new Set([...prev, addToGroupIndex]));
              }
            }
          }
        }
      };

      const handleAddOutreachNote = (reason, fieldName = null) => {
        const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
        const noteWithStep = `[${stepInfo}] ${reason}`;
        setCurrentOutreachReason(noteWithStep);
        setShowOutreachModal(true);

        if (fieldName) {
          setPendingUnableToVerifyField(fieldName);
        }
      };

      const confirmAddOutreachNote = () => {
        if (currentOutreachReason && !outreachNotes.includes(currentOutreachReason)) {
          setOutreachNotes(prev => [...prev, currentOutreachReason]);
        }

        if (pendingUnableToVerifyField) {
          setUnableToVerifyFields(prev => new Set([...prev, pendingUnableToVerifyField]));
          setPendingUnableToVerifyField(null);
        }

        setShowOutreachModal(false);
        setCurrentOutreachReason('');
      };

      const cancelAddOutreachNote = () => {
        setShowOutreachModal(false);
        setCurrentOutreachReason('');
        setPendingUnableToVerifyField(null);
      };

      const handleRemoveNote = (index) => {
        setOutreachNotes(prev => prev.filter((_, i) => i !== index));
      };

      const handleProviderManualNoteChange = (providerIndex, note) => {
        setProviderManualNotes(prev => ({
          ...prev,
          [providerIndex]: note
        }));
      };

      const currentPageData = pages[currentPage];
      const isLastPage = currentPage === pages.length - 1;

      const canProceed = isPageValid() &&
        !(currentPageData.id === 'question-20' && formData.providerInGroup === 'Yes') &&
        !(currentPageData.id === 'next-provider-ready-check' && formData.nextProviderInGroup === 'Yes');

      const getNextButtonText = () => {
        if (currentPageData.id === 'existing-provider-completion' && formData.additionalExistingProvidersNeeded === 'Yes') {
          return 'Add Next Provider';
        }

        if (currentPageData.id === 'additional-providers-check' && formData.additionalProvidersNeeded === 'Yes') {
          return 'Start New Provider';
        }

        if (currentPageData.id === 'question-20') {
          return 'Next Provider';
        }

        if (isLastPage) return 'Submit';
        return 'Continue';
      };

      // ============================================================
      // COMPONENT RENDERING
      // ============================================================

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-teal-50 to-cyan-50 p-6 flex items-center justify-center">
          {/* Custom Styles */}
          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap');

            :root {
              --gainwell-teal: #3d5a66;
              --gainwell-cyan: #00e5b4;
              --gainwell-dark: #2a3f4a;
              --gainwell-light-teal: #527584;
            }

            * {
              font-family: 'DM Sans', sans-serif;
            }

            .title-font {
              font-family: 'Crimson Pro', serif;
            }

            .field-input {
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .field-input:focus {
              transform: translateY(-2px);
              box-shadow: 0 8px 20px rgba(79, 70, 229, 0.15);
            }

            .btn-primary {
              position: relative;
              overflow: hidden;
            }

            .btn-primary::before {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
              transition: left 0.5s;
            }

            .btn-primary:hover::before {
              left: 100%;
            }

            .page-enter {
              animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes slideIn {
              from {
                opacity: 0;
                transform: translateX(20px);
              }
              to {
                opacity: 1;
                transform: translateX(0);
              }
            }

            .modal-overlay {
              position: fixed;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: rgba(0, 0, 0, 0.8);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 1000;
              animation: fadeIn 0.2s ease;
            }

            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }

            .modal-image {
              max-width: 90vw;
              max-height: 90vh;
              border-radius: 12px;
              box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            }

            .thumbnail-container {
              position: absolute;
              top: 16px;
              right: 16px;
              cursor: pointer;
              transition: transform 0.2s ease;
            }

            .thumbnail-container:hover {
              transform: scale(1.05);
            }
          `}</style>

          <div className="max-w-2xl w-full">
            {/* Form Card */}
            <div className="bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-100 page-enter">
              {/* Header */}
              <div className="p-8 text-white relative" style={{background: 'linear-gradient(to right, var(--gainwell-teal), var(--gainwell-dark))'}}>
                {(currentPageData.id === 'group-practice' || currentPageData.id === 'question-6' || currentPageData.id === 'question-20' || currentPageData.id === 'questions-21-23' || currentPageData.id === 'existing-provider-questions-21-23') && (
                  <div
                    className="thumbnail-container"
                    onClick={() => setShowImageModal(true)}
                    title="Click to view full size"
                  >
                    <img
                      src={
                        currentPageData.id === 'group-practice' ? groupPracticeAppImage :
                        currentPageData.id === 'question-6' ? question6Image :
                        currentPageData.id === 'question-20' ? practitionersImage :
                        questions21to24Image
                      }
                      alt={
                        currentPageData.id === 'group-practice' ? 'Group Practice Application Example' :
                        currentPageData.id === 'question-6' ? 'Question 6 Example' :
                        currentPageData.id === 'question-20' ? 'Practitioners Example' :
                        'Questions 21-24 Example'
                      }
                      className="w-24 h-24 object-cover rounded-lg border-2 border-white shadow-lg"
                    />
                    <div className="absolute -bottom-1 -right-1 bg-white rounded-full p-1">
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" style={{color: 'var(--gainwell-teal)'}}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
                      </svg>
                    </div>
                  </div>
                )}
                <h1 className="title-font text-4xl font-bold mb-2">
                  {currentPageData.title}
                </h1>
                <p className="text-cyan-100 text-lg">
                  {typeof currentPageData.description === 'function' ? currentPageData.description(formData) : currentPageData.description}
                </p>
                {/* Current Provider Indicator */}
                {currentEnrollingProviderIndex !== null && formData.providerEnrollmentType === 'New Provider' && (
                  <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-4 py-2">
                    <div className="flex items-center gap-2">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      <span className="text-white font-semibold text-sm">
                        Currently Enrolling: Provider {currentEnrollingProviderIndex + 1} of {enrolledProviders.length}
                      </span>
                    </div>
                  </div>
                )}
                {/* Adding Provider to Group Indicator */}
                {currentAddingProviderIndex !== null && formData.providerEnrollmentType === 'Existing Provider' && (
                  <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-4 py-2">
                    <div className="flex items-center gap-2">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                      <span className="text-white font-semibold text-sm">
                        Adding Provider to Group: Provider {currentAddingProviderIndex + 1} of {enrolledProviders.length}
                      </span>
                    </div>
                  </div>
                )}
              </div>

              {/* Form Content */}
              <div className="p-8 space-y-6">
                {/* Instruction Text */}
                {currentPageData.instructionText && !currentPageData.isCompletionPage && (
                  <div className="border-l-4 p-4 rounded-r-lg mb-6" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                    <p className="text-slate-800 font-medium whitespace-pre-line">
                      {currentPageData.instructionText}
                    </p>
                  </div>
                )}

                {/* Completion Page Instruction Text */}
                {currentPageData.instructionText && currentPageData.isCompletionPage && (
                  <div className="border-l-4 p-4 rounded-r-lg mb-6" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                    <div className="text-slate-800 font-medium whitespace-pre-line">
                      {currentPageData.instructionText}
                    </div>
                  </div>
                )}

                {/* Name Format Note */}
                {currentPageData.nameFormatNote && (
                  <div className="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg mb-6">
                    <div className="flex items-start gap-3">
                      <svg className="w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p className="text-purple-900 font-medium">
                        {currentPageData.nameFormatNote}
                      </p>
                    </div>
                  </div>
                )}

                {/* Display Image */}
                {currentPageData.displayImage && (
                  <div className="mb-6">
                    <img
                      src={currentPageData.displayImage}
                      alt="Reference"
                      className="w-full rounded-lg border-2 border-slate-200 shadow-md"
                    />
                  </div>
                )}

                {/* Note Text */}
                {currentPageData.noteText && (
                  <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4 mb-6">
                    <div className="flex items-start gap-3">
                      <div className="bg-amber-400 rounded-full p-1 mt-0.5 flex-shrink-0">
                        <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                      </div>
                      <p className="text-amber-900 font-semibold">
                        {currentPageData.noteText}
                      </p>
                    </div>
                  </div>
                )}

                {/* Resource Text and Buttons */}
                {currentPageData.resourceText && currentPageData.resources && (
                  <div className="bg-slate-50 border-2 border-slate-300 rounded-lg p-5 mb-6">
                    <p className="text-slate-800 font-semibold mb-4">
                      {currentPageData.resourceText}
                    </p>
                    <div className="flex flex-wrap gap-3">
                      {currentPageData.resources.map((resource, idx) => (
                        <a
                          key={idx}
                          href={resource.url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="inline-flex items-center gap-2 px-5 py-3 text-white font-semibold rounded-lg transition-all hover:shadow-lg"
                          style={{backgroundColor: 'var(--gainwell-teal)'}}
                          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                        >
                          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                          </svg>
                          {resource.label}
                        </a>
                      ))}
                    </div>
                  </div>
                )}

                {/* Page-specific Important Notes (before fields) */}
                {currentPageData.pageNotes && (
                  <div className="mt-8 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', border: '1px solid #b2dfdb'}}>
                    <h4 className="font-semibold text-sm mb-2 uppercase tracking-wide" style={{color: 'var(--gainwell-dark)'}}>Important Notes:</h4>
                    <ul className="space-y-2">
                      {currentPageData.pageNotes.map((note, idx) => (
                        <li key={idx} className="text-sm flex items-start" style={{color: 'var(--gainwell-teal)'}}>
                          <span className="mr-2 mt-1 flex-shrink-0"></span>
                          <span>{note}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                {currentPageData.fields.map((field, index) => {
                  if (currentPageData.id === 'question-20' && field.type === 'checkbox') {
                    return null;
                  }

                  if (currentPageData.id === 'next-provider-ready-check' && field.type === 'checkbox') {
                    return null;
                  }

                  if (currentPageData.id === 'questions-21-23') {
                    return null;
                  }

                  if (field.showWhen) {
                    let conditionMet;
                    if (typeof field.showWhen === 'function') {
                      conditionMet = field.showWhen(formData);
                    } else {
                      conditionMet = formData[field.showWhen.field] === field.showWhen.value;
                    }
                    if (!conditionMet) return null;
                  }

                  const value = formData[field.name] || (field.type === 'checkbox' ? false : '');
                  const isValid = field.validation ? field.validation(value) : !!value;
                  const showValidation = (typeof value === 'string' && value.length > 0) || field.type === 'checkbox';

                  return (
                    <div key={field.name} style={{ animationDelay: `${index * 0.1}s` }} className="page-enter">
                      {field.type !== 'checkbox' && (
                        <label className="block text-sm font-semibold text-slate-700 mb-2">
                          {typeof field.label === 'function' ? field.label(formData) : field.label}
                          {field.required && <span className="text-red-500 ml-1">*</span>}
                        </label>
                      )}
                      <div className="relative">
                        {field.type === 'checkbox' ? (
                          <>
                            {field.helperNotes ? (
                              <div className="border-2 rounded-lg p-5" style={{backgroundColor: '#e0f2f1', borderColor: '#b2dfdb'}}>
                                <div className="mb-4">
                                  {(typeof field.helperNotes === 'function' ? field.helperNotes(formData) : field.helperNotes).map((note, idx) => (
                                    <p key={idx} className="font-medium mb-2" style={{color: 'var(--gainwell-dark)'}}>
                                      {note}
                                    </p>
                                  ))}
                                </div>
                                <label className={`flex items-start p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                  value
                                    ? 'bg-cyan-100'
                                    : 'border-slate-300 hover:border-slate-400 bg-white'
                                }`} style={value ? {borderColor: 'var(--gainwell-cyan)'} : {}}>
                                  <input
                                    type="checkbox"
                                    checked={value || false}
                                    onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                    className="w-5 h-5 mt-0.5 flex-shrink-0"
                                    style={{accentColor: 'var(--gainwell-cyan)'}}
                                  />
                                  <span className="ml-3 font-medium text-slate-700">
                                    {typeof field.label === 'function' ? field.label(formData) : field.label}
                                    {field.required && <span className="text-red-500 ml-1">*</span>}
                                  </span>
                                </label>
                              </div>
                            ) : (
                              <label className={`flex items-start p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                value
                                  ? 'bg-cyan-50'
                                  : 'border-slate-200 hover:border-slate-300 bg-white'
                              }`} style={value ? {borderColor: 'var(--gainwell-cyan)'} : {}}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  className="w-5 h-5 mt-0.5 flex-shrink-0"
                                  style={{accentColor: 'var(--gainwell-cyan)'}}
                                />
                                <span className="ml-3 font-medium text-slate-700">
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                </span>
                              </label>
                            )}
                          </>
                        ) : field.type === 'radio' ? (
                          <div className="space-y-3">
                            {(typeof field.options === 'function' ? field.options(formData) : field.options).map((option) => (
                              <label
                                key={option}
                                className={`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                  value === option
                                    ? 'bg-cyan-50'
                                    : 'border-slate-200 hover:border-slate-300 bg-white'
                                }`}
                                style={value === option ? {borderColor: 'var(--gainwell-cyan)'} : {}}
                              >
                                <input
                                  type="radio"
                                  name={field.name}
                                  value={option}
                                  checked={value === option}
                                  onChange={(e) => handleFieldChange(field.name, e.target.value)}
                                  className="w-5 h-5"
                                  style={{accentColor: 'var(--gainwell-cyan)'}}
                                />
                                <span className="ml-3 font-medium text-slate-700">{option}</span>
                              </label>
                            ))}
                          </div>
                        ) : field.type === 'textarea' ? (
                          <textarea
                            value={value}
                            onChange={(e) => handleFieldChange(field.name, e.target.value)}
                            placeholder={field.placeholder}
                            rows={4}
                            className={`field-input w-full px-4 py-3 border-2 rounded-xl focus:outline-none ${
                              showValidation
                                ? isValid
                                  ? 'border-green-300 focus:border-green-500'
                                  : 'border-red-300 focus:border-red-500'
                                : 'border-slate-200 focus:border-cyan-500'
                            }`}
                          />
                        ) : (
                          <input
                            type={field.type}
                            value={value}
                            onChange={(e) => handleFieldChange(field.name, e.target.value)}
                            placeholder={field.placeholder}
                            className={`field-input w-full px-4 py-3 border-2 rounded-xl focus:outline-none ${
                              showValidation
                                ? isValid
                                  ? 'border-green-300 focus:border-green-500'
                                  : 'border-red-300 focus:border-red-500'
                                : 'border-slate-200 focus:border-cyan-500'
                            }`}
                          />
                        )}
                        {showValidation && field.type !== 'radio' && field.type !== 'checkbox' && (
                          <div className="absolute right-3 top-1/2 -translate-y-1/2">
                            {isValid ? (
                              <CheckCircle2 className="w-5 h-5 text-green-500" />
                            ) : (
                              <Circle className="w-5 h-5 text-red-500" />
                            )}
                          </div>
                        )}
                      </div>
                      {field.helperText && (
                        <p className="text-sm text-slate-500 mt-1">{field.helperText}</p>
                      )}
                    </div>
                  );
                })}

                {/* Requirements Summary */}
                {!currentPageData.isCompletionPage && (
                <div className="mt-8 p-4 bg-slate-50 rounded-xl border border-slate-200">
                  <h3 className="font-semibold text-slate-700 mb-2 text-sm uppercase tracking-wide">
                    Requirements
                  </h3>

                  {currentPageData.id === 'group-practice' && formData.groupPracticeAttached === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that an application is required to make any changes.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'group-practice' && formData.questionsAnswered === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a revised application with the missing responses to required questions.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a revised application with the missing responses to required questions.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-6' && formData.question6Answered === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach group and request the practice address.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach group and request the practice address.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'payto-mailto' && formData.questions7and8Answered === 'Yes' ? (
                    <div className="bg-green-50 border-2 border-green-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-green-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-green-900 text-lg mb-2">Review Next Steps</h4>
                          <p className="text-green-800 font-medium mb-3">
                            Questions 7 and 8 are answered. Click below to view the next steps for updating addresses in CICS.
                          </p>
                          <button
                            onClick={() => setShowNextStepsModal(true)}
                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2"
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            View Next Steps
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'questions-9-17' && formData.questions9to17Answered === 'No' ? (
                    <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-blue-900 text-lg mb-2">OUTREACH</h4>
                          <p className="text-blue-800 font-medium mb-3">
                            Outreach the group and ask them to provide the missing answers for Questions 9, 11, 12, 16 and 17 on the group practice application (FD23)
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and ask them to provide the missing answers for Questions 9, 11, 12, 16 and 17 on the group practice application (FD23)')}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-20' && formData.question20Answered === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that Question 20 was not answered completely.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-20' && formData.question20Answered === 'Yes' && formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'Yes' ? (
                    <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
                      <div className="flex items-start gap-3 mb-4">
                        <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-blue-900 text-lg mb-2">DUPLICATE PROVIDER DETECTED</h4>
                          <p className="text-blue-800 font-medium mb-4">
                            This provider is already enrolled and already in the group. You can reject this application as a duplicate if there are no other providers to verify.
                          </p>
                          <div className="flex gap-3">
                            <button
                              onClick={handleRejectDuplicate}
                              className="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Reject as Duplicate
                            </button>
                            <button
                              onClick={handleDownloadNotes}
                              className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Download Notes
                            </button>
                            <button
                              onClick={handleNextProvider}
                              className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Next Provider
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-20' && formData.question20Answered === 'Yes' ? (
                    <div className="space-y-3">
                      {currentPageData.fields
                        .filter(f => {
                          if (f.type !== 'checkbox') return false;
                          if (f.showWhen) {
                            if (typeof f.showWhen === 'function') {
                              return f.showWhen(formData);
                            } else {
                              return formData[f.showWhen.field] === f.showWhen.value;
                            }
                          }
                          return true;
                        })
                        .map((field, idx) => {
                          const value = formData[field.name] || false;
                          const isValid = field.validation ? field.validation(value) : !!value;

                          const hasUnableToVerifyButton = ['ssnVerified', 'dexSanctionsCheck', 'dobVerified', 'npiVerified', 'licensesVerified', 'doctorLicenseVerified', 'nextProviderFinalSsnVerified', 'nextProviderFinalDexSanctionsCheck', 'nextProviderFinalDobVerified', 'nextProviderFinalNpiVerified', 'nextProviderFinalLicensesVerified', 'nextProviderFinalDoctorLicenseVerified'].includes(field.name);

                          const isUnableToVerify = unableToVerifyFields.has(field.name);

                          return (
                            <div key={field.name} className={`p-4 border-2 rounded-xl transition-all page-enter ${
                              isUnableToVerify
                                ? 'border-slate-300 bg-slate-100 opacity-60'
                                : value
                                ? 'border-indigo-500 bg-indigo-50'
                                : 'border-slate-200 hover:border-slate-300 bg-white'
                            }`}>
                              <label className={`flex items-start ${isUnableToVerify ? 'cursor-not-allowed' : 'cursor-pointer'}`}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  disabled={isUnableToVerify}
                                  className="w-5 h-5 text-indigo-600 focus:ring-indigo-500 mt-0.5 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                                />
                                <span className={`ml-3 font-medium flex-1 ${isUnableToVerify ? 'text-slate-400' : 'text-slate-700'}`}>
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                  {isUnableToVerify && <span className="ml-2 text-xs font-semibold text-amber-600">(UNABLE TO VERIFY)</span>}
                                </span>
                              </label>
                              {(field.sovosUrl || field.npiRegistryUrl || hasUnableToVerifyButton) && (
                                <div className="mt-3 flex justify-end gap-2">
                                  {field.sovosUrl && !isUnableToVerify && (
                                    <a
                                      href={field.sovosUrl}
                                      target="_blank"
                                      rel="noopener noreferrer"
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Go to SOVOS
                                    </a>
                                  )}
                                  {field.npiRegistryUrl && !isUnableToVerify && (
                                    <a
                                      href={field.npiRegistryUrl}
                                      target="_blank"
                                      rel="noopener noreferrer"
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Go to NPI Registry
                                    </a>
                                  )}
                                  {hasUnableToVerifyButton && !isUnableToVerify && (
                                    <button
                                      onClick={() => handleAddOutreachNote(`Unable to verify: ${typeof field.label === 'function' ? field.label(formData) : field.label}`, field.name)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white font-semibold rounded-lg transition-colors text-sm border-2 border-amber-500"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                      </svg>
                                      Unable to Verify
                                    </button>
                                  )}
                                </div>
                              )}
                            </div>
                          );
                        })}
                    </div>
                  ) : currentPageData.id === 'next-provider-ready-check' && formData.nextProviderFinalVerificationConfirm === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that Question 20 was not answered completely.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'next-provider-ready-check' && formData.nextProviderFinalVerificationConfirm === 'Yes' && formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'Yes' ? (
                    <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
                      <div className="flex items-start gap-3 mb-4">
                        <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-blue-900 text-lg mb-2">DUPLICATE PROVIDER DETECTED</h4>
                          <p className="text-blue-800 font-medium mb-4">
                            This provider is already enrolled and already in the group. You can reject this application as a duplicate.
                          </p>
                          <div className="flex gap-3">
                            <button
                              onClick={handleRejectDuplicate}
                              className="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Reject as Duplicate
                            </button>
                            <button
                              onClick={handleDownloadNotes}
                              className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Download Notes
                            </button>
                            <button
                              onClick={handleNextProvider}
                              className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors shadow-md"
                            >
                              Next Provider
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'next-provider-ready-check' && formData.nextProviderFinalVerificationConfirm === 'Yes' ? (
                    <div className="space-y-3">
                      {currentPageData.fields
                        .filter(f => {
                          if (f.type !== 'checkbox') return false;
                          if (f.showWhen) {
                            if (typeof f.showWhen === 'function') {
                              return f.showWhen(formData);
                            } else {
                              return formData[f.showWhen.field] === f.showWhen.value;
                            }
                          }
                          return true;
                        })
                        .map((field, idx) => {
                          const value = formData[field.name] || false;
                          const isValid = field.validation ? field.validation(value) : !!value;

                          const isUnableToVerify = unableToVerifyFields.has(field.name);

                          return (
                            <div key={field.name} className={`p-4 border-2 rounded-xl transition-all page-enter ${
                              isUnableToVerify
                                ? 'border-slate-300 bg-slate-100 opacity-60'
                                : value
                                ? 'border-indigo-500 bg-indigo-50'
                                : 'border-slate-200 hover:border-slate-300 bg-white'
                            }`}>
                              <label className={`flex items-start ${isUnableToVerify ? 'cursor-not-allowed' : 'cursor-pointer'}`}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  disabled={isUnableToVerify}
                                  className="w-5 h-5 text-indigo-600 focus:ring-indigo-500 mt-0.5 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                                />
                                <span className={`ml-3 font-medium flex-1 ${isUnableToVerify ? 'text-slate-400' : 'text-slate-700'}`}>
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                  {isUnableToVerify && <span className="ml-2 text-xs font-semibold text-amber-600">(UNABLE TO VERIFY)</span>}
                                </span>
                              </label>
                              {field.sovosUrl && (
                                <div className="mt-3 ml-8">
                                  <a
                                    href={field.sovosUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm"
                                  >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                    </svg>
                                    Go to SOVOS
                                  </a>
                                </div>
                              )}
                            </div>
                          );
                        })}
                    </div>
                  ) : currentPageData.id === 'questions-21-23' ? (
                    <div className="space-y-6">
                      {currentPageData.fields.map((field, idx) => {
                        const value = formData[field.name] || '';
                        const isValid = field.validation ? field.validation(value) : !!value;

                        return (
                          <div key={field.name} className="space-y-3">
                            <label className="block text-sm font-semibold text-slate-700 mb-2">
                              {typeof field.label === 'function' ? field.label(formData) : field.label}
                              {field.required && <span className="text-red-500 ml-1">*</span>}
                            </label>

                            <div className="space-y-3">
                              {(typeof field.options === 'function' ? field.options(formData) : field.options).map((option) => (
                                <label
                                  key={option}
                                  className={`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                    value === option
                                      ? 'border-indigo-500 bg-indigo-50'
                                      : 'border-slate-200 hover:border-slate-300 bg-white'
                                  }`}
                                >
                                  <input
                                    type="radio"
                                    name={field.name}
                                    value={option}
                                    checked={value === option}
                                    onChange={(e) => handleFieldChange(field.name, e.target.value)}
                                    className="w-5 h-5 text-indigo-600 focus:ring-indigo-500"
                                  />
                                  <span className="ml-3 font-medium text-slate-700">{option}</span>
                                </label>
                              ))}
                            </div>

                            {field.helperNotes && (
                              <div className="mt-3 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', border: '1px solid #b2dfdb'}}>
                                <h4 className="font-semibold text-sm mb-2" style={{color: 'var(--gainwell-dark)'}}>Important Notes:</h4>
                                <ul className="space-y-2">
                                  {(typeof field.helperNotes === 'function' ? field.helperNotes(formData) : field.helperNotes).map((note, noteIdx) => (
                                    <li key={noteIdx} className="text-sm flex items-start" style={{color: 'var(--gainwell-teal)'}}>
                                      <span className="mr-2 mt-1 flex-shrink-0"></span>
                                      <span>{note}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        );
                      })}

                      {(formData.question21Answered === 'No' || formData.question22Answered === 'No' || formData.question23Answered === 'No') && (
                        <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-4 mt-6">
                          <div className="flex items-start gap-3">
                            <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                              <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                              </svg>
                            </div>
                            <div className="flex-1">
                              <h4 className="font-bold text-blue-900 text-lg mb-2">OUTREACH</h4>
                              <p className="text-blue-800 font-medium mb-3">
                                Outreach group and request a revised application with the missing responses to required questions.
                              </p>
                              <button
                                onClick={() => handleAddOutreachNote('Outreach group and request a revised application with the missing responses to required questions (Questions 21-23).')}
                                className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                </svg>
                                Add to Notes
                              </button>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  ) : currentPageData.id !== 'question-20' && currentPageData.id !== 'questions-21-23' ? (
                    <ul className="space-y-2">
                      {currentPageData.fields
                        .filter(f => {
                          if (!f.required) return false;
                          if (f.showWhen) {
                            return formData[f.showWhen.field] === f.showWhen.value;
                          }
                          return true;
                        })
                        .map(field => {
                          const value = formData[field.name] || (field.type === 'checkbox' ? false : '');
                          const isValid = field.validation ? field.validation(value) : !!value;
                          return (
                            <li key={field.name} className="flex items-start text-sm">
                              <CheckCircle2
                                className={`w-4 h-4 mr-2 mt-0.5 flex-shrink-0 ${
                                  isValid ? 'text-green-500' : 'text-slate-300'
                                }`}
                              />
                              <span className={isValid ? 'text-slate-700' : 'text-slate-400'}>
                                {field.type === 'checkbox' ? (typeof field.label === 'function' ? field.label(formData) : field.label) : `Complete: ${typeof field.label === 'function' ? field.label(formData) : field.label}`}
                              </span>
                            </li>
                          );
                        })}
                    </ul>
                  ) : null}
                </div>
                )}
              </div>

              {/* Navigation */}
              <div className="p-8 bg-slate-50 border-t border-slate-200 flex justify-between items-center">
                {currentPageData.isCompletionPage ? (
                  <>
                    {/* Completion Page Buttons */}
                    <button
                      onClick={handleDownloadNotes}
                      className="flex items-center gap-2 px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:shadow-lg hover:scale-105 transition-all"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                      </svg>
                      Download Notes
                    </button>
                    <button
                      onClick={handleStartNewApplication}
                      className="flex items-center gap-2 px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:shadow-lg hover:scale-105 transition-all"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                      </svg>
                      Start New Application
                    </button>
                  </>
                ) : (
                  <>
                    {/* Regular Navigation */}
                    {currentPage === 0 ? (
                      <a
                        href="./index.html"
                        className="flex items-center gap-4 px-4 py-2 rounded-lg font-semibold text-sm text-slate-700 hover:bg-slate-200 transition-all"
                      >
                        <ChevronLeft className="w-4 h-4" />
                        Go to Home
                      </a>
                    ) : (
                      <button
                        onClick={handlePrevious}
                        className="flex items-center gap-4 px-4 py-2 rounded-lg font-semibold text-sm text-slate-700 hover:bg-slate-200 transition-all"
                      >
                        <ChevronLeft className="w-4 h-4" />
                        Previous
                      </button>
                    )}

                    <button
                      onClick={() => setShowViewNotesModal(true)}
                      className="relative flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm bg-gradient-to-r from-amber-500 to-orange-500 text-white hover:from-amber-600 hover:to-orange-600 transition-all hover:shadow-lg"
                    >
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Your Notes
                      {outreachNotes.length > 0 && (
                        <span className="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                          {outreachNotes.length}
                        </span>
                      )}
                    </button>

                    {enrolledProviders.length > 0 && (
                      <button
                        onClick={() => setShowEnrolledProvidersModal(true)}
                        className="relative flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:from-green-600 hover:to-emerald-600 transition-all hover:shadow-lg"
                      >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        Enrolled Providers
                        <span className="absolute -top-1.5 -right-1.5 bg-blue-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                          {enrolledProviders.length}
                        </span>
                      </button>
                    )}

                    <button
                      onClick={
                        currentPageData.id === 'next-provider-ready-check'
                          ? handleNext
                          : (isLastPage ? handleSubmit : handleNext)
                      }
                      disabled={!canProceed}
                      className={`btn-primary flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition-all text-white hover:shadow-lg hover:scale-105 ${
                        canProceed
                          ? ''
                          : 'bg-slate-300 text-slate-500 cursor-not-allowed'
                      }`}
                      style={canProceed ? (isLastPage ? {background: 'linear-gradient(to right, #059669, #10b981)'} : {background: 'linear-gradient(to right, var(--gainwell-teal), var(--gainwell-dark))'}) : {}}
                    >
                      {getNextButtonText()}
                      {!isLastPage && <ChevronRight className="w-4 h-4" />}
                    </button>
                  </>
                )}
              </div>
            </div>
          </div>

          {/* ==================== MODAL COMPONENTS ==================== */}

          {/* Image Modal */}
          {showImageModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowImageModal(false)}
            >
              <div className="relative">
                <button
                  onClick={() => setShowImageModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <img
                  src={
                    currentPageData.id === 'group-practice' ? groupPracticeAppImage :
                    currentPageData.id === 'question-6' ? question6Image :
                    currentPageData.id === 'payto-mailto' ? paytoMailtoImage :
                    currentPageData.id === 'questions-9-17' ? contactInfoImage :
                    currentPageData.id === 'email-to-snow' ? emailFieldImage :
                    currentPageData.id === 'question-20' ? practitionersImage :
                    currentPageData.id === 'existing-provider-questions-21-23' ? questions21to24Image :
                    currentPageData.displayImage ? currentPageData.displayImage :
                    questions21to24Image
                  }
                  alt={
                    currentPageData.id === 'group-practice' ? 'Group Practice Application Example' :
                    currentPageData.id === 'question-6' ? 'Question 6 Example' :
                    currentPageData.id === 'payto-mailto' ? 'Pay To / Mail To Address Example' :
                    currentPageData.id === 'questions-9-17' ? 'Contact Information Example' :
                    currentPageData.id === 'email-to-snow' ? 'Email Field Example' :
                    currentPageData.id === 'question-20' ? 'Practitioners Example' :
                    currentPageData.id === 'existing-provider-questions-21-23' ? 'Questions 21-24 Example' :
                    'Example Image'
                  }
                  className="modal-image"
                  onClick={(e) => e.stopPropagation()}
                />
              </div>
            </div>
          )}

          {/* Next Steps Modal */}
          {showNextStepsModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowNextStepsModal(false)}
            >
              <div className="relative max-w-4xl" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowNextStepsModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-6 max-h-[80vh] overflow-y-auto">
                  <h2 className="text-2xl font-bold text-indigo-900 mb-4">Next Steps</h2>
                  <img
                    src={paytoMailtoCICSImage}
                    alt="Pay To / Mail To CICS Screen"
                    className="w-full rounded-lg border border-slate-200 mb-4"
                  />
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <p className="text-slate-800 font-medium mb-2">
                      Under the group in CICS, Check if the Pay To Address or Mail To Address is different from what is listed on the application, and update them if necessary.
                    </p>
                    <p className="text-slate-700">
                      From the 02 screen in CICS, hit F5 three times to reach the Pay To and Mail To addresses
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Outreach Notes Modal */}
          {showOutreachModal && (
            <div
              className="modal-overlay"
              onClick={cancelAddOutreachNote}
            >
              <div className="relative max-w-2xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={cancelAddOutreachNote}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-8 shadow-2xl">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-blue-100 rounded-full p-3">
                      <svg className="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                      </svg>
                    </div>
                    <div className="flex-1">
                      <h2 className="text-2xl font-bold text-slate-900 mb-2">Add Outreach Note</h2>
                      <p className="text-slate-600 text-sm">This outreach reason will be added to your notes list.</p>
                    </div>
                  </div>

                  <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                    <p className="text-slate-800 font-medium leading-relaxed">
                      {currentOutreachReason}
                    </p>
                  </div>

                  <div className="flex gap-3 justify-end">
                    <button
                      onClick={cancelAddOutreachNote}
                      className="px-6 py-3 rounded-lg font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={confirmAddOutreachNote}
                      className="px-6 py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transition-all hover:shadow-lg"
                    >
                      Add to Notes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* View Notes Modal */}
          {showViewNotesModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowViewNotesModal(false)}
            >
              <div className="relative max-w-3xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowViewNotesModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-8 shadow-2xl max-h-[80vh] overflow-y-auto">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-amber-100 rounded-full p-3">
                      <svg className="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                    </div>
                    <div className="flex-1">
                      <h2 className="text-3xl font-bold text-slate-900 mb-2">Your Outreach Notes</h2>
                      <p className="text-slate-600">Review and manage your accumulated outreach reasons.</p>
                    </div>
                  </div>

                  {outreachNotes.length === 0 ? (
                    <div className="bg-slate-50 border-2 border-dashed border-slate-300 rounded-lg p-12 text-center">
                      <svg className="w-16 h-16 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      <h3 className="text-xl font-semibold text-slate-700 mb-2">No Notes Yet</h3>
                      <p className="text-slate-500">
                        When you encounter outreach messages, click "Add to Notes" to track them here.
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {outreachNotes.map((note, index) => (
                        <div key={index} className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 flex items-start gap-3 group hover:border-blue-300 transition-all">
                          <div className="flex-shrink-0 mt-1">
                            <div className="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
                              {index + 1}
                            </div>
                          </div>
                          <p className="flex-1 text-slate-800 font-medium leading-relaxed">
                            {note}
                          </p>
                          <button
                            onClick={() => handleRemoveNote(index)}
                            className="flex-shrink-0 text-red-500 hover:text-red-700 hover:bg-red-100 rounded-lg p-2 transition-all opacity-0 group-hover:opacity-100"
                            title="Remove this note"
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </button>
                        </div>
                      ))}
                    </div>
                  )}

                  <div className="mt-8 flex justify-between items-center">
                    <button
                      onClick={handleDownloadOutreachNotes}
                      className="px-6 py-3 rounded-lg font-semibold text-amber-700 bg-white border-2 border-amber-500 hover:bg-amber-50 transition-all hover:shadow-lg flex items-center gap-2"
                      disabled={outreachNotes.length === 0}
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Export Notes
                    </button>
                    <button
                      onClick={() => setShowViewNotesModal(false)}
                      className="px-8 py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 transition-all hover:shadow-lg"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Enrolled Providers Modal */}
          {showEnrolledProvidersModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowEnrolledProvidersModal(false)}
            >
              <div className="relative max-w-4xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowEnrolledProvidersModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-8 shadow-2xl max-h-[80vh] overflow-y-auto">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-green-100 rounded-full p-3">
                      <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                    </div>
                    <div className="flex-1">
                      <h2 className="text-3xl font-bold text-slate-900 mb-2">Enrolled Providers</h2>
                      <p className="text-slate-600">Review the providers you have successfully enrolled ({enrolledProviders.length} total).</p>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {enrolledProviders.map((provider, index) => (
                      <div key={index} className={`bg-gradient-to-br ${
                        index === currentEnrollingProviderIndex
                          ? 'from-blue-50 to-indigo-50 border-2 border-blue-400 ring-2 ring-blue-300'
                          : index === currentAddingProviderIndex
                          ? 'from-purple-50 to-violet-50 border-2 border-purple-400 ring-2 ring-purple-300'
                          : 'from-green-50 to-emerald-50 border-2 border-green-200'
                      } rounded-lg p-6 hover:border-green-300 transition-all`}>
                        <div className="mb-4">
                          <div className="flex items-center gap-3 mb-2">
                            <div className={`${
                              index === currentEnrollingProviderIndex
                                ? 'bg-blue-500'
                                : index === currentAddingProviderIndex
                                ? 'bg-purple-500'
                                : 'bg-green-500'
                            } text-white rounded-full w-8 h-8 flex items-center justify-center text-lg font-bold`}>
                              {index + 1}
                            </div>
                            <h3 className="text-xl font-bold text-slate-900">
                              Provider {index + 1}
                              {index === currentEnrollingProviderIndex && (
                                <span className="ml-2 text-sm font-normal text-blue-600">(Currently Enrolling)</span>
                              )}
                              {index === currentAddingProviderIndex && (
                                <span className="ml-2 text-sm font-normal text-purple-600">(Currently Being Added to Group)</span>
                              )}
                            </h3>
                          </div>
                          <div className="ml-11">
                            <span className={`inline-block px-3 py-1 text-xs font-bold rounded-full ${
                              provider.status === 'Complete - Enrolled and Added to Group'
                                ? 'bg-emerald-600 text-white'
                                : provider.status === 'Enrolled - Ready to be Added to Group'
                                ? 'bg-green-500 text-white'
                                : provider.status === 'Verified - Ready to Enroll'
                                ? 'bg-blue-500 text-white'
                                : provider.status === 'Verified - Ready to Add to Group'
                                ? 'bg-indigo-500 text-white'
                                : provider.status === 'Verified - Already in the Group'
                                ? 'bg-gray-500 text-white'
                                : 'bg-yellow-500 text-white'
                            }`}>
                              {provider.status || 'Verified - Ready to Enroll'}
                            </span>
                          </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                          <div className="flex items-start gap-2">
                            <svg className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-slate-700">
                              <span className="font-semibold">Enrollment Created:</span> {provider.createEnrollmentComplete ? 'Yes' : 'No'}
                            </span>
                          </div>
                          <div className="flex items-start gap-2">
                            <svg className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-slate-700">
                              <span className="font-semibold">Provider Info:</span> {provider.providerInfoComplete ? 'Complete' : 'Incomplete'}
                            </span>
                          </div>
                          <div className="flex items-start gap-2">
                            <svg className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-slate-700">
                              <span className="font-semibold">Group Specialties:</span> {provider.groupSpecialtiesChecked ? 'Verified' : 'Not Verified'}
                            </span>
                          </div>
                          <div className="flex items-start gap-2">
                            <svg className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-slate-700">
                              <span className="font-semibold">Mainframe Enrollment:</span> {provider.enrollOnMainframeComplete ? 'Complete' : 'Incomplete'}
                            </span>
                          </div>
                        </div>

                        <div className="mt-4 pt-4 border-t border-green-200">
                          <details className="cursor-pointer">
                            <summary className="text-sm font-semibold text-green-700 hover:text-green-800">
                              View All Details
                            </summary>
                            <div className="mt-3 pl-4 space-y-2 text-sm text-slate-600">
                              <div> Enrollment Tab: {provider.enrollmentTabComplete ? '' : ''}</div>
                              <div> Provider Name: {provider.providerNameCorrect ? '' : ''}</div>
                              <div> Provider Type: {provider.providerTypeCorrect ? '' : ''}</div>
                              <div> Application Date: {provider.applicationDateAdded ? '' : ''}</div>
                              <div> Cancel Reason Code: {provider.cancelReasonCode ? '' : ''}</div>
                              <div> Provider Address: {provider.providerAddressComplete ? '' : ''}</div>
                              <div> Payment/Mailing Address: {provider.paymentMailingAddressComplete ? '' : ''}</div>
                              <div> Provider Info Tab: {provider.providerInfoTabComplete ? '' : ''}</div>
                              <div> NPI Tab: {provider.npiTabComplete ? '' : ''}</div>
                              <div> Specialty Tab: {provider.specialtyTabComplete ? '' : ''}</div>
                              <div> Claim Type Tab: {provider.claimTypeTabComplete ? '' : ''}</div>
                              <div> License/DEA Tab: {provider.licenseDeaTabComplete ? '' : ''}</div>
                            </div>
                          </details>
                        </div>

                        <div className="mt-4 pt-4 border-t border-indigo-200">
                          <div className="flex items-center gap-2 mb-3">
                            <svg className="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            <label htmlFor={`manual-note-${index}`} className="text-sm font-semibold text-indigo-800">Manual Notes</label>
                          </div>
                          <textarea
                            id={`manual-note-${index}`}
                            value={providerManualNotes[index] || ''}
                            onChange={(e) => handleProviderManualNoteChange(index, e.target.value)}
                            placeholder="Add any additional notes about this provider..."
                            className="w-full px-4 py-3 border-2 border-indigo-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all text-sm text-slate-700 placeholder-slate-400 resize-none"
                            rows="3"
                          />
                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="mt-8 flex justify-between items-center">
                    <button
                      onClick={handleDownloadEnrolledProviders}
                      className="px-6 py-3 rounded-lg font-semibold text-green-700 bg-white border-2 border-green-500 hover:bg-green-50 transition-all hover:shadow-lg flex items-center gap-2"
                      disabled={enrolledProviders.length === 0}
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Export Providers
                    </button>
                    <button
                      onClick={() => setShowEnrolledProvidersModal(false)}
                      className="px-8 py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 transition-all hover:shadow-lg"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Custom Confirmation Dialog */}
          {confirmDialog.show && (
            <div
              className="modal-overlay"
              onClick={confirmDialog.onCancel}
            >
              <div className="relative max-w-md w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <div className="bg-slate-800 text-white rounded-xl p-6 shadow-2xl border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">This page says</h3>
                  <p className="text-slate-200 mb-6 whitespace-pre-line leading-relaxed">{confirmDialog.message}</p>
                  <div className="flex gap-3 justify-end">
                    <button
                      onClick={confirmDialog.onCancel}
                      className="px-6 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors font-medium"
                    >
                      No
                    </button>
                    <button
                      onClick={confirmDialog.onConfirm}
                      className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors font-medium"
                      autoFocus
                    >
                      Yes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Custom Alert Dialog */}
          {alertDialog.show && (
            <div
              className="modal-overlay"
              onClick={alertDialog.onClose}
            >
              <div className="relative max-w-md w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <div className="bg-slate-800 text-white rounded-xl p-6 shadow-2xl border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">This page says</h3>
                  <p className="text-slate-200 mb-6 whitespace-pre-line leading-relaxed">{alertDialog.message}</p>
                  <div className="flex justify-end">
                    <button
                      onClick={alertDialog.onClose}
                      className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors font-medium"
                      autoFocus
                    >
                      OK
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ============================================================
    // APPLICATION INITIALIZATION
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WalkthroughForm />);
  </script>
</body>
</html>
