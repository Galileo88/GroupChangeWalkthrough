<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Group Change Walkthrough Form</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <!-- PDF Modal (Full Screen) -->
  <div id="pdf-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 10000;">
    <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column;">
      <div style="padding: 16px 24px; border-bottom: 2px solid #2a3f4a; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(to right, #3d5a66, #2a3f4a); box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
        <h2 id="pdf-modal-title" style="margin: 0; font-size: 18px; font-weight: 700; color: white;">PDF Viewer</h2>
        <button onclick="closePdfModal()" style="background: #dc3545; color: white; border: none; font-size: 16px; font-weight: 600; cursor: pointer; padding: 10px 20px; border-radius: 6px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);" onmouseover="this.style.background='#c82333'; this.style.boxShadow='0 4px 8px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.background='#dc3545'; this.style.boxShadow='0 2px 4px rgba(220, 53, 69, 0.3)'">âœ• Close</button>
      </div>
      <iframe id="pdf-iframe" style="flex: 1; border: none; width: 100%; height: 100%;"></iframe>
    </div>
  </div>

  <script type="text/babel">
    const { useState } = React;

    // ============================================================
    // PDF MODAL FUNCTIONS
    // ============================================================

    window.openPdfModal = (pdfUrl, title) => {
      const modal = document.getElementById('pdf-modal');
      const iframe = document.getElementById('pdf-iframe');
      const titleEl = document.getElementById('pdf-modal-title');

      iframe.src = pdfUrl;
      titleEl.textContent = title || 'PDF Viewer';
      modal.style.display = 'block';
    };

    window.closePdfModal = () => {
      const modal = document.getElementById('pdf-modal');
      const iframe = document.getElementById('pdf-iframe');

      modal.style.display = 'none';
      iframe.src = '';
    };

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const modal = document.getElementById('pdf-modal');
        if (modal.style.display === 'block') {
          closePdfModal();
        }
      }
    });

    // ============================================================
    // ICON COMPONENTS
    // ============================================================

    const ChevronRight = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
      </svg>
    );

    const ChevronLeft = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
      </svg>
    );

    const CheckCircle2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const Circle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" strokeWidth={2} />
      </svg>
    );

    const X = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
      </svg>
    );

    const Sun = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
    );

    const Moon = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
      </svg>
    );

    // ============================================================
    // MAIN FORM COMPONENT
    // ============================================================

    const WalkthroughForm = () => {

      // -------------------- State Variables --------------------
      const [currentPage, setCurrentPage] = useState(0);
      const [formData, setFormData] = useState({});
      const [showNextStepsModal, setShowNextStepsModal] = useState(false);
      const [outreachNotes, setOutreachNotes] = useState([]);
      const [showOutreachModal, setShowOutreachModal] = useState(false);
      const [currentOutreachReason, setCurrentOutreachReason] = useState('');
      const [showViewNotesModal, setShowViewNotesModal] = useState(false);
      const [enrolledProviders, setEnrolledProviders] = useState([]);
      const [showEnrolledProvidersModal, setShowEnrolledProvidersModal] = useState(false);
      const [expandedProvider, setExpandedProvider] = useState(null);
      const [providerManualNotes, setProviderManualNotes] = useState({});
      const [currentEnrollingProviderIndex, setCurrentEnrollingProviderIndex] = useState(null);
      const [currentAddingProviderIndex, setCurrentAddingProviderIndex] = useState(null);
      const [visitedPages, setVisitedPages] = useState(new Set([0]));
      const [unableToVerifyFields, setUnableToVerifyFields] = useState(new Set());
      const [pendingUnableToVerifyField, setPendingUnableToVerifyField] = useState(null);
      const [confirmDialog, setConfirmDialog] = useState({ show: false, message: '', onConfirm: null, onCancel: null });
      const [alertDialog, setAlertDialog] = useState({ show: false, message: '', onClose: null });
      const [saveStatus, setSaveStatus] = useState({ saving: false, lastSaved: null, error: null });
      const [isDarkMode, setIsDarkMode] = useState(() => {
        return localStorage.getItem('theme') === 'dark';
      });

      // -------------------- Dark Mode Effect --------------------
      React.useEffect(() => {
        if (isDarkMode) {
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        } else {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        }
      }, [isDarkMode]);

      // -------------------- Auto-save Effect --------------------
      // Debounced auto-save when critical state changes
      const saveTimeoutRef = React.useRef(null);

      React.useEffect(() => {
        // Clear any existing timeout
        if (saveTimeoutRef.current) {
          clearTimeout(saveTimeoutRef.current);
        }

        // Set a new timeout for auto-save
        saveTimeoutRef.current = setTimeout(() => {
          const pwoNumber = formData.pwoNumber;
          const currentPageId = pages[currentPage]?.id;

          if (pwoNumber && currentPageId !== 'start-choice' && currentPageId !== 'resume-lookup') {
            saveApplicationState(pwoNumber);
          }
        }, 1000); // 1 second debounce

        // Cleanup timeout on unmount
        return () => {
          if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
          }
        };
      }, [formData, enrolledProviders, outreachNotes, providerManualNotes, unableToVerifyFields, currentPage, currentEnrollingProviderIndex, currentAddingProviderIndex]);

      // -------------------- Update Last Provider Status on Final Completion --------------------
      React.useEffect(() => {
        const currentPageId = pages[currentPage]?.id;

        if (currentPageId === 'final-completion' && currentAddingProviderIndex !== null) {
          // Update the last provider's status when landing on final completion page
          setEnrolledProviders(prev => {
            const updated = [...prev];
            if (updated[currentAddingProviderIndex]) {
              // Preserve all existing provider completion fields from formData before changing status
              updated[currentAddingProviderIndex] = {
                ...updated[currentAddingProviderIndex],
                existingProviderOpenCicsComplete: formData.existingProviderOpenCicsComplete || updated[currentAddingProviderIndex].existingProviderOpenCicsComplete,
                existingProviderAddToGroupComplete: formData.existingProviderAddToGroupComplete || updated[currentAddingProviderIndex].existingProviderAddToGroupComplete,
                providerNameFormatting02: formData.providerNameFormatting02 || updated[currentAddingProviderIndex].providerNameFormatting02,
                mailToPayToAddresses: formData.mailToPayToAddresses || updated[currentAddingProviderIndex].mailToPayToAddresses,
                cancelCodes: formData.cancelCodes || updated[currentAddingProviderIndex].cancelCodes,
                effectiveDates: formData.effectiveDates || updated[currentAddingProviderIndex].effectiveDates,
                boardCertificationIndicators: formData.boardCertificationIndicators || updated[currentAddingProviderIndex].boardCertificationIndicators,
                programCode54PA: formData.programCode54PA || updated[currentAddingProviderIndex].programCode54PA,
                existingProviderCloseEnrollmentComplete: formData.existingProviderCloseEnrollmentComplete || updated[currentAddingProviderIndex].existingProviderCloseEnrollmentComplete,
                existingProviderFinishGroupChangeComplete: formData.existingProviderFinishGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderFinishGroupChangeComplete,
                existingProviderCreateChecklistComplete: formData.existingProviderCreateChecklistComplete || updated[currentAddingProviderIndex].existingProviderCreateChecklistComplete,
                existingProviderApproveGroupChangeComplete: formData.existingProviderApproveGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderApproveGroupChangeComplete,
                existingProviderOpenLetterTaskComplete: formData.existingProviderOpenLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderOpenLetterTaskComplete,
                existingProviderSelectLetterComplete: formData.existingProviderSelectLetterComplete || updated[currentAddingProviderIndex].existingProviderSelectLetterComplete,
                existingProviderAddToLetterComplete: formData.existingProviderAddToLetterComplete || updated[currentAddingProviderIndex].existingProviderAddToLetterComplete,
                existingProviderFinishLetterComplete: formData.existingProviderFinishLetterComplete || updated[currentAddingProviderIndex].existingProviderFinishLetterComplete,
                existingProviderCloseLetterTaskComplete: formData.existingProviderCloseLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderCloseLetterTaskComplete,
                status: 'Complete - Enrolled and Added to Group'
              };
            }
            return updated;
          });
        }
      }, [currentPage]);

      // -------------------- Reference Images --------------------
      const groupPracticeAppImage = './images/groupchange_application.jpg';
      const question6Image = './images/question6.jpg';
      const paytoMailtoImage = './images/payto_mailto.jpg';
      const paytoMailtoCICSImage = './images/payto_mailto_CICS.png';
      const contactInfoImage = './images/contactinfo.jpg';
      const emailFieldImage = './images/emailfield.png';
      const practitionersImage = './images/practitioners.jpg';
      const questions21to24Image = './images/21_24.jpg';
      const createEnrollmentImage = './images/CreateEnrollment.png';
      const newProviderWindowImage = './images/newproviderwindow.png';
      const groupSpecialtyImage = './images/groupspecialty.png';
      const enrollmentTabImage = './images/enrollmenttab.png';
      const providerAddressImage = './images/provideraddress.png';
      const mailingAddressImage = './images/mailingaddress.png';
      const providerInfoTabImage = './images/providerinfotab.jpg';
      const npiTabImage = './images/npitab.png';
      const specTabImage = './images/spectab.png';
      const claimTabImage = './images/claimtab.png';
      const licenseDeaTabImage = './images/lictab.png';
      const mainframeImage = './images/mainframe.png';
      const cicsImage = './images/CICS.png';
      const addProvImage = './images/addprov.png';
      const enrollmentTaskImage = './images/enrollmenttask.png';
      const checklistImage = './images/checklist.png';
      const addToGroupImage = './images/addtogroup.png';
      const letterTaskImage = './images/lettertask.png';
      const letterSelectImage = './images/letterselect.png';
      const letterProvImage = './images/letterprov.png';
      const generateLetterImage = './images/generateletter.png';
      const closeLetterImage = './images/closeletter.png';
      const sigAuthImage = './images/sigauth.jpg';
      const aouImage = './images/aou.jpg';
      const provAgreementImage = './images/provagreement.jpg';
      const dooImage = './images/doo.jpg';
      const w9Image = './images/w9.jpg';
      const achImage = './images/ACH.jpg';
      const paperUpdatesImage = './images/paperupdates.jpg';

      // -------------------- Helper Functions --------------------

      // Custom confirmation dialog
      const showConfirm = (message) => {
        return new Promise((resolve) => {
          setConfirmDialog({
            show: true,
            message,
            onConfirm: () => {
              setConfirmDialog({ show: false, message: '', onConfirm: null, onCancel: null });
              resolve(true);
            },
            onCancel: () => {
              setConfirmDialog({ show: false, message: '', onConfirm: null, onCancel: null });
              resolve(false);
            }
          });
        });
      };

      // Custom alert dialog
      const showAlert = (message) => {
        return new Promise((resolve) => {
          setAlertDialog({
            show: true,
            message,
            onClose: () => {
              setAlertDialog({ show: false, message: '', onClose: null });
              resolve();
            }
          });
        });
      };

      // -------------------- Save/Load Utilities --------------------

      const STORAGE_PREFIX = 'pwo-application-';

      // Check if we're running in Tauri and get the invoke function
      const isTauri = typeof window !== 'undefined' && window.__TAURI__;
      const tauriInvoke = isTauri ? (
        window.__TAURI__.invoke ||
        window.__TAURI__.tauri?.invoke ||
        window.__TAURI_INTERNALS__?.invoke ||
        null
      ) : null;

      // Debug: Log what's available
      React.useEffect(() => {
        if (isTauri) {
          // Tauri detection check
        }
      }, []);

      const saveApplicationState = async (pwoNumber) => {
        if (!pwoNumber) return;

        const stateToSave = {
          pwo_number: pwoNumber,
          user_name: formData.userName || '',
          current_page: currentPage.toString(),
          form_data: formData,
          enrolled_providers: enrolledProviders,
          outreach_notes: outreachNotes,
          provider_manual_notes: providerManualNotes,
          unable_to_verify_fields: Array.from(unableToVerifyFields).map(f => String(f)),
          visited_pages: Array.from(visitedPages).map(p => String(p)),
          current_enrolling_provider_index: currentEnrollingProviderIndex ?? -1,
          current_adding_provider_index: currentAddingProviderIndex ?? -1,
          last_saved: new Date().toISOString(),
          has_outreach: enrolledProviders.some(p => p.status === 'Unable to Verify - Requires Outreach')
        };

        try {
          setSaveStatus({ saving: true, lastSaved: null, error: null });

          if (tauriInvoke) {
            // Use Tauri's invoke to save to filesystem
            const result = await tauriInvoke('save_pwo_state', { state: stateToSave });
            setSaveStatus({ saving: false, lastSaved: new Date(), error: null });
          } else {
            // Fallback to localStorage for web version
            localStorage.setItem(`${STORAGE_PREFIX}${pwoNumber}`, JSON.stringify(stateToSave));
            setSaveStatus({ saving: false, lastSaved: new Date(), error: null });
          }
        } catch (error) {
          const errorMsg = typeof error === 'string' ? error : (error.message || error.toString() || 'Save failed');
          setSaveStatus({ saving: false, lastSaved: null, error: errorMsg });
        }
      };

      const loadApplicationState = async (pwoNumber) => {
        if (!pwoNumber) return null;

        try {
          if (tauriInvoke) {
            // Use Tauri's invoke to load from filesystem
            const state = await tauriInvoke('load_pwo_state', { pwoNumber });
            return {
              pwoNumber: state.pwo_number,
              userName: state.user_name,
              currentPage: parseInt(state.current_page),
              formData: state.form_data,
              enrolledProviders: state.enrolled_providers,
              outreachNotes: state.outreach_notes,
              providerManualNotes: state.provider_manual_notes,
              unableToVerifyFields: state.unable_to_verify_fields,
              visitedPages: state.visited_pages.map(p => parseInt(p)),
              currentEnrollingProviderIndex: state.current_enrolling_provider_index,
              currentAddingProviderIndex: state.current_adding_provider_index,
              lastSaved: state.last_saved,
              hasOutreach: state.has_outreach
            };
          } else {
            // Fallback to localStorage for web version
            const saved = localStorage.getItem(`${STORAGE_PREFIX}${pwoNumber}`);
            return saved ? JSON.parse(saved) : null;
          }
        } catch (error) {
          return null;
        }
      };

      const deleteApplicationState = async (pwoNumber) => {
        if (!pwoNumber) return;

        try {
          if (tauriInvoke) {
            // Use Tauri's invoke to delete from filesystem
            const result = await tauriInvoke('delete_pwo_state', { pwoNumber });
          } else {
            // Fallback to localStorage for web version
            localStorage.removeItem(`${STORAGE_PREFIX}${pwoNumber}`);
          }
        } catch (error) {
          // Delete failed
        }
      };

      // Helper function to open external URLs and PDFs
      const openExternalUrl = async (url, title = 'PDF Viewer') => {
        if (!url) return;

        try {
          // Check if it's a PDF - open in modal
          if (url.endsWith('.pdf')) {
            window.openPdfModal(url, title);
            return;
          }

          // For non-PDF URLs, open externally
          if (tauriInvoke) {
            await tauriInvoke('open_url', { url });
          } else {
            window.open(url, '_blank', 'noopener,noreferrer');
          }
        } catch (error) {
          // Failed to open URL
        }
      };

      // ============================================================
      // PAGES CONFIGURATION (46 Pages - Added Start Choice & Resume Lookup)
      // ============================================================
      // This section defines all the walkthrough pages and their
      // fields, validation rules, and conditional display logic.
      // ============================================================

      const pages = [
        // -------------------- Save/Resume Pages --------------------
        {
          id: 'start-choice',
          title: 'Provider Enrollment Walkthrough',
          description: 'Would you like to start a new application or continue a saved one?',
          fields: [
            {
              name: 'applicationChoice',
              label: 'Choose an option',
              type: 'radio',
              required: true,
              options: [
                'Start New Application',
                'Continue Saved Application'
              ]
            }
          ]
        },
        {
          id: 'resume-lookup',
          title: 'Continue Saved Application',
          description: 'Enter your PWO# to load your saved application',
          showWhen: { field: 'applicationChoice', value: 'Continue Saved Application' },
          fields: [
            {
              name: 'resumePwoNumber',
              label: 'PWO #',
              type: 'text',
              required: true,
              placeholder: 'PWO1234567',
              validation: (value) => {
                if (!value) return false;
                const pwoPattern = /^PWO\d{7}$/;
                return pwoPattern.test(value.trim().toUpperCase());
              },
              validationMessage: 'PWO number must be in format: PWO followed by 7 digits (e.g., PWO1234567)'
            }
          ]
        },

        // -------------------- Initial Setup Pages --------------------
        {
          id: 'welcome',
          title: 'Welcome',
          description: 'Let\'s get started with your walkthrough',
          showWhen: { field: 'applicationChoice', value: 'Start New Application' },
          fields: [
            {
              name: 'userName',
              label: 'Your Name',
              type: 'text',
              required: true,
              placeholder: 'Enter your full name',
              validation: (value) => value && value.length >= 2
            },
            {
              name: 'pwoNumber',
              label: 'PWO #',
              type: 'text',
              required: true,
              placeholder: 'PWO1234567',
              validation: (value) => {
                if (!value) return false;
                const pwoPattern = /^PWO\d{7}$/;
                return pwoPattern.test(value.trim().toUpperCase());
              },
              validationMessage: 'PWO number must be in format: PWO followed by 7 digits (e.g., PWO1234567)'
            }
          ]
        },
        {
          id: 'group-practice',
          title: 'Group Practice Application',
          description: 'Please confirm the application details',
          fields: [
            {
              name: 'groupPracticeAttached',
              label: 'Does the application have the Group Practice Application attached?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            },
            {
              name: 'questionsAnswered',
              label: 'Are questions 2, 4, 5 and 5C answered on the Group Change Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'groupPracticeAttached', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Questions 2, 4, 5, 5C are required to be answered. Compare the list from question 5 and 5C to CICS pg13.',
                'If the group is a non-profit, they will not have owners. They will have "controlling interests" and will have an ownership type of "C" on the ownership page in CICS. Controlling interests can be treated like managing employees and can be added at any time.',
                'If they are not a non-profit, and question 5 includes an owner that is not listed on the ownership file on pg13 in CICS, this may be a CHOW. Please let leadership know so they can advise you on next steps.',
                'Individuals list under question 5C should also be listed on the ownership file on pg13 in CICS. If an individual is not listed in CICS on pg13, we will add them with a status of "S" indicated they are managing staff.'
              ]
            }
          ],
          displayImage: groupPracticeAppImage
        },
        {
          id: 'question-6',
          title: 'Practice Address Verification',
          description: 'Verify practice address information',
          fields: [
            {
              name: 'question6Answered',
              label: 'Is question 6 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Check the groups addresses to ensure this practice address exists. The 09 page in CICS shows a list of 8 practice addresses.',
                'If you cannot locate the address on the 09 page or in the event the 09 page is full, navigate to the notes page (F6) and look through the notes to see if the address can be found there.',
                'If not, you will add the new practice address to the notes screen.'
              ]
            }
          ],
          displayImage: question6Image
        },
        {
          id: 'payto-mailto',
          title: 'Pay To / Mail To Address',
          description: 'Verify Pay To and Mail To address information',
          fields: [
            {
              name: 'paytoMailtoMatch',
              label: 'Does the pay-to and mail-to address on questions 7 and 8 in the Group Practice Application match what we have in CICS for the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            },
            {
              name: 'paytoMailtoComplete',			
              label: 'Complete: Update the mail-to and pay-to addresses in CICS to match the application.',
              type: 'checkbox',
              required: true,
              showWhen: { field: 'paytoMailtoMatch', value: 'No' },
              validation: (value) => value === true,
              helperNotes: [
                'Update the mail-to and pay-to addresses in CICS to match the application.',
                'From the 02 screen in CICS, hit F5 three times to reach the Pay To and Mail To addresses.'
              ]
            }
          ],
          displayImage: paytoMailtoImage
        },
        {
          id: 'questions-9-17',
          title: 'Additional Questions Verification',
          description: 'Verify required questions are answered',
          fields: [
            {
              name: 'questions9to17Answered',
              label: 'Are questions 9, 11, 12, 16 and 17 are answered?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No'
            }
          ],
          pageNotes: [
            'If questions 10, 13, 14, 15, 18 or 19 are answered and are different than what we have in CICS, we can add or update the information.',
            'If these optional questions are blank, it is ok and does not stop us from moving forward.',
            'If the group answers 18 and 19 provides a CLIA# or a Mammography Cert#, they should include a copy of the certificates attached to the application. If they do not include a copy of certificate, we cannot add it to CICS until they do.'
          ],
          displayImage: contactInfoImage
        },
        {
          id: 'email-to-snow',
          title: 'Add contact E-Mail to SNOW',
          description: 'Add contact email information to SNOW',
          fields: [
            {
              name: 'emailAddedToSNOW',
              label: 'Add the contact email information to the email field in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          pageNotes: [
            'If no contact email is provided, you will need to manually send out the letter by placing it in the S-Drive at the end.'
          ],
          displayImage: emailFieldImage
        },
        {
          id: 'question-20',
          title: 'Provider Info Verification',
          description: 'Verify provider information from Question 20',
          fields: [
            {
              name: 'question20Answered',
              label: 'Is question 20 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Practitioner Name, SSN, NPI and DOB are required.',
                'There may be multiple providers the group is trying to add, and they will all be listed within question 20 in sections A-H. If there are more providers than what the application can fit, additional pages will be attached.'
              ]
            },
            {
              name: 'providerAlreadyEnrolled',
              label: 'Is the provider already enrolled?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'question20Answered', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, this will be noted for the provider and you will proceed to the next question.',
                'If No, the checklist will be displayed.'
              ]
            },
            {
              name: 'providerInGroup',
              label: 'Is the provider already in the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'providerAlreadyEnrolled', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, you will be given the option to reject this as a duplicate application.',
                'If No, this will be noted for the provider and the checklist will be displayed.'
              ]
            },
            {
              name: 'ssnVerified',
              label: 'SSN - Verify SSN using SOVOS if a Social Security Card is not attached to the application',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              sovosUrl: 'https://taxport.sovos.com/login'
            },
            {
              name: 'dexSanctionsCheck',
              label: 'DEX and Sanctions in WVT - Check all providers being added',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'dobVerified',
              label: 'DOB - Verify DOB in PECOS (new providers may not be in PECOS, so just use their DOB on the application)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'npiVerified',
              label: 'NPI - Verify in either the WVT or at npiregistry.cms.hhs.gov to ensure the NPI belongs to the provider',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              npiRegistryUrl: 'https://npiregistry.cms.hhs.gov'
            },
            {
              name: 'licensesVerified',
              label: () => (
                <>
                  Licenses - APN, CRNA, CNM require RN license and APN license.
                  <br/><br/>
                  Doctors are required to have a copy of their license.
                </>
              ),
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              licenseVerifyUrl: 'https://miamifrp.com/verification/'
            },
            {
              name: 'boardCertificatesVerified',
              label: () => (
                <>
                  Board Certificates - APN, CRNA, CNM require board certificate.
                  <br/><br/>
                  Doctors are not required to provide a board certificate, but can be added and updated if included.
                </>
              ),
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true,
              licenseVerifyUrl: 'https://miamifrp.com/verification/'
            },
            {
              name: 'deaEffectiveDates',
              label: 'DEA effective dates - Compare expiration dates and update if newer. Add DEA information for new providers if attached',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'effectiveDatesChecked',
              label: 'Effective Dates - If no Requested Effective Date is provided, effective date goes one year back from stamped date (as long as license covers it)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.question20Answered === 'Yes' && (formData.providerAlreadyEnrolled === 'No' || (formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'No')),
              validation: (value) => value === true
            }
          ],
          displayImage: practitionersImage
        },
        // -------------------- Completion & Special Pages --------------------
        {
          id: 'question-20-unable-to-verify-completion',
          title: 'OUTREACH REQUIRED',
          description: 'Download notes to review.',
          instructionText: 'You have finished verifying all providers in this application, but based on your answers, there is missing information that needs to be outreached for.\n\nPlease download your notes to review all providers and outreach notes, then reach out to gather the missing information.\n\nOnce you have the required information, you can start a new application to complete the enrollment process.',
          isCompletionPage: true,
          fields: []
        },
        {
          id: 'duplicate-rejection-completion',
          title: 'APPLICATION REJECTED',
          description: 'Duplicate provider application rejected',
          instructionText: 'Application rejected as duplicate. The rejection has been added to the notes.\n\nYou can now:\n- Download the notes using the button below\n- Start a new application for another provider',
          isCompletionPage: true,
          isDuplicateRejection: true,
          fields: []
        },
        // -------------------- Additional Verification Pages --------------------
        {
          id: 'questions-21-23',
          title: 'Additional Questions (21-23 & 25) Verification',
          description: 'Verify questions 21, 22, 23 and 25 are answered correctly',
          fields: [
            {
              name: 'question21Answered',
              label: 'Are questions 21 a-e completed and further explained if necessary on the Group Practice Application?',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true,
              helperNotes: [
                'Questions 21 a-e must be completed and further explained, if necessary.',
                'If a question is answered "yes" and includes further explanation, it could be an Adverse Action situation and will need to be forwarded to the state. Please reach out to leadership to determine next steps.'
              ]
            },
            {
              name: 'question22Answered',
              label: 'Is question 22 answered on the Group Practice Application?',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true,
              helperNotes: [
                'Question 22 needs to be answered.',
                'If "Yes" is selected, an explanation is required.',
                'If they are currently employed, a list of hours and days of employment is needed.'
              ]
            },
            {
              name: 'question23Answered',
              label: 'Is question 23 answered on the Group Practice Application?',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true,
              helperNotes: [
                'Question 23 needs to be answered.',
                'If "Yes" is selected, an explanation is required.'
              ]
            },
            {
              name: 'question25Signed',
              label: 'Is question 25 signed and dated on the Group Practice Application?',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true,
              helperNotes: [
                'Question 25 must be signed and dated.'
              ]
            }
          ],
          displayImage: questions21to24Image
        },
        // -------------------- Required Forms Verification --------------------
        {
          id: 'signature-authorization-form',
          title: 'Signature Authorization Form',
          description: 'Does the app include the Signature Authorization Form attached?',
          fields: [
            {
              name: 'signatureAuthFormAttached',
              label: 'Does the app include the Signature Authorization Form attached?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Must have at least 1 authorized signer',
                'Provider Name, Typed or Printed Full name and Actual Signature is required'
              ]
            }
          ],
          displayImage: sigAuthImage
        },
        {
          id: 'agreement-of-understanding',
          title: 'Agreement of Understanding',
          description: 'Does the application have the Agreement of Understanding attached?',
          fields: [
            {
              name: 'agreementOfUnderstandingAttached',
              label: 'Does the application have the Agreement of Understanding attached?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Must be signed and dated'
              ]
            }
          ],
          displayImage: aouImage
        },
        {
          id: 'provider-agreement',
          title: 'Provider Agreement',
          description: 'Does the application have the Provider Agreement attached?',
          fields: [
            {
              name: 'providerAgreementAttached',
              label: 'Does the application have the Provider Agreement attached?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Provider Name at the top of the form must be the group name',
                'Must be signed and dated',
                'For Group applications, only the providers being linked to the group should sign and date',
                'If there are more providers being added than there are spots on the form, a copy of this page with the additional providers should be attached'
              ]
            }
          ],
          displayImage: provAgreementImage
        },
        {
          id: 'disclosure-of-ownership',
          title: 'Disclosure of Ownership',
          description: 'Does the application have the Disclosure of Ownership attached? (form FD452)',
          fields: [
            {
              name: 'disclosureOfOwnershipAttached',
              label: 'Does the application have the Disclosure of Ownership attached? (form FD452)',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'All fields are required to be filled out',
                'N/A should be used to answer questions Not Applicable to the group'
              ]
            }
          ],
          displayImage: dooImage
        },
        {
          id: 'w9-or-irs-letter',
          title: 'W9 or IRS Letter',
          description: 'Does the application have a W9 or IRS letter (form 147C) attached for the group?',
          fields: [
            {
              name: 'w9OrIrsLetterAttached',
              label: 'Does the application have a W9 or IRS letter (form 147C) attached for the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'It is required on the W9 or IRS letter that the Name, SSN/Tax ID Number, and Employer ID Number (IRS#) matches what we have on file in CICS',
                'If a W9 is provided, it must be signed and dated'
              ]
            }
          ],
          displayImage: w9Image
        },
        {
          id: 'authorization-agreement-ach',
          title: 'Authorization Agreement for Automatic Payments/Deposits',
          description: 'Is there a copy of the Authorization Agreement for Automatic Payments/Deposits?',
          fields: [
            {
              name: 'authorizationAgreementComplete',
              label: 'Complete: Review Authorization Agreement for Automatic Payments/Deposits',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'While this is not required for existing groups, it is important to pay attention to. If an existing group provides this form filled out, they may be looking to update their banking information. Compare the information to what we have in CICS on the 04 page. If the group wants make changes to their banking info, they will also need to provide a copy of a voided check. The account information will be taken from the voided check to update the info on the 04 page in CICS.\n\nFor new groups, this document is required along with a copy of a voided check. The account information will be taken from the voided check and added to the 04 page in CICS when enrolling a new group.\n\nPlease reach out to leadership prior to making any changes to ACH information.',
          displayImage: achImage
        },
        {
          id: 'request-for-paper-updates',
          title: 'Request for Paper Updates',
          description: 'Is there a Request for Paper Updates included with the application?',
          fields: [
            {
              name: 'requestForPaperUpdatesComplete',
              label: 'Complete: Review Request for Paper Updates form',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'If this form is attached and completed, you will enter all N\'s for provider mailings on page 02 CICS:\n\nMAILING INDS: MANUALS - N\nNEWSLETTERS - N\nPAPER RA - N\n\nIf this form is not provided or filled out, you can continue processing as usual.',
          displayImage: paperUpdatesImage
        },
        // ================== EXISTING PROVIDER WORKFLOW ==================
        // These pages handle adding an already-enrolled provider to a group
        {
          id: 'existing-provider-open-cics',
          title: 'OPEN CICS',
          description: 'Access the provider in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderOpenCicsComplete',
              label: 'Complete: Access the provider in CICS.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'In CICS, set the OPTION # to 12, the TRANS. TYPE to "U" and enter the groups provider number and press enter.',
          displayImage: cicsImage
        },
        {
          id: 'existing-provider-add-to-group',
          title: 'ADDING A PROVIDER TO THE GROUP',
          description: 'Add the provider to the group in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderAddToGroupComplete',
              label: 'Complete: Add the provider to the group in CICS.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'You will see list of all of the individual providers in the group.\n\nOne the first line, you will add a letter "A" to let CICS know you intend to Add a provider to this group.\n\nNext, tab over to the provider number and overwrite it with the new provider number that was just generated. (don\'t worry, you are not overwriting an existing provider).\n\nNext, tab over to the BEGIN DATE, and enter the begin date for the new provider.\nYou can get the BEGIN DATE by looking at Eligibility Begin in the Provider Information tab in SNOW.\n\nFinally, tab over to the END DATE and add 12319999 as the end date. If the date is already 12319999, you can leave it.\n\nOnce you hit ENTER, the provider will be added to the group.\n\nYou can check to see if the provider was successfully added by searching for their provider number where it says "NEXT MEMBER" and hitting enter. This will show you the provider you just added.\n\nAdditionally, check the notes page F6 to make sure a note was added stating you added the provider to the group.\n\nYou will do this for each provider you are adding',
          displayImage: addProvImage
        },
        {
          id: 'existing-provider-verify-info',
          title: 'VERIFYING PROVIDER INFO IS CORRECT',
          description: 'Verify all provider information in CICS',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          pageNotes: [
            'Board Certification Indicators:',
            'APN, CRNA, CNM will always remain a 0',
            'Doctors, and PA\'s will get a 1 if they provided a board eligibility letter',
            'Doctors, and PA\'s will get a 2 if they provided a board certificate',
            'Otherwise they will remain a 0'
          ],
          fields: [
            {
              name: 'providerNameFormatting02',
              label: 'Check the formatting of the providers name on 02 page',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'mailToPayToAddresses',
              label: 'Update the Mail To and Pay To addresses, and make sure the providers name is also formatted correctly there as well',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'cancelCodes',
              label: 'Check Cancel codes',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'effectiveDates',
              label: 'Check the effective dates for the DEA, Licenses, Specialties, Claim Types',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'boardCertificationIndicators',
              label: 'Check Board Certification Indicators',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'programCode54PA',
              label: 'Program Code 54 for PA on 04 page',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ]
        },
        {
          id: 'existing-provider-close-enrollment',
          title: 'CLOSING THE ENROLLMENT TASK',
          description: 'Close the enrollment task in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCloseEnrollmentComplete',
              label: 'Complete: Close the enrollment task in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'In the Enrollment work object, once you refresh the screen, you should see an Enrollment Task titled "Verify CICS".\n\nClick the PWT number and close the task. Work notes can state that you are just "closing to task".\n\nThis will close the enrollment.\n\nNavigate back to the Group Change work object.',
          displayImage: enrollmentTaskImage
        },
        {
          id: 'existing-provider-finish-group-change',
          title: 'FINISHING UP THE GROUP CHANGE',
          description: 'Complete the group change process in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderFinishGroupChangeComplete',
              label: 'Complete: Input the email address into the email field in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in the Group Change work object, Open the application, and find question 17 in the Group Practice Application to find the email address for the group.\n\nInput that email address into the email field in SNOW.',
          displayImage: emailFieldImage
        },
        {
          id: 'existing-provider-create-checklist',
          title: 'CREATE A CHECKLIST',
          description: 'Add verification checklist in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCreateChecklistComplete',
              label: 'Complete: Add verification checklist in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Add a checklist and check off everything that you verified.\n\nIf you did not use part of the checklist, do not mark it off. Only mark off what was verified.',
          displayImage: checklistImage
        },
        {
          id: 'existing-provider-approve-group-change',
          title: 'APPROVING THE GROUP CHANGE',
          description: 'Approve the group change in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderApproveGroupChangeComplete',
              label: 'Complete: Approve the group change in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Click one the approve button and make a comment stating the provider(s) has been added to the group.\n\nClick Approve.',
          displayImage: addToGroupImage
        },
        {
          id: 'existing-provider-open-letter-task',
          title: 'OPENING THE LETTER TASK',
          description: 'Navigate to the letter task in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderOpenLetterTaskComplete',
              label: 'Complete: Navigate to the letter task in SNOW.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once you have clicked approve, a new task will generate in the Group Change Task tab.\n\nClick the PWT number to go to the letter task.',
          displayImage: letterTaskImage
        },
        {
          id: 'existing-provider-select-letter',
          title: 'SELECTING THE LETTER',
          description: 'Select the group change letter and enter effective date',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderSelectLetterComplete',
              label: 'Complete: Select the group change letter and enter effective date.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once in the letter task, click on the blue Select Letter button and select GroupChangeAdd\n\nAlso enter the effective date that was given to the provider.',
          displayImage: letterSelectImage
        },
        {
          id: 'existing-provider-add-to-letter',
          title: 'ADDING THE PROVIDER TO THE LETTER',
          description: 'Add provider details to the letter',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderAddToLetterComplete',
              label: 'Complete: Add provider details to the letter.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Near the bottom of the letter task, click on the blue "New" button.\n\nIn the Provider field, enter the provider number of the individual we just added to the group.\n\nIn the Effective Date field, enter the effective date given to the provider.\n\nHit Submit.\n\nYou will do this for each provider you added to the group.',
          displayImage: letterProvImage
        },
        {
          id: 'existing-provider-finish-letter',
          title: 'FINISHING THE LETTER',
          description: 'Create, verify, and save the approval letter',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderFinishLetterComplete',
              label: 'Complete: Create, verify, and save the approval letter.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'IMPORTANT: Before creating the letter, verify the address matches the groups Mail To address on CICS. From the 02 screen in CICS, hit F5 3 times to view the Mail To address.\n\nOnce the letter has been selected, the effective date entered, and the provider(s) are added to the letter, click on the "Create Letter" button at the top right.\n\nThis will create an approval letter, and it will be attached to the top of the page.\n\nOpen the letter by clicking "view" next to the attached letter and verify that all the information on the letter is correct.\n\nDownload the letter by clicking directly on the letter attachment.\nIn your Downloads folder, locate the letter and rename it to the following format:\n\nGroupChangeAdd_GroupName_ICN#_Date\n\nExample:\nGroupChangeAdd_CMC DEPT OF MEDICINE GRP_24226304109_2024-08-20\n\nOnce renamed place the letter into the SDRIVE folder:\n\\\\192.60.36.175\\shared\\Provider Services\\Enrollment\\2-PE Letters',
          displayImage: generateLetterImage
        },
        {
          id: 'existing-provider-close-letter-task',
          title: 'CLOSING THE LETTER TASK',
          description: 'Close the letter task and complete the group change',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [
            {
              name: 'existingProviderCloseLetterTaskComplete',
              label: 'Complete: Close the letter task and complete the group change.',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Add a work note stating you have "Generated the approval letter"\n\nChange the Group Change Task State to Closed\n\nClick on the "Save" button\n\nThis will close the letter task and the Group Change work object all at one.',
          displayImage: closeLetterImage
        },
        {
          id: 'existing-provider-completion',
          title: 'Provider Added to Group',
          description: 'Automatic provider workflow routing',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [],
          instructionText: '',
          isCompletionPage: true,
          isInformational: true
        },
        {
          id: 'final-completion',
          title: 'Walkthrough Complete!',
          description: 'ALL PROVIDERS HAVE BEEN ENROLLED AND ADDED TO THE GROUP',
          showWhen: { field: 'providerEnrollmentType', value: 'Existing Provider' },
          fields: [],
          instructionText: 'Congratulations! You have successfully completed the group change walkthrough.\n\nAll providers have been enrolled and added to the group.\n\nYou can now:\n- Download your notes and answers\n- Start a new application',
          isCompletionPage: true
        },
        // ================== NEW PROVIDER WORKFLOW ==================
        // These pages handle enrolling a new provider into CICS
        {
          id: 'create-enrollment',
          title: 'Create Enrollment in SNOW',
          description: 'Begin the new provider enrollment process',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'createEnrollmentComplete',
              label: 'Complete: Clicked the "Create Enrollment" button in SNOW',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Begin enrolling a new provider by clicking on the blue "Create Enrollment" button within your work object in SNOW.',
          noteText: 'NOTE: You will do this for each new provider that needs to be enrolled into CICS, but do it one at a time to avoid making a mistake.',
          displayImage: createEnrollmentImage
        },
        {
          id: 'fill-provider-info',
          title: 'Fill in Provider Information',
          description: 'Enter the provider details in the enrollment window',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerInfoComplete',
              label: 'Complete: Filled in the provider information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Fill in the information for the individual provider you are enrolling into the window that pops up.',
          nameFormatNote: 'When entering the providers name, it should be in all CAPS and the format should be LAST FIRST MI and the professional title. ex: SMITH JOHN J. MD',
          displayImage: newProviderWindowImage,
          resourceText: 'Be sure to check the individual providers license and utilize the links below to help determine the provider type and specialty:',
          resources: [
            { label: '2025 Legal Quick Guide', url: './2025LegalQuickGuide.pdf', type: 'pdf' },
            { label: 'Provider Types and Specialties', url: './ProviderTypesSpecialties.pdf', type: 'pdf' }
          ]
        },
        {
          id: 'check-group-specialties',
          title: 'Check Group Specialties',
          description: 'Verify the group can accept the provider specialty',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'groupSpecialtiesChecked',
              label: 'Complete: Verified the group specialties',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in CICS, under the group, be sure to check what kind of specialties the group can take. From the 02 page in CICS, press F5 and take a look at the specialties that are already added to the group. If you do not see the providers specialty, check to see if the specialty is covered under another specialty, e.g. 420, 110, 750 etc.\n\nIf necessary, add the specialty to the group. The specialty will get the same effective date as the provider you are adding.',
          displayImage: groupSpecialtyImage,
          pageNotes: [
            'If you are still unsure, please reach out in the chat, or to leadership so that you can get the answer you need.'
          ]
        },
        {
          id: 'enrollment-applications-tab',
          title: 'Enrollment Applications Tab',
          description: 'Navigate to the Enrollment Applications tab in SNOW',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'enrollmentTabComplete',
              label: 'Complete: Navigate to the enrollment application you just created',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Back in SNOW, navigate to the bottom of the PWO and locate the "Enrollment Applications" tab.\n\nYou will see a new Enrollment Application associated with the provider information you just entered.\n\nClick on the PWO to take you to the enrollment application.',
          displayImage: enrollmentTabImage
        },
        {
          id: 'verify-enrollment-application',
          title: 'Verify Enrollment Application',
          description: 'Verify and complete the enrollment application information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerNameCorrect',
              label: 'Complete: Check the provider\'s name is correct',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'providerTypeCorrect',
              label: 'Complete: Check the provider type is correct',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'applicationDateAdded',
              label: 'Complete: Add the Application Date -- This is the stamped date on the application',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            },
            {
              name: 'cancelReasonCode',
              label: 'Complete: Cancel Reason Code should remain 00',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once you are in the Enrollment Application, check the name, provider type, application date and cancel reason code to ensure you entered the providers data correctly.'
        },
        {
          id: 'provider-address-tab',
          title: 'Provider Address Tab',
          description: 'Enter the provider address information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerAddressComplete',
              label: 'Complete: Enter the provider address information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The street address will be the practice address found on question 6 of the Group Practice Application.\n\nThe phone number, and fax number can be found on questions 11 and 14 in the Group Practice Application',
          displayImage: providerAddressImage
        },
        {
          id: 'payment-mailing-address-tab',
          title: 'Payment Address and Mailing Address Tab',
          description: 'Review payment and mailing address settings',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'paymentMailingAddressComplete',
              label: 'Complete: Review payment and mailing address settings',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'By default these inherit the street address from the Provider Address tab. These do not need to be changed in SNOW, but will need to be updated in CICS once the provider is added to the group.',
          displayImage: mailingAddressImage
        },
        {
          id: 'provider-information-tab',
          title: 'Provider Information Tab',
          description: 'Set eligibility dates and Medicare information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'providerInfoTabComplete',
              label: 'Complete: Set eligibility dates and Medicare information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The Eligibility Begin date will be the Requested Effective Date on question 20 of the Group Practice Application.\n\nA Requested Effective Date might not be provided. If that is the case, The effective date will go one year back from the stamped date as long as the license can cover it.\n\nIf the Requested Effective Date is further than a year back, we will go back 1 year from the stamped date on the application, as long as the individual providers license covers that far back. If the license does not cover that far back, you can only go as far back as the issue date of the license.\n\nThe Eligibility End date will remain blank.\n\nIf the provider has a Medicare Number, you can enter it in the Medicare Number field.',
          displayImage: providerInfoTabImage
        },
        {
          id: 'npi-tab',
          title: 'NPI Tab',
          description: 'Verify or enter the NPI number',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'npiTabComplete',
              label: 'Complete: Verify or enter the NPI number',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'The NPI number for the individual provider should already be populated into this tab. If it is not, you will enter it here.',
          displayImage: npiTabImage
        },
        {
          id: 'specialty-tab',
          title: 'Specialty Tab',
          description: 'Set specialty dates for the provider',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'specialtyTabComplete',
              label: 'Complete: Set specialty and specialty effective dates for the provider',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'This is a good time to triple check the specialty.\n\nSpecialty 1 Begin Date will be the same as the Eligibility Begin date as on the Provider Information tab.\n\nFor NURSES, Specialty 1 End Date will be the date their Board Certificate expires\n\nFor DOCTORS & PAs, Specialty 1 End Date will remain blank',
          displayImage: specTabImage
        },
        {
          id: 'claim-type-tab',
          title: 'Claim Type Tab',
          description: 'Set claim types for the provider',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'claimTypeTabComplete',
              label: 'Complete: Set claim types for the provider',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Claim Types can be determined by using the resource below.',
          resourceText: 'Use this resource to determine claim types:',
          resources: [
            { label: 'Provider Types and Specialties', url: './ProviderTypesSpecialties.pdf', type: 'pdf' }
          ],
          displayImage: claimTabImage,
          pageNotes: [
            'Example: A Provider Type 70 with a Specialty of 190 will get Claim Types 13, 15, 22',
            'Claim Type 1 Begin Date will be the same as the Eligibility Begin date as on the Provider Information tab.',
            'Claim Type 1 End Date will remain blank.',
            'NOTE: Not all specialties have 3 claim types like this example. Some will have 1 and some will have 2. The begin dates for each claim type will be the same date.'
          ]
        },
        {
          id: 'license-dea-tab',
          title: 'License and DEA Tab',
          description: 'Enter license and DEA information',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'licenseDeaTabComplete',
              label: 'Complete: Enter license and DEA information',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'License information can be pulled from the license provided in the application, or from the verification site. If the license is not in the application, and you have not obtained a screenshot of the license from the verification site, do so now.',
          resourceText: 'Use this resource to verify license:',
          resources: [
            { label: 'Verify License', url: 'https://miamifrp.com/verification/', type: 'link' }
          ],
          displayImage: licenseDeaTabImage,
          pageNotes: [
            'Input the License Number along with the License Effective Date and License Expiration Date.',
            'The License Effective Date is the issue date of the license',
            'The License Expiration Date is the Expiration Date of the License',
            'The DEA Number is listed on question 20 of the Group Practice Application but should also be attached to the application. If not, DEA can be validated using DEA lookup in the West Virginia Tool. Take a screenshot of the validated DEA and attach it to the work object.',
            'DEA Effective Date is the issue date of the DEA',
            'DEA End Date is the expiration date of the DEA'
          ]
        },
        {
          id: 'enroll-on-mainframe',
          title: 'Enrolling on Mainframe',
          description: 'Complete the enrollment process on the mainframe',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [
            {
              name: 'enrollOnMainframeComplete',
              label: 'Complete: Complete the enrollment process on the mainframe',
              type: 'checkbox',
              required: true,
              validation: (value) => value === true
            }
          ],
          instructionText: 'Once all of the information has been filled out accurately, click "Save" at the top of the screen and then you can proceed to click on "Enroll On Mainframe".\n\nThis may take a moment to process, but eventually you should see a blue banner stating "PROVIDER XXXXXXX SUCCESSFULLY ADDED"\n\nThe provider now has a provider ID.',
          displayImage: mainframeImage
        },
        {
          id: 'additional-providers-check',
          title: 'Provider Enrollment Status',
          description: 'Automatic provider workflow routing',
          showWhen: { field: 'providerEnrollmentType', value: 'New Provider' },
          fields: [],
          instructionText: '',
          isCompletionPage: true,
          isInformational: true
        },
        {
          id: 'next-provider-ready-check',
          title: 'Final Provider Verification',
          description: 'Last chance to verify all provider information before enrollment',
          showWhen: { field: 'additionalProvidersNeeded', value: 'Yes' },
          fields: [
            {
              name: 'nextProviderFinalVerificationConfirm',
              label: 'Is question 20 answered on the Group Practice Application?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'Practitioner Name, SSN, NPI and DOB are required.',
                'There may be multiple providers the group is trying to add, and they will all be listed within question 20 in sections A-H. If there are more providers than what the application can fit, additional pages will be attached.'
              ]
            },
            {
              name: 'nextProviderAlreadyEnrolled',
              label: 'Is the provider already enrolled?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'nextProviderFinalVerificationConfirm', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, this will be noted for the provider and you will proceed to the next question.',
                'If No, the checklist will be displayed.'
              ]
            },
            {
              name: 'nextProviderInGroup',
              label: 'Is the provider already in the group?',
              type: 'radio',
              required: true,
              options: ['Yes', 'No'],
              showWhen: { field: 'nextProviderAlreadyEnrolled', value: 'Yes' },
              validation: (value) => value === 'Yes' || value === 'No',
              helperNotes: [
                'If Yes, you will be given the option to reject this as a duplicate application.',
                'If No, this will be noted for the provider and the checklist will be displayed.'
              ]
            },
            {
              name: 'nextProviderFinalSsnVerified',
              label: 'SSN - Verify SSN using SOVOS if a Social Security Card is not attached to the application',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              sovosUrl: 'https://taxport.sovos.com/login'
            },
            {
              name: 'nextProviderFinalDexSanctionsCheck',
              label: 'DEX and Sanctions in WVT - Check all providers being added',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalDobVerified',
              label: 'DOB - Verify DOB in PECOS (new providers may not be in PECOS, so just use their DOB on the application)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalNpiVerified',
              label: 'NPI - Verify in either the WVT or at npiregistry.cms.hhs.gov to ensure the NPI belongs to the provider',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              npiRegistryUrl: 'https://npiregistry.cms.hhs.gov'
            },
            {
              name: 'nextProviderFinalLicensesVerified',
              label: () => (
                <>
                  Licenses - APN, CRNA, CNM require RN license and APN license.
                  <br/><br/>
                  Doctors are required to have a copy of their license.
                </>
              ),
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              licenseVerifyUrl: 'https://miamifrp.com/verification/'
            },
            {
              name: 'nextProviderFinalBoardCertificatesVerified',
              label: () => (
                <>
                  Board Certificates - APN, CRNA, CNM require board certificate.
                  <br/><br/>
                  Doctors are not required to provide a board certificate, but can be added and updated if included.
                </>
              ),
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true,
              licenseVerifyUrl: 'https://miamifrp.com/verification/'
            },
            {
              name: 'nextProviderFinalDeaEffectiveDates',
              label: 'DEA effective dates - Compare expiration dates and update if newer. Add DEA information for new providers if attached',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            },
            {
              name: 'nextProviderFinalEffectiveDatesChecked',
              label: 'Effective Dates - If no Requested Effective Date is provided, effective date goes one year back from stamped date (as long as license covers it)',
              type: 'checkbox',
              required: true,
              showWhen: (formData) => formData.nextProviderFinalVerificationConfirm === 'Yes' && (formData.nextProviderAlreadyEnrolled === 'No' || (formData.nextProviderAlreadyEnrolled === 'Yes' && formData.nextProviderInGroup === 'No')),
              validation: (value) => value === true
            }
          ]
        }
      ];

      // ============================================================
      // VALIDATION & PAGE LOGIC
      // ============================================================

      // Check if current page requirements are met
      const isPageValid = () => {
        const page = pages[currentPage];
        return page.fields.every(field => {
          if (field.showWhen) {
            let conditionMet;
            if (typeof field.showWhen === 'function') {
              conditionMet = field.showWhen(formData);
            } else {
              conditionMet = formData[field.showWhen.field] === field.showWhen.value;
            }
            if (!conditionMet) return true;
          }
          if (!field.required) return true;

          if (unableToVerifyFields.has(field.name)) return true;

          const value = formData[field.name];
          return field.validation ? field.validation(value) : !!value;
        });
      };

      const handleFieldChange = (fieldName, value) => {
        // Auto-format PWO number fields to uppercase
        if (fieldName === 'pwoNumber' || fieldName === 'resumePwoNumber') {
          value = value.toUpperCase();
        }
        setFormData(prev => ({ ...prev, [fieldName]: value }));

        const enrollmentFields = [
          'createEnrollmentComplete',
          'providerInfoComplete',
          'groupSpecialtiesChecked',
          'enrollmentTabComplete',
          'providerNameCorrect',
          'providerTypeCorrect',
          'applicationDateAdded',
          'cancelReasonCode',
          'providerAddressComplete',
          'paymentMailingAddressComplete',
          'providerInfoTabComplete',
          'npiTabComplete',
          'specialtyTabComplete',
          'claimTypeTabComplete',
          'licenseDeaTabComplete',
          'enrollOnMainframeComplete'
        ];

        const existingProviderFields = [
          'existingProviderOpenCicsComplete',
          'existingProviderAddToGroupComplete',
          'providerNameFormatting02',
          'mailToPayToAddresses',
          'cancelCodes',
          'effectiveDates',
          'boardCertificationIndicators',
          'programCode54PA',
          'existingProviderCloseEnrollmentComplete',
          'existingProviderFinishGroupChangeComplete',
          'existingProviderCreateChecklistComplete',
          'existingProviderApproveGroupChangeComplete',
          'existingProviderOpenLetterTaskComplete',
          'existingProviderSelectLetterComplete',
          'existingProviderAddToLetterComplete',
          'existingProviderFinishLetterComplete',
          'existingProviderCloseLetterTaskComplete'
        ];

        if (currentEnrollingProviderIndex !== null && enrollmentFields.includes(fieldName)) {
          setEnrolledProviders(prev => {
            const updated = [...prev];
            if (updated[currentEnrollingProviderIndex]) {
              updated[currentEnrollingProviderIndex] = {
                ...updated[currentEnrollingProviderIndex],
                [fieldName]: value
              };
            }
            return updated;
          });
        }

        if (currentAddingProviderIndex !== null && existingProviderFields.includes(fieldName)) {
          setEnrolledProviders(prev => {
            const updated = [...prev];
            if (updated[currentAddingProviderIndex]) {
              updated[currentAddingProviderIndex] = {
                ...updated[currentAddingProviderIndex],
                [fieldName]: value
              };
            }
            return updated;
          });
        }
      };

      const shouldShowPage = (pageIndex) => {
        const page = pages[pageIndex];
        if (!page.showWhen) return true;
        return formData[page.showWhen.field] === page.showWhen.value;
      };

      // ============================================================
      // EVENT HANDLERS
      // ============================================================

      // Handle navigation to next page with complex routing logic
      const handleNext = async () => {
        const currentPageData = pages[currentPage];

        // Handle resume-lookup page: Load saved application
        if (currentPageData.id === 'resume-lookup') {
          const pwoToResume = formData.resumePwoNumber;
          const savedState = await loadApplicationState(pwoToResume);

          if (!savedState) {
            await showAlert(`No saved application found for PWO# ${pwoToResume}. Please check the PWO# and try again, or start a new application.`);
            return;
          }

          // Check if application was outreached
          if (savedState.hasOutreach) {
            await showAlert(`PWO# ${pwoToResume} requires outreach and cannot be continued. The application has been marked for outreach, and you will need to begin a new application to process it.`);
            // Clear the choice and reset to start-choice page
            setFormData({ applicationChoice: '' });
            setCurrentPage(0);
            setVisitedPages(new Set([0]));
            return;
          }

          // Restore all saved state
          setFormData(savedState.formData);
          setEnrolledProviders(savedState.enrolledProviders);
          setOutreachNotes(savedState.outreachNotes);
          setProviderManualNotes(savedState.providerManualNotes);
          setUnableToVerifyFields(new Set(savedState.unableToVerifyFields));
          setVisitedPages(new Set(savedState.visitedPages));
          setCurrentEnrollingProviderIndex(savedState.currentEnrollingProviderIndex);
          setCurrentAddingProviderIndex(savedState.currentAddingProviderIndex);

          // Navigate to the saved page
          setTimeout(() => {
            setCurrentPage(savedState.currentPage);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }, 100);

          return;
        }

        if (currentPageData.id === 'question-20') {
          // Check if this provider has already been saved (prevents duplicates when navigating backwards)
          const expectedProviderCount = formData.expectedProviderCount || 0;
          const providerAlreadySaved = expectedProviderCount > 0 && enrolledProviders.length >= expectedProviderCount;


          const moreProviders = await showConfirm('Are there more providers to verify in this application?');

          const question20VerifyFields = ['ssnVerified', 'dexSanctionsCheck', 'dobVerified', 'npiVerified', 'licensesVerified', 'boardCertificatesVerified', 'doctorLicenseVerified'];
          const hasUnableToVerify = question20VerifyFields.some(field => unableToVerifyFields.has(field));

          // Debug: Log unable to verify check

          // Only save the provider if it hasn't been saved already
          if (!providerAlreadySaved) {
            if (hasUnableToVerify) {
              const providerData = {
                status: 'Unable to Verify - Requires Outreach',
                question20Answered: formData.question20Answered,
                providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                providerInGroup: formData.providerInGroup,
                ssnVerified: formData.ssnVerified,
                dexSanctionsCheck: formData.dexSanctionsCheck,
                dobVerified: formData.dobVerified,
                npiVerified: formData.npiVerified,
                licensesVerified: formData.licensesVerified,
                boardCertificatesVerified: formData.boardCertificatesVerified,
                doctorLicenseVerified: formData.doctorLicenseVerified,
                deaEffectiveDates: formData.deaEffectiveDates,
                effectiveDatesChecked: formData.effectiveDatesChecked,
                outreachNotes: [...outreachNotes]
              };

              setEnrolledProviders(prev => {
                const updatedProviders = [...prev, providerData];
                return updatedProviders;
              });
            } else if (moreProviders) {
              let providerStatus = 'Verified - Ready to Enroll';
              if (formData.providerAlreadyEnrolled === 'Yes') {
                if (formData.providerInGroup === 'Yes') {
                  providerStatus = 'Verified - Already in the Group';
                } else {
                  providerStatus = 'Verified - Ready to Add to Group';
                }
              }


              const providerData = {
                status: providerStatus,
                question20Answered: formData.question20Answered,
                providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                providerInGroup: formData.providerInGroup,
                ssnVerified: formData.ssnVerified,
                dexSanctionsCheck: formData.dexSanctionsCheck,
                dobVerified: formData.dobVerified,
                npiVerified: formData.npiVerified,
                licensesVerified: formData.licensesVerified,
                boardCertificatesVerified: formData.boardCertificatesVerified,
                doctorLicenseVerified: formData.doctorLicenseVerified,
                deaEffectiveDates: formData.deaEffectiveDates,
                effectiveDatesChecked: formData.effectiveDatesChecked,
                outreachNotes: [...outreachNotes]
              };

              setEnrolledProviders(prev => {
                const updatedProviders = [...prev, providerData];
                return updatedProviders;
              });
            }
          } else {
          }

          if (moreProviders) {
            const clearedData = { ...formData };
            delete clearedData.question20Answered;
            delete clearedData.providerAlreadyEnrolled;
            delete clearedData.providerInGroup;
            delete clearedData.ssnVerified;
            delete clearedData.dexSanctionsCheck;
            delete clearedData.dobVerified;
            delete clearedData.npiVerified;
            delete clearedData.licensesVerified;
            delete clearedData.boardCertificatesVerified;
            delete clearedData.doctorLicenseVerified;
            delete clearedData.deaEffectiveDates;
            delete clearedData.effectiveDatesChecked;

            // Account for the provider we just saved (state update is async, so use +1 if we saved)
            // +1 for the provider just saved (if not already saved), +1 for the next expected provider
            const providerJustSaved = !providerAlreadySaved ? 1 : 0;
            clearedData.expectedProviderCount = enrolledProviders.length + providerJustSaved + 1;


            setFormData(clearedData);

            // Clear ALL verification fields, not just question20 fields
            setUnableToVerifyFields(new Set());

            window.scrollTo({ top: 0, behavior: 'smooth' });

            return;
          } else {
            // Only save the final provider if it hasn't been saved already
            if (!providerAlreadySaved) {
              if (hasUnableToVerify) {
                const providerData = {
                  status: 'Unable to Verify - Requires Outreach',
                  question20Answered: formData.question20Answered,
                  providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                  providerInGroup: formData.providerInGroup,
                  ssnVerified: formData.ssnVerified,
                  dexSanctionsCheck: formData.dexSanctionsCheck,
                  dobVerified: formData.dobVerified,
                  npiVerified: formData.npiVerified,
                  licensesVerified: formData.licensesVerified,
                  boardCertificatesVerified: formData.boardCertificatesVerified,
                  doctorLicenseVerified: formData.doctorLicenseVerified,
                  deaEffectiveDates: formData.deaEffectiveDates,
                  effectiveDatesChecked: formData.effectiveDatesChecked,
                  outreachNotes: [...outreachNotes]
                };

                setEnrolledProviders(prev => {
                  const updatedProviders = [...prev, providerData];
                  return updatedProviders;
                });

                // Set expectedProviderCount to prevent duplicate saves when navigating back and forth
                const allProviders = [...enrolledProviders, providerData];
                setFormData(prev => ({
                  ...prev,
                  expectedProviderCount: allProviders.length
                }));

                const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
                if (completionIndex !== -1) {
                  setCurrentPage(completionIndex);
                  setVisitedPages(prev => new Set([...prev, completionIndex]));
                  // Scroll to top after navigation
                  setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  }, 100);
                }
                return;
              } else {
                let providerStatus = 'Verified - Ready to Enroll';
                if (formData.providerAlreadyEnrolled === 'Yes') {
                  if (formData.providerInGroup === 'Yes') {
                    providerStatus = 'Verified - Already in the Group';
                  } else {
                    providerStatus = 'Verified - Ready to Add to Group';
                  }
                }


                const providerData = {
                  status: providerStatus,
                  question20Answered: formData.question20Answered,
                  providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
                  providerInGroup: formData.providerInGroup,
                  ssnVerified: formData.ssnVerified,
                  dexSanctionsCheck: formData.dexSanctionsCheck,
                  dobVerified: formData.dobVerified,
                  npiVerified: formData.npiVerified,
                  licensesVerified: formData.licensesVerified,
                  boardCertificatesVerified: formData.boardCertificatesVerified,
                  doctorLicenseVerified: formData.doctorLicenseVerified,
                  deaEffectiveDates: formData.deaEffectiveDates,
                  effectiveDatesChecked: formData.effectiveDatesChecked,
                  outreachNotes: [...outreachNotes]
                };

                setEnrolledProviders(prev => {
                  const updatedProviders = [...prev, providerData];
                  return updatedProviders;
                });

                // Clear unable to verify fields after saving final provider
                setUnableToVerifyFields(new Set());

                // Set expectedProviderCount to prevent duplicate saves when navigating back and forth
                const allProviders = [...enrolledProviders, providerData];
                setFormData(prev => ({
                  ...prev,
                  expectedProviderCount: allProviders.length
                }));

                // Check if this is a duplicate (only provider and already enrolled and in group)
                if (allProviders.length === 1 && formData.providerAlreadyEnrolled === 'Yes' && formData.providerInGroup === 'Yes') {
                  const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
                  const rejectionNote = `[${stepInfo}] Application rejected as duplicate - only provider is already enrolled and in group`;
                  setOutreachNotes(prev => [...prev, rejectionNote]);

                  const completionIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
                  if (completionIndex !== -1) {
                    setCurrentPage(completionIndex);
                    setVisitedPages(prev => new Set([...prev, completionIndex]));
                    setTimeout(() => {
                      window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 100);
                  }
                  return;
                }

                // Navigate to questions-21-23 after saving final provider
                const questions2123Index = pages.findIndex(page => page.id === 'questions-21-23');
                if (questions2123Index !== -1) {
                  setCurrentPage(questions2123Index);
                  setVisitedPages(prev => new Set([...prev, questions2123Index]));
                  // Scroll to top after navigation
                  setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  }, 100);
                } else {
                }
                return;  // CRITICAL: Prevent general navigation logic from overriding this routing

              }
            } else {
              // Provider already saved, just navigate to appropriate next page

              // Determine the appropriate next page based on existing providers
              if (hasUnableToVerify) {
                const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
                if (completionIndex !== -1) {
                  setCurrentPage(completionIndex);
                  setVisitedPages(prev => new Set([...prev, completionIndex]));
                  // Scroll to top after navigation
                  setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  }, 100);
                }
                return;
              } else {
                // Navigate to questions-21-23 (navigating back case)
                const questions2123Index = pages.findIndex(page => page.id === 'questions-21-23');
                if (questions2123Index !== -1) {
                  setCurrentPage(questions2123Index);
                  setVisitedPages(prev => new Set([...prev, questions2123Index]));
                  // Scroll to top after navigation
                  setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  }, 100);
                }
                return;  // CRITICAL: Prevent general navigation logic from overriding this routing
              }
            }
          }
        }

        // Handler for request-for-paper-updates: Route to appropriate provider workflow
        if (currentPageData.id === 'request-for-paper-updates') {
          // PRIORITY 1: Check for duplicate application first
          const isDuplicateApplication = enrolledProviders.length === 1 &&
                                        enrolledProviders[0].status === 'Verified - Already in the Group';

          if (isDuplicateApplication) {
            const duplicateIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
            if (duplicateIndex !== -1) {
              setCurrentPage(duplicateIndex);
              setVisitedPages(prev => new Set([...prev, duplicateIndex]));
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }, 100);
            }
            return;
          }

          // PRIORITY 2: Check if any provider requires outreach OR if outreach notes were added
          const hasProvidersRequiringOutreach = enrolledProviders.some(p =>
            p.status === 'Unable to Verify - Requires Outreach'
          );
          const hasProviderOutreachNotes = enrolledProviders.some(p =>
            p.outreachNotes && p.outreachNotes.length > 0
          );
          const hasGeneralOutreachNotes = outreachNotes.length > 0;
          const requiresOutreach = hasProvidersRequiringOutreach || hasProviderOutreachNotes || hasGeneralOutreachNotes;

          if (requiresOutreach) {
            const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
            if (completionIndex !== -1) {
              setCurrentPage(completionIndex);
              setVisitedPages(prev => new Set([...prev, completionIndex]));
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }, 100);
            }
            return;
          }

          const needsEnrollment = enrolledProviders.some(p =>
            p.status === 'Verified - Ready to Enroll' &&
            p.providerAlreadyEnrolled === 'No'
          );

          if (needsEnrollment) {
            const firstReadyIndex = enrolledProviders.findIndex(p =>
              p.status === 'Verified - Ready to Enroll' &&
              p.providerAlreadyEnrolled === 'No'
            );

            if (firstReadyIndex !== -1) {
              setEnrolledProviders(prev => {
                const updatedProviders = [...prev];
                updatedProviders[firstReadyIndex] = {
                  ...updatedProviders[firstReadyIndex],
                  createEnrollmentComplete: false,
                  providerInfoComplete: false,
                  groupSpecialtiesChecked: false,
                  enrollmentTabComplete: false,
                  providerNameCorrect: false,
                  providerTypeCorrect: false,
                  applicationDateAdded: false,
                  cancelReasonCode: false,
                  providerAddressComplete: false,
                  paymentMailingAddressComplete: false,
                  providerInfoTabComplete: false,
                  npiTabComplete: false,
                  specialtyTabComplete: false,
                  claimTypeTabComplete: false,
                  licenseDeaTabComplete: false,
                  enrollOnMainframeComplete: false
                };
                return updatedProviders;
              });

              setCurrentEnrollingProviderIndex(firstReadyIndex);

              const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
              if (createEnrollmentIndex !== -1) {
                setFormData(prev => ({ ...prev, providerEnrollmentType: 'New Provider' }));
                setCurrentPage(createEnrollmentIndex);
                setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
                setTimeout(() => {
                  window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
              }
            }
            return;
          }

          const hasExistingProviders = enrolledProviders.some(p =>
            p.status === 'Verified - Ready to Add to Group' ||
            p.status === 'Enrolled - Ready to be Added to Group'
          );

          if (hasExistingProviders) {
            setEnrolledProviders(prev => {
              const updatedProviders = [...prev];
              updatedProviders.forEach((provider, idx) => {
                if (provider.status === 'Verified - Ready to Add to Group') {
                  updatedProviders[idx] = { ...provider, status: 'Enrolled - Ready to be Added to Group' };
                }
              });
              return updatedProviders;
            });

            setFormData(prev => ({
              ...prev,
              providerEnrollmentType: 'Existing Provider'
            }));

            const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
            if (openCicsIndex !== -1) {
              // Find first provider accounting for the state update that just happened
              // The state update changes 'Verified - Ready to Add to Group' to 'Enrolled - Ready to be Added to Group'
              // but enrolledProviders still has the old state, so we need to check for both statuses
              const firstProviderIndex = enrolledProviders.findIndex(p =>
                p.status === 'Verified - Ready to Add to Group' ||
                p.status === 'Enrolled - Ready to be Added to Group'
              );

              if (firstProviderIndex !== -1) {
                setCurrentAddingProviderIndex(firstProviderIndex);
              }

              setCurrentPage(openCicsIndex);
              setVisitedPages(prev => new Set([...prev, openCicsIndex]));
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }, 100);
            }
            return;
          }

          // Fallback: If no routing condition matched, log error
        }

        if (currentPageData.id === 'existing-provider-completion') {
          // Automatically check if there are more providers to add to group
          const nextReadyIndex = enrolledProviders.findIndex((p, idx) =>
            idx > currentAddingProviderIndex &&
            (p.status === 'Enrolled - Ready to be Added to Group' ||
             p.status === 'Verified - Ready to Add to Group')
          );

          const currentProviderNum = currentAddingProviderIndex !== null ? currentAddingProviderIndex + 1 : '';

          if (nextReadyIndex !== -1) {
            // There are more providers to add to group
            const nextProviderNum = nextReadyIndex + 1;
            const confirmed = await showConfirm(
              `You have successfully added Provider ${currentProviderNum} to the group.\n\nNow adding Provider ${nextProviderNum} to the group.`
            );

            if (!confirmed) {
              return; // User cancelled
            }

            setEnrolledProviders(prev => {
              const updated = [...prev];

              if (currentAddingProviderIndex !== null && updated[currentAddingProviderIndex]) {
                // Preserve all existing provider completion fields from formData before changing status
                updated[currentAddingProviderIndex] = {
                  ...updated[currentAddingProviderIndex],
                  existingProviderOpenCicsComplete: formData.existingProviderOpenCicsComplete || updated[currentAddingProviderIndex].existingProviderOpenCicsComplete,
                  existingProviderAddToGroupComplete: formData.existingProviderAddToGroupComplete || updated[currentAddingProviderIndex].existingProviderAddToGroupComplete,
                  providerNameFormatting02: formData.providerNameFormatting02 || updated[currentAddingProviderIndex].providerNameFormatting02,
                  mailToPayToAddresses: formData.mailToPayToAddresses || updated[currentAddingProviderIndex].mailToPayToAddresses,
                  cancelCodes: formData.cancelCodes || updated[currentAddingProviderIndex].cancelCodes,
                  effectiveDates: formData.effectiveDates || updated[currentAddingProviderIndex].effectiveDates,
                  boardCertificationIndicators: formData.boardCertificationIndicators || updated[currentAddingProviderIndex].boardCertificationIndicators,
                  programCode54PA: formData.programCode54PA || updated[currentAddingProviderIndex].programCode54PA,
                  existingProviderCloseEnrollmentComplete: formData.existingProviderCloseEnrollmentComplete || updated[currentAddingProviderIndex].existingProviderCloseEnrollmentComplete,
                  existingProviderFinishGroupChangeComplete: formData.existingProviderFinishGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderFinishGroupChangeComplete,
                  existingProviderCreateChecklistComplete: formData.existingProviderCreateChecklistComplete || updated[currentAddingProviderIndex].existingProviderCreateChecklistComplete,
                  existingProviderApproveGroupChangeComplete: formData.existingProviderApproveGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderApproveGroupChangeComplete,
                  existingProviderOpenLetterTaskComplete: formData.existingProviderOpenLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderOpenLetterTaskComplete,
                  existingProviderSelectLetterComplete: formData.existingProviderSelectLetterComplete || updated[currentAddingProviderIndex].existingProviderSelectLetterComplete,
                  existingProviderAddToLetterComplete: formData.existingProviderAddToLetterComplete || updated[currentAddingProviderIndex].existingProviderAddToLetterComplete,
                  existingProviderFinishLetterComplete: formData.existingProviderFinishLetterComplete || updated[currentAddingProviderIndex].existingProviderFinishLetterComplete,
                  existingProviderCloseLetterTaskComplete: formData.existingProviderCloseLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderCloseLetterTaskComplete,
                  status: 'Complete - Enrolled and Added to Group'
                };
              }

              return updated;
            });

            setCurrentAddingProviderIndex(nextReadyIndex);

            setFormData(prev => {
              const clearedData = { ...prev };
              delete clearedData.additionalExistingProvidersNeeded;
              delete clearedData.existingProviderOpenCicsComplete;
              delete clearedData.existingProviderAddToGroupComplete;
              delete clearedData.providerNameFormatting02;
              delete clearedData.mailToPayToAddresses;
              delete clearedData.cancelCodes;
              delete clearedData.effectiveDates;
              delete clearedData.boardCertificationIndicators;
              delete clearedData.programCode54PA;
              delete clearedData.existingProviderCloseEnrollmentComplete;
              delete clearedData.existingProviderFinishGroupChangeComplete;
              delete clearedData.existingProviderCreateChecklistComplete;
              delete clearedData.existingProviderApproveGroupChangeComplete;
              delete clearedData.existingProviderOpenLetterTaskComplete;
              delete clearedData.existingProviderSelectLetterComplete;
              delete clearedData.existingProviderAddToLetterComplete;
              delete clearedData.existingProviderFinishLetterComplete;
              delete clearedData.existingProviderCloseLetterTaskComplete;
              return clearedData;
            });

            const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
            if (openCicsIndex !== -1) {
              setCurrentPage(openCicsIndex);
              setVisitedPages(prev => new Set([...prev, openCicsIndex]));
            }
          } else {
            // No more providers - all done!
            const confirmed = await showConfirm(
              `You have successfully added all providers to the group.`
            );

            if (!confirmed) {
              return; // User cancelled
            }

            if (currentAddingProviderIndex !== null) {
              setEnrolledProviders(prev => {
                const updated = [...prev];
                if (updated[currentAddingProviderIndex]) {
                  // Preserve all existing provider completion fields from formData before changing status
                  updated[currentAddingProviderIndex] = {
                    ...updated[currentAddingProviderIndex],
                    existingProviderOpenCicsComplete: formData.existingProviderOpenCicsComplete || updated[currentAddingProviderIndex].existingProviderOpenCicsComplete,
                    existingProviderAddToGroupComplete: formData.existingProviderAddToGroupComplete || updated[currentAddingProviderIndex].existingProviderAddToGroupComplete,
                    providerNameFormatting02: formData.providerNameFormatting02 || updated[currentAddingProviderIndex].providerNameFormatting02,
                    mailToPayToAddresses: formData.mailToPayToAddresses || updated[currentAddingProviderIndex].mailToPayToAddresses,
                    cancelCodes: formData.cancelCodes || updated[currentAddingProviderIndex].cancelCodes,
                    effectiveDates: formData.effectiveDates || updated[currentAddingProviderIndex].effectiveDates,
                    boardCertificationIndicators: formData.boardCertificationIndicators || updated[currentAddingProviderIndex].boardCertificationIndicators,
                    programCode54PA: formData.programCode54PA || updated[currentAddingProviderIndex].programCode54PA,
                    existingProviderCloseEnrollmentComplete: formData.existingProviderCloseEnrollmentComplete || updated[currentAddingProviderIndex].existingProviderCloseEnrollmentComplete,
                    existingProviderFinishGroupChangeComplete: formData.existingProviderFinishGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderFinishGroupChangeComplete,
                    existingProviderCreateChecklistComplete: formData.existingProviderCreateChecklistComplete || updated[currentAddingProviderIndex].existingProviderCreateChecklistComplete,
                    existingProviderApproveGroupChangeComplete: formData.existingProviderApproveGroupChangeComplete || updated[currentAddingProviderIndex].existingProviderApproveGroupChangeComplete,
                    existingProviderOpenLetterTaskComplete: formData.existingProviderOpenLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderOpenLetterTaskComplete,
                    existingProviderSelectLetterComplete: formData.existingProviderSelectLetterComplete || updated[currentAddingProviderIndex].existingProviderSelectLetterComplete,
                    existingProviderAddToLetterComplete: formData.existingProviderAddToLetterComplete || updated[currentAddingProviderIndex].existingProviderAddToLetterComplete,
                    existingProviderFinishLetterComplete: formData.existingProviderFinishLetterComplete || updated[currentAddingProviderIndex].existingProviderFinishLetterComplete,
                    existingProviderCloseLetterTaskComplete: formData.existingProviderCloseLetterTaskComplete || updated[currentAddingProviderIndex].existingProviderCloseLetterTaskComplete,
                    status: 'Complete - Enrolled and Added to Group'
                  };
                }
                return updated;
              });

              setCurrentAddingProviderIndex(null);
            }

            const finalCompletionIndex = pages.findIndex(page => page.id === 'final-completion');
            if (finalCompletionIndex !== -1) {
              setCurrentPage(finalCompletionIndex);
              setVisitedPages(prev => new Set([...prev, finalCompletionIndex]));
            }
          }
          return;
        }

        if (currentPageData.id === 'additional-providers-check') {
          // Automatically check if there are more providers to enroll
          const nextReadyIndex = enrolledProviders.findIndex((p, idx) =>
            idx > currentEnrollingProviderIndex &&
            p.status === 'Verified - Ready to Enroll' &&
            p.providerAlreadyEnrolled === 'No'
          );

          const currentProviderNum = currentEnrollingProviderIndex !== null ? currentEnrollingProviderIndex + 1 : '';

          if (nextReadyIndex !== -1) {
            // There are more providers to enroll
            const nextProviderNum = nextReadyIndex + 1;
            const confirmed = await showConfirm(
              `You have successfully Enrolled Provider ${currentProviderNum}.\n\nNow starting enrollment for Provider ${nextProviderNum}.`
            );

            if (!confirmed) {
              return; // User cancelled
            }

            setEnrolledProviders(prev => {
              const updated = [...prev];

              if (currentEnrollingProviderIndex !== null && updated[currentEnrollingProviderIndex]) {
                // Preserve all enrollment completion fields from formData before changing status
                updated[currentEnrollingProviderIndex] = {
                  ...updated[currentEnrollingProviderIndex],
                  createEnrollmentComplete: formData.createEnrollmentComplete || updated[currentEnrollingProviderIndex].createEnrollmentComplete,
                  providerInfoComplete: formData.providerInfoComplete || updated[currentEnrollingProviderIndex].providerInfoComplete,
                  groupSpecialtiesChecked: formData.groupSpecialtiesChecked || updated[currentEnrollingProviderIndex].groupSpecialtiesChecked,
                  enrollmentTabComplete: formData.enrollmentTabComplete || updated[currentEnrollingProviderIndex].enrollmentTabComplete,
                  providerNameCorrect: formData.providerNameCorrect || updated[currentEnrollingProviderIndex].providerNameCorrect,
                  providerTypeCorrect: formData.providerTypeCorrect || updated[currentEnrollingProviderIndex].providerTypeCorrect,
                  applicationDateAdded: formData.applicationDateAdded || updated[currentEnrollingProviderIndex].applicationDateAdded,
                  cancelReasonCode: formData.cancelReasonCode || updated[currentEnrollingProviderIndex].cancelReasonCode,
                  providerAddressComplete: formData.providerAddressComplete || updated[currentEnrollingProviderIndex].providerAddressComplete,
                  paymentMailingAddressComplete: formData.paymentMailingAddressComplete || updated[currentEnrollingProviderIndex].paymentMailingAddressComplete,
                  providerInfoTabComplete: formData.providerInfoTabComplete || updated[currentEnrollingProviderIndex].providerInfoTabComplete,
                  npiTabComplete: formData.npiTabComplete || updated[currentEnrollingProviderIndex].npiTabComplete,
                  specialtyTabComplete: formData.specialtyTabComplete || updated[currentEnrollingProviderIndex].specialtyTabComplete,
                  claimTypeTabComplete: formData.claimTypeTabComplete || updated[currentEnrollingProviderIndex].claimTypeTabComplete,
                  licenseDeaTabComplete: formData.licenseDeaTabComplete || updated[currentEnrollingProviderIndex].licenseDeaTabComplete,
                  enrollOnMainframeComplete: formData.enrollOnMainframeComplete || updated[currentEnrollingProviderIndex].enrollOnMainframeComplete,
                  status: 'Enrolled - Ready to be Added to Group'
                };
              }

              if (updated[nextReadyIndex]) {
                updated[nextReadyIndex] = {
                  ...updated[nextReadyIndex],
                  createEnrollmentComplete: false,
                  providerInfoComplete: false,
                  groupSpecialtiesChecked: false,
                  enrollmentTabComplete: false,
                  providerNameCorrect: false,
                  providerTypeCorrect: false,
                  applicationDateAdded: false,
                  cancelReasonCode: false,
                  providerAddressComplete: false,
                  paymentMailingAddressComplete: false,
                  providerInfoTabComplete: false,
                  npiTabComplete: false,
                  specialtyTabComplete: false,
                  claimTypeTabComplete: false,
                  licenseDeaTabComplete: false,
                  enrollOnMainframeComplete: false
                };
              }

              return updated;
            });

            setCurrentEnrollingProviderIndex(nextReadyIndex);

            const clearedData = { ...formData };
            delete clearedData.createEnrollmentComplete;
            delete clearedData.providerInfoComplete;
            delete clearedData.groupSpecialtiesChecked;
            delete clearedData.enrollmentTabComplete;
            delete clearedData.providerNameCorrect;
            delete clearedData.providerTypeCorrect;
            delete clearedData.applicationDateAdded;
            delete clearedData.cancelReasonCode;
            delete clearedData.providerAddressComplete;
            delete clearedData.paymentMailingAddressComplete;
            delete clearedData.providerInfoTabComplete;
            delete clearedData.npiTabComplete;
            delete clearedData.specialtyTabComplete;
            delete clearedData.claimTypeTabComplete;
            delete clearedData.licenseDeaTabComplete;
            delete clearedData.enrollOnMainframeComplete;
            delete clearedData.additionalProvidersNeeded;
            delete clearedData.duplicateProviderSaved;

            clearedData.providerEnrollmentType = 'New Provider';

            setFormData(clearedData);

            setUnableToVerifyFields(new Set());

            const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
            if (createEnrollmentIndex !== -1) {
              setCurrentPage(createEnrollmentIndex);
              setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
              // Scroll to top after navigation
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }, 100);
            }
          } else {
            // No more providers to enroll - move to adding providers to group
            const confirmed = await showConfirm(
              `You have successfully enrolled all new providers. You will now begin adding the providers to the group.`
            );

            if (!confirmed) {
              return; // User cancelled
            }

            if (currentEnrollingProviderIndex !== null) {
              setEnrolledProviders(prev => {
                const updated = [...prev];
                if (updated[currentEnrollingProviderIndex]) {
                  // Preserve all enrollment completion fields from formData before changing status
                  updated[currentEnrollingProviderIndex] = {
                    ...updated[currentEnrollingProviderIndex],
                    createEnrollmentComplete: formData.createEnrollmentComplete || updated[currentEnrollingProviderIndex].createEnrollmentComplete,
                    providerInfoComplete: formData.providerInfoComplete || updated[currentEnrollingProviderIndex].providerInfoComplete,
                    groupSpecialtiesChecked: formData.groupSpecialtiesChecked || updated[currentEnrollingProviderIndex].groupSpecialtiesChecked,
                    enrollmentTabComplete: formData.enrollmentTabComplete || updated[currentEnrollingProviderIndex].enrollmentTabComplete,
                    providerNameCorrect: formData.providerNameCorrect || updated[currentEnrollingProviderIndex].providerNameCorrect,
                    providerTypeCorrect: formData.providerTypeCorrect || updated[currentEnrollingProviderIndex].providerTypeCorrect,
                    applicationDateAdded: formData.applicationDateAdded || updated[currentEnrollingProviderIndex].applicationDateAdded,
                    cancelReasonCode: formData.cancelReasonCode || updated[currentEnrollingProviderIndex].cancelReasonCode,
                    providerAddressComplete: formData.providerAddressComplete || updated[currentEnrollingProviderIndex].providerAddressComplete,
                    paymentMailingAddressComplete: formData.paymentMailingAddressComplete || updated[currentEnrollingProviderIndex].paymentMailingAddressComplete,
                    providerInfoTabComplete: formData.providerInfoTabComplete || updated[currentEnrollingProviderIndex].providerInfoTabComplete,
                    npiTabComplete: formData.npiTabComplete || updated[currentEnrollingProviderIndex].npiTabComplete,
                    specialtyTabComplete: formData.specialtyTabComplete || updated[currentEnrollingProviderIndex].specialtyTabComplete,
                    claimTypeTabComplete: formData.claimTypeTabComplete || updated[currentEnrollingProviderIndex].claimTypeTabComplete,
                    licenseDeaTabComplete: formData.licenseDeaTabComplete || updated[currentEnrollingProviderIndex].licenseDeaTabComplete,
                    enrollOnMainframeComplete: formData.enrollOnMainframeComplete || updated[currentEnrollingProviderIndex].enrollOnMainframeComplete,
                    status: 'Enrolled - Ready to be Added to Group'
                  };
                }

                return updated.map(provider => {
                  if (provider.status === 'Verified - Ready to Add to Group') {
                    return { ...provider, status: 'Enrolled - Ready to be Added to Group' };
                  }
                  return provider;
                });
              });

              setCurrentEnrollingProviderIndex(null);
            }

            setFormData(prev => ({
              ...prev,
              providerEnrollmentType: 'Existing Provider'
            }));

            const openCicsIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
            if (openCicsIndex !== -1) {
              // Find first provider accounting for the state updates that just happened
              // - The current enrolling provider (currentEnrollingProviderIndex) will become "Enrolled - Ready to be Added to Group"
              // - All "Verified - Ready to Add to Group" will become "Enrolled - Ready to be Added to Group"
              // But enrolledProviders still has the old state, so we need to account for these changes
              let firstProviderIndex = -1;

              for (let i = 0; i < enrolledProviders.length; i++) {
                const provider = enrolledProviders[i];

                // Check if this provider will be ready to add after the state update
                if (i === currentEnrollingProviderIndex ||
                    provider.status === 'Verified - Ready to Add to Group' ||
                    provider.status === 'Enrolled - Ready to be Added to Group') {
                  firstProviderIndex = i;
                  break;
                }
              }

              if (firstProviderIndex !== -1) {
                setCurrentAddingProviderIndex(firstProviderIndex);
              }

              setCurrentPage(openCicsIndex);
              setVisitedPages(prev => new Set([...prev, openCicsIndex]));
            }
          }
          return;
        }

        if (isPageValid() && currentPage < pages.length - 1) {
          let nextPage = currentPage + 1;
          while (nextPage < pages.length && !shouldShowPage(nextPage)) {
            nextPage++;
          }
          if (nextPage < pages.length) {
            setCurrentPage(nextPage);
            setVisitedPages(prev => new Set([...prev, nextPage]));

            const nextPageData = pages[nextPage];

            if (nextPageData.showWhen?.field === 'providerEnrollmentType' &&
                nextPageData.showWhen?.value === 'Existing Provider' &&
                currentAddingProviderIndex === null) {
              const firstProviderIndex = enrolledProviders.findIndex(p =>
                p.status === 'Enrolled - Ready to be Added to Group' ||
                p.status === 'Verified - Ready to Add to Group'
              );

              if (firstProviderIndex !== -1) {
                setCurrentAddingProviderIndex(firstProviderIndex);
              }
            }

          }
        }

        // Auto-save and scroll after navigation
        // Wait for state updates to complete
        setTimeout(() => {
          // Scroll to top of page after DOM update
          window.scrollTo({ top: 0, behavior: 'smooth' });

          const pwoNumber = formData.pwoNumber;
          if (pwoNumber && currentPageData.id !== 'start-choice' && currentPageData.id !== 'resume-lookup') {
            saveApplicationState(pwoNumber);
          }
        }, 100);
      };

      const handlePrevious = () => {
        if (currentPage > 0) {
          let prevPage = currentPage - 1;

          // Find the minimum page index for the current branch
          let minPageIndex = 0;
          if (formData.providerEnrollmentType === 'New Provider') {
            minPageIndex = pages.findIndex(page => page.id === 'create-enrollment');
          } else if (formData.providerEnrollmentType === 'Existing Provider') {
            minPageIndex = pages.findIndex(page => page.id === 'existing-provider-open-cics');
          }

          // Find the previous visible page, but don't go below the branch starting page
          // Also skip completion pages (they are terminal pages and should not be navigated to via Previous button)
          while (prevPage >= minPageIndex && (!shouldShowPage(prevPage) || pages[prevPage].isCompletionPage)) {
            prevPage--;
          }

          // Only navigate if we found a valid page within the allowed range
          if (prevPage >= minPageIndex) {
            setCurrentPage(prevPage);

            // Auto-save and scroll after navigation
            setTimeout(() => {
              // Scroll to top of page after DOM update
              window.scrollTo({ top: 0, behavior: 'smooth' });

              const pwoNumber = formData.pwoNumber;
              if (pwoNumber) {
                saveApplicationState(pwoNumber);
              }
            }, 100);
          } else {
          }
        }
      };

      const handleSubmit = async () => {
        if (isPageValid()) {
          await showAlert('Form submitted successfully! Check console for data.');
        }
      };

      // Helper function to save file (works in both Tauri and browser)
      const saveFile = async (content, defaultFilename) => {
        if (tauriInvoke) {
          // Tauri desktop app - use custom command
          try {
            const result = await tauriInvoke('save_file_dialog', {
              content: content,
              defaultFilename: defaultFilename
            });
            await showAlert('File saved successfully!');
          } catch (error) {
            const errorMsg = typeof error === 'string' ? error : (error.message || error.toString() || 'Unknown error');
            if (errorMsg.includes('cancelled')) {
              // User cancelled, don't show error
              return;
            }
            await showAlert('Failed to save file: ' + errorMsg);
          }
        } else {
          // Browser fallback
          const dataBlob = new Blob([content], { type: 'text/plain' });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = defaultFilename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }
      };

      const handleDownloadNotes = async () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `PROVIDER ENROLLMENT NOTES\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        // Add User Answers Section for Accountability
        textContent += `USER ANSWERS & SELECTIONS\n`;
        textContent += `${'-'.repeat(80)}\n\n`;

        // Application Setup
        textContent += `APPLICATION SETUP:\n`;
        if (formData.userName) {
          textContent += `  â€¢ User Name: ${formData.userName}\n`;
        }
        if (formData.pwoNumber) {
          textContent += `  â€¢ PWO Number: ${formData.pwoNumber}\n`;
        }
        if (formData.applicationChoice) {
          textContent += `  â€¢ Application Choice: ${formData.applicationChoice}\n`;
        }
        textContent += `\n`;

        // Group Practice Application
        textContent += `GROUP PRACTICE APPLICATION:\n`;
        if (formData.groupPracticeAttached !== undefined) {
          textContent += `  â€¢ Group Practice Application Attached: ${formData.groupPracticeAttached}\n`;
        }
        if (formData.questionsAnswered !== undefined) {
          textContent += `  â€¢ Questions 2, 4, 5, 5C Answered: ${formData.questionsAnswered}\n`;
        }
        if (formData.question6Answered !== undefined) {
          textContent += `  â€¢ Question 6 (Practice Address) Answered: ${formData.question6Answered}\n`;
        }
        textContent += `\n`;

        // Pay To / Mail To
        textContent += `PAY TO / MAIL TO ADDRESS:\n`;
        if (formData.paytoMailtoMatch !== undefined) {
          textContent += `  â€¢ Pay-to/Mail-to Match CICS: ${formData.paytoMailtoMatch}\n`;
        }
        if (formData.paytoMailtoComplete !== undefined) {
          textContent += `  â€¢ Pay-to/Mail-to Updated in CICS: ${formData.paytoMailtoComplete ? 'Yes' : 'No'}\n`;
        }
        textContent += `\n`;

        // Additional Questions 9-17
        textContent += `ADDITIONAL QUESTIONS (9-17):\n`;
        if (formData.questions9to17Answered !== undefined) {
          textContent += `  â€¢ Questions 9, 11, 12, 16, 17 Answered: ${formData.questions9to17Answered}\n`;
        }
        if (formData.emailAddedToSNOW !== undefined) {
          textContent += `  â€¢ Contact Email Added to SNOW: ${formData.emailAddedToSNOW ? 'Yes' : 'No'}\n`;
        }
        textContent += `\n`;

        // Additional Questions 21-23 & 25
        textContent += `ADDITIONAL QUESTIONS (21-23 & 25):\n`;
        if (formData.question21Answered !== undefined) {
          textContent += `  â€¢ Question 21 (a-e) Answered: ${formData.question21Answered}\n`;
        }
        if (formData.question22Answered !== undefined) {
          textContent += `  â€¢ Question 22 Answered: ${formData.question22Answered}\n`;
        }
        if (formData.question23Answered !== undefined) {
          textContent += `  â€¢ Question 23 Answered: ${formData.question23Answered}\n`;
        }
        if (formData.question25Signed !== undefined) {
          textContent += `  â€¢ Question 25 Signed: ${formData.question25Signed}\n`;
        }
        textContent += `\n`;

        // Required Forms
        textContent += `REQUIRED FORMS:\n`;
        if (formData.signatureAuthFormAttached !== undefined) {
          textContent += `  â€¢ Signature Authorization Form Attached: ${formData.signatureAuthFormAttached}\n`;
        }
        if (formData.agreementOfUnderstandingAttached !== undefined) {
          textContent += `  â€¢ Agreement of Understanding Attached: ${formData.agreementOfUnderstandingAttached}\n`;
        }
        if (formData.providerAgreementAttached !== undefined) {
          textContent += `  â€¢ Provider Agreement Attached: ${formData.providerAgreementAttached}\n`;
        }
        if (formData.disclosureOfOwnershipAttached !== undefined) {
          textContent += `  â€¢ Disclosure of Ownership Attached: ${formData.disclosureOfOwnershipAttached}\n`;
        }
        if (formData.w9OrIrsLetterAttached !== undefined) {
          textContent += `  â€¢ W9 or IRS Letter Attached: ${formData.w9OrIrsLetterAttached}\n`;
        }
        if (formData.authorizationAgreementComplete !== undefined) {
          textContent += `  â€¢ Authorization Agreement Reviewed: ${formData.authorizationAgreementComplete ? 'Yes' : 'No'}\n`;
        }
        if (formData.requestForPaperUpdatesComplete !== undefined) {
          textContent += `  â€¢ Request for Paper Updates Reviewed: ${formData.requestForPaperUpdatesComplete ? 'Yes' : 'No'}\n`;
        }
        textContent += `\n`;

        // Existing Provider Workflow (if applicable)
        const hasExistingProviderData = formData.existingProviderOpenCicsComplete !== undefined ||
                                         formData.existingProviderAddToGroupComplete !== undefined ||
                                         formData.providerNameFormatting02 !== undefined;

        if (hasExistingProviderData) {
          textContent += `EXISTING PROVIDER WORKFLOW:\n`;
          if (formData.existingProviderOpenCicsComplete !== undefined) {
            textContent += `  â€¢ CICS Opened: ${formData.existingProviderOpenCicsComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderAddToGroupComplete !== undefined) {
            textContent += `  â€¢ Provider Added to Group: ${formData.existingProviderAddToGroupComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.providerNameFormatting02 !== undefined) {
            textContent += `  â€¢ Provider Name Formatting Checked (02 page): ${formData.providerNameFormatting02 ? 'Yes' : 'No'}\n`;
          }
          if (formData.mailToPayToAddresses !== undefined) {
            textContent += `  â€¢ Mail To/Pay To Addresses Updated: ${formData.mailToPayToAddresses ? 'Yes' : 'No'}\n`;
          }
          if (formData.cancelCodes !== undefined) {
            textContent += `  â€¢ Cancel Codes Checked: ${formData.cancelCodes ? 'Yes' : 'No'}\n`;
          }
          if (formData.effectiveDates !== undefined) {
            textContent += `  â€¢ Effective Dates Checked: ${formData.effectiveDates ? 'Yes' : 'No'}\n`;
          }
          if (formData.boardCertificationIndicators !== undefined) {
            textContent += `  â€¢ Board Certification Indicators Checked: ${formData.boardCertificationIndicators ? 'Yes' : 'No'}\n`;
          }
          if (formData.programCode54PA !== undefined) {
            textContent += `  â€¢ Program Code 54 for PA (04 page): ${formData.programCode54PA ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderCloseEnrollmentComplete !== undefined) {
            textContent += `  â€¢ Enrollment Task Closed: ${formData.existingProviderCloseEnrollmentComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderFinishGroupChangeComplete !== undefined) {
            textContent += `  â€¢ Group Change Completed: ${formData.existingProviderFinishGroupChangeComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderCreateChecklistComplete !== undefined) {
            textContent += `  â€¢ Checklist Created: ${formData.existingProviderCreateChecklistComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderApproveGroupChangeComplete !== undefined) {
            textContent += `  â€¢ Group Change Approved: ${formData.existingProviderApproveGroupChangeComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderOpenLetterTaskComplete !== undefined) {
            textContent += `  â€¢ Letter Task Opened: ${formData.existingProviderOpenLetterTaskComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderSelectLetterComplete !== undefined) {
            textContent += `  â€¢ Letter Selected: ${formData.existingProviderSelectLetterComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderAddToLetterComplete !== undefined) {
            textContent += `  â€¢ Provider Added to Letter: ${formData.existingProviderAddToLetterComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderFinishLetterComplete !== undefined) {
            textContent += `  â€¢ Letter Finished: ${formData.existingProviderFinishLetterComplete ? 'Yes' : 'No'}\n`;
          }
          if (formData.existingProviderCloseLetterTaskComplete !== undefined) {
            textContent += `  â€¢ Letter Task Closed: ${formData.existingProviderCloseLetterTaskComplete ? 'Yes' : 'No'}\n`;
          }
          textContent += `\n`;
        }

        // Unable to Verify Fields
        if (unableToVerifyFields && unableToVerifyFields.size > 0) {
          textContent += `UNABLE TO VERIFY FIELDS:\n`;
          const fieldsArray = Array.from(unableToVerifyFields);
          fieldsArray.forEach(field => {
            textContent += `  â€¢ ${field}\n`;
          });
          textContent += `\n`;
        }

        textContent += `${'='.repeat(80)}\n\n`;

        if (enrolledProviders.length > 0) {
          textContent += `ENROLLED PROVIDERS (${enrolledProviders.length} total)\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          enrolledProviders.forEach((provider, index) => {
            textContent += `PROVIDER ${index + 1}\n`;
            textContent += `Status: ${provider.status || 'Successfully Enrolled'}\n\n`;

            // PROVIDER INFORMATION (QUESTION 20)
            textContent += `PROVIDER INFORMATION (QUESTION 20):\n`;
            textContent += `  â€¢ Question 20 Answered: ${provider.question20Answered !== false ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Provider Already Enrolled: ${provider.providerAlreadyEnrolled || 'N/A'}\n`;
            if (provider.providerAlreadyEnrolled === 'Yes') {
              textContent += `  â€¢ Provider In Group: ${provider.providerInGroup || 'N/A'}\n`;
            }
            textContent += `\n`;

            // PROVIDER VERIFICATION
            textContent += `PROVIDER VERIFICATION:\n`;
            textContent += `  â€¢ SSN Verified: ${provider.ssnVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DEX and Sanctions Check: ${provider.dexSanctionsCheck ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DOB Verified: ${provider.dobVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ NPI Verified: ${provider.npiVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Licenses Verified: ${provider.licensesVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Board Certificates Verified: ${provider.boardCertificatesVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DEA Effective Dates Checked: ${provider.deaEffectiveDatesChecked ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Effective Dates Checked: ${provider.effectiveDatesChecked ? 'Yes' : 'No'}\n`;
            textContent += `\n`;

            // Check if provider went through enrollment workflow (new provider, not already enrolled)
            const hasEnrollmentDetails = provider.providerAlreadyEnrolled === 'No' && (
              provider.createEnrollmentComplete !== undefined ||
              provider.npiTabComplete !== undefined ||
              provider.specialtyTabComplete !== undefined
            );

            // Check if provider went through existing provider workflow (adding to group, not already in group)
            const hasExistingProviderWorkflow = provider.providerAlreadyEnrolled === 'Yes' && provider.providerInGroup === 'No' && (
              provider.existingProviderOpenCicsComplete !== undefined ||
              provider.existingProviderAddToGroupComplete !== undefined
            );

            // Show enrollment workflow if provider was a new provider
            if (hasEnrollmentDetails) {
              textContent += `Enrollment Details:\n`;
              textContent += `  â€¢ Enrollment Created: ${provider.createEnrollmentComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Info Complete: ${provider.providerInfoComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Specialties Checked: ${provider.groupSpecialtiesChecked ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Enrollment Tab Complete: ${provider.enrollmentTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Name Correct: ${provider.providerNameCorrect ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Type Correct: ${provider.providerTypeCorrect ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Application Date Added: ${provider.applicationDateAdded ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Cancel Reason Code: ${provider.cancelReasonCode ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Address Complete: ${provider.providerAddressComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Payment/Mailing Address Complete: ${provider.paymentMailingAddressComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Info Tab Complete: ${provider.providerInfoTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ NPI Tab Complete: ${provider.npiTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Specialty Tab Complete: ${provider.specialtyTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Claim Type Tab Complete: ${provider.claimTypeTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ License/DEA Tab Complete: ${provider.licenseDeaTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Mainframe Enrollment Complete: ${provider.enrollOnMainframeComplete ? 'Yes' : 'No'}\n`;
              textContent += `\n`;
            } else if (provider.providerAlreadyEnrolled === 'Yes' && provider.providerInGroup === 'Yes') {
              textContent += `Enrollment Details: Provider was already enrolled and in the group\n\n`;
            } else if (provider.providerAlreadyEnrolled === 'Yes') {
              textContent += `Enrollment Details: Provider was already enrolled\n\n`;
            }

            // Show existing provider workflow if provider went through group addition (but not if already in group)
            if ((hasEnrollmentDetails || hasExistingProviderWorkflow) && provider.providerInGroup !== 'Yes') {
              textContent += `EXISTING PROVIDER WORKFLOW:\n`;
              textContent += `  â€¢ CICS Opened: ${provider.existingProviderOpenCicsComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Added to Group: ${provider.existingProviderAddToGroupComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Name Formatting Checked (02 page): ${provider.providerNameFormatting02 ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Mail To/Pay To Addresses Updated: ${provider.mailToPayToAddresses ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Cancel Codes Checked: ${provider.cancelCodes ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Effective Dates Checked: ${provider.effectiveDates ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Board Certification Indicators Checked: ${provider.boardCertificationIndicators ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Program Code 54 for PA (04 page): ${provider.programCode54PA ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Enrollment Task Closed: ${provider.existingProviderCloseEnrollmentComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Change Completed: ${provider.existingProviderFinishGroupChangeComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Checklist Created: ${provider.existingProviderCreateChecklistComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Change Approved: ${provider.existingProviderApproveGroupChangeComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Task Opened: ${provider.existingProviderOpenLetterTaskComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Selected: ${provider.existingProviderSelectLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Added to Letter: ${provider.existingProviderAddToLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Finished: ${provider.existingProviderFinishLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Task Closed: ${provider.existingProviderCloseLetterTaskComplete ? 'Yes' : 'No'}\n`;
            }

            if (providerManualNotes[index]) {
              textContent += `\nManual Notes:\n`;
              textContent += `  ${providerManualNotes[index].split('\n').join('\n  ')}\n`;
            }

            if (provider.outreachNotes && provider.outreachNotes.length > 0) {
              textContent += `\nnotes:\n`;
              provider.outreachNotes.forEach((note, noteIndex) => {
                textContent += `  ${noteIndex + 1}. ${note}\n`;
              });
            }

            textContent += `\n${'-'.repeat(80)}\n\n`;
          });
        } else {
          textContent += `No providers enrolled yet.\n\n`;
        }

        if (outreachNotes.length > 0) {
          textContent += `CURRENT OUTREACH NOTES (${outreachNotes.length})\n`;
          textContent += `${'-'.repeat(80)}\n`;
          outreachNotes.forEach((note, index) => {
            textContent += `${index + 1}. ${note}\n`;
          });
          textContent += `\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const pwoNumber = formData.pwoNumber || 'UNKNOWN';
        const filename = `${pwoNumber}-${new Date().toISOString().split('T')[0]}.txt`;
        await saveFile(textContent, filename);
      };

      const handleDownloadOutreachNotes = async () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `OUTREACH NOTES\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        if (outreachNotes.length > 0) {
          textContent += `CURRENT OUTREACH NOTES (${outreachNotes.length})\n`;
          textContent += `${'-'.repeat(80)}\n`;
          outreachNotes.forEach((note, index) => {
            textContent += `${index + 1}. ${note}\n`;
          });
          textContent += `\n`;
        } else {
          textContent += `No outreach notes yet.\n\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const pwoNumber = formData.pwoNumber || 'UNKNOWN';
        const filename = `${pwoNumber}-outreach-notes-${new Date().toISOString().split('T')[0]}.txt`;
        await saveFile(textContent, filename);
      };

      const handleDownloadEnrolledProviders = async () => {
        const date = new Date();
        const dateStr = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        let textContent = `ENROLLED PROVIDERS REPORT\n`;
        textContent += `Generated: ${dateStr}\n`;
        textContent += `${'='.repeat(80)}\n\n`;

        if (enrolledProviders.length > 0) {
          // SECTION 1: PROVIDER MANUAL NOTES
          textContent += `PROVIDER MANUAL NOTES\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          enrolledProviders.forEach((provider, index) => {
            textContent += `PROVIDER ${index + 1}\n`;
            textContent += `Status: ${provider.status || 'Successfully Enrolled'}\n\n`;

            // PROVIDER INFORMATION (QUESTION 20)
            textContent += `PROVIDER INFORMATION (QUESTION 20):\n`;
            textContent += `  â€¢ Question 20 Answered: ${provider.question20Answered !== false ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Provider Already Enrolled: ${provider.providerAlreadyEnrolled || 'N/A'}\n`;
            if (provider.providerAlreadyEnrolled === 'Yes') {
              textContent += `  â€¢ Provider In Group: ${provider.providerInGroup || 'N/A'}\n`;
            }
            textContent += `\n`;

            // PROVIDER VERIFICATION
            textContent += `PROVIDER VERIFICATION:\n`;
            textContent += `  â€¢ SSN Verified: ${provider.ssnVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DEX and Sanctions Check: ${provider.dexSanctionsCheck ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DOB Verified: ${provider.dobVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ NPI Verified: ${provider.npiVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Licenses Verified: ${provider.licensesVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Board Certificates Verified: ${provider.boardCertificatesVerified ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ DEA Effective Dates Checked: ${provider.deaEffectiveDatesChecked ? 'Yes' : 'No'}\n`;
            textContent += `  â€¢ Effective Dates Checked: ${provider.effectiveDatesChecked ? 'Yes' : 'No'}\n`;
            textContent += `\n`;

            // Check if provider went through enrollment workflow (new provider, not already enrolled)
            const hasEnrollmentDetails = provider.providerAlreadyEnrolled === 'No' && (
              provider.createEnrollmentComplete !== undefined ||
              provider.npiTabComplete !== undefined ||
              provider.specialtyTabComplete !== undefined
            );

            // Check if provider went through existing provider workflow (adding to group, not already in group)
            const hasExistingProviderWorkflow = provider.providerAlreadyEnrolled === 'Yes' && provider.providerInGroup === 'No' && (
              provider.existingProviderOpenCicsComplete !== undefined ||
              provider.existingProviderAddToGroupComplete !== undefined
            );

            // Show enrollment workflow if provider was a new provider
            if (hasEnrollmentDetails) {
              textContent += `Enrollment Details:\n`;
              textContent += `  â€¢ Enrollment Created: ${provider.createEnrollmentComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Info Complete: ${provider.providerInfoComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Specialties Checked: ${provider.groupSpecialtiesChecked ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Enrollment Tab Complete: ${provider.enrollmentTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Name Correct: ${provider.providerNameCorrect ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Type Correct: ${provider.providerTypeCorrect ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Application Date Added: ${provider.applicationDateAdded ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Cancel Reason Code: ${provider.cancelReasonCode ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Address Complete: ${provider.providerAddressComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Payment/Mailing Address Complete: ${provider.paymentMailingAddressComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Info Tab Complete: ${provider.providerInfoTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ NPI Tab Complete: ${provider.npiTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Specialty Tab Complete: ${provider.specialtyTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Claim Type Tab Complete: ${provider.claimTypeTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ License/DEA Tab Complete: ${provider.licenseDeaTabComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Mainframe Enrollment Complete: ${provider.enrollOnMainframeComplete ? 'Yes' : 'No'}\n`;
              textContent += `\n`;
            } else if (provider.providerAlreadyEnrolled === 'Yes' && provider.providerInGroup === 'Yes') {
              textContent += `Enrollment Details: Provider was already enrolled and in the group\n\n`;
            } else if (provider.providerAlreadyEnrolled === 'Yes') {
              textContent += `Enrollment Details: Provider was already enrolled\n\n`;
            }

            // Show existing provider workflow if provider went through group addition (but not if already in group)
            if ((hasEnrollmentDetails || hasExistingProviderWorkflow) && provider.providerInGroup !== 'Yes') {
              textContent += `EXISTING PROVIDER WORKFLOW:\n`;
              textContent += `  â€¢ CICS Opened: ${provider.existingProviderOpenCicsComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Added to Group: ${provider.existingProviderAddToGroupComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Name Formatting Checked (02 page): ${provider.providerNameFormatting02 ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Mail To/Pay To Addresses Updated: ${provider.mailToPayToAddresses ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Cancel Codes Checked: ${provider.cancelCodes ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Effective Dates Checked: ${provider.effectiveDates ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Board Certification Indicators Checked: ${provider.boardCertificationIndicators ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Program Code 54 for PA (04 page): ${provider.programCode54PA ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Enrollment Task Closed: ${provider.existingProviderCloseEnrollmentComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Change Completed: ${provider.existingProviderFinishGroupChangeComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Checklist Created: ${provider.existingProviderCreateChecklistComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Group Change Approved: ${provider.existingProviderApproveGroupChangeComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Task Opened: ${provider.existingProviderOpenLetterTaskComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Selected: ${provider.existingProviderSelectLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Provider Added to Letter: ${provider.existingProviderAddToLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Finished: ${provider.existingProviderFinishLetterComplete ? 'Yes' : 'No'}\n`;
              textContent += `  â€¢ Letter Task Closed: ${provider.existingProviderCloseLetterTaskComplete ? 'Yes' : 'No'}\n`;
            }

            if (providerManualNotes[index]) {
              textContent += `\nManual Notes:\n`;
              textContent += `  ${providerManualNotes[index].split('\n').join('\n  ')}\n`;
            } else {
              textContent += `\nManual Notes: None\n`;
            }

            textContent += `\n${'-'.repeat(80)}\n\n`;
          });

          // SECTION 2: OUTREACH NOTES
          textContent += `\nOUTREACH NOTES\n`;
          textContent += `${'-'.repeat(80)}\n\n`;

          let hasOutreachNotes = false;
          enrolledProviders.forEach((provider, index) => {
            if (provider.outreachNotes && provider.outreachNotes.length > 0) {
              hasOutreachNotes = true;
              textContent += `PROVIDER ${index + 1}:\n`;
              provider.outreachNotes.forEach((note, noteIndex) => {
                textContent += `  ${noteIndex + 1}. ${note}\n`;
              });
              textContent += `\n`;
            }
          });

          if (!hasOutreachNotes) {
            textContent += `No outreach notes for any providers.\n\n`;
          }
        } else {
          textContent += `No providers enrolled yet.\n\n`;
        }

        textContent += `\n${'='.repeat(80)}\n`;
        textContent += `End of Report\n`;

        const pwoNumber = formData.pwoNumber || 'UNKNOWN';
        const filename = `${pwoNumber}-providers-${new Date().toISOString().split('T')[0]}.txt`;
        await saveFile(textContent, filename);
      };

      const handleStartNewApplication = async () => {
        if (await showConfirm('Are you sure you want to start a new application? All current data will be lost.')) {
          // Delete saved application state if it exists
          const currentPwoNumber = formData.pwoNumber;
          if (currentPwoNumber) {
            await deleteApplicationState(currentPwoNumber);
          }

          setFormData({});
          setOutreachNotes([]);
          setEnrolledProviders([]);
          setProviderManualNotes({});
          setUnableToVerifyFields(new Set());
          setPendingUnableToVerifyField(null);
          setCurrentEnrollingProviderIndex(null);
          setCurrentAddingProviderIndex(null);
          setVisitedPages(new Set([0]));
          setCurrentPage(0);
        }
      };

      const handleRejectDuplicate = async () => {
        if (await showConfirm('Are you sure you want to reject this application as a duplicate? This provider is already in the group and does not need to be enrolled.')) {
          const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
          const duplicateNote = `[${stepInfo}] Rejected as a duplicate - provider is already in the group`;
          setOutreachNotes(prev => [...prev, duplicateNote]);

          const completionIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
          if (completionIndex !== -1) {
            setCurrentPage(completionIndex);
            setVisitedPages(prev => new Set([...prev, completionIndex]));
          }
        }
      };

      const handleNextProvider = async () => {
        const expectedProviderCount = formData.expectedProviderCount || 0;
        if (enrolledProviders.length > expectedProviderCount) {
          await showAlert('This provider has already been saved. Please proceed to the next step.');
          return;
        }

        const moreProviders = await showConfirm('Are there additional providers in this application to process?\n\nThis will save the current provider as "already enrolled and in group" and reset the form for the next provider.');

        const duplicateNote = 'Provider already enrolled and in group - no action needed';

        const providerData = {
          status: 'Already Enrolled and In Group',
          question20Answered: formData.question20Answered,
          providerAlreadyEnrolled: formData.providerAlreadyEnrolled,
          providerInGroup: formData.providerInGroup,
          nextProviderFinalVerificationConfirm: formData.nextProviderFinalVerificationConfirm,
          nextProviderAlreadyEnrolled: formData.nextProviderAlreadyEnrolled,
          nextProviderInGroup: formData.nextProviderInGroup,
          outreachNotes: [duplicateNote]
        };

        if (moreProviders) {
          // Save the duplicate provider and prepare for the next provider
          setEnrolledProviders(prev => {
            const updatedProviders = [...prev, providerData];
            return updatedProviders;
          });
          const clearedData = { ...formData };

          delete clearedData.question20Answered;
          delete clearedData.providerAlreadyEnrolled;
          delete clearedData.providerInGroup;
          delete clearedData.ssnVerified;
          delete clearedData.dexSanctionsCheck;
          delete clearedData.dobVerified;
          delete clearedData.npiVerified;
          delete clearedData.licensesVerified;
          delete clearedData.boardCertificatesVerified;
          delete clearedData.doctorLicenseVerified;
          delete clearedData.deaEffectiveDates;
          delete clearedData.effectiveDatesChecked;

          delete clearedData.nextProviderFinalVerificationConfirm;
          delete clearedData.nextProviderAlreadyEnrolled;
          delete clearedData.nextProviderInGroup;
          delete clearedData.nextProviderFinalSsnVerified;
          delete clearedData.nextProviderFinalDexSanctionsCheck;
          delete clearedData.nextProviderFinalDobVerified;
          delete clearedData.nextProviderFinalNpiVerified;
          delete clearedData.nextProviderFinalLicensesVerified;
          delete clearedData.nextProviderFinalBoardCertificatesVerified;
          delete clearedData.nextProviderFinalDoctorLicenseVerified;
          delete clearedData.nextProviderFinalDeaEffectiveDates;
          delete clearedData.nextProviderFinalEffectiveDatesChecked;

          // Account for the duplicate provider we just saved (state update is async)
          // +1 for the provider just saved, +1 for the next expected provider
          clearedData.expectedProviderCount = enrolledProviders.length + 2;

          setFormData(clearedData);

          const fieldsToRemove = ['nextProviderFinalSsnVerified', 'nextProviderFinalDexSanctionsCheck', 'nextProviderFinalDobVerified', 'nextProviderFinalNpiVerified', 'nextProviderFinalLicensesVerified', 'nextProviderFinalBoardCertificatesVerified', 'nextProviderFinalDoctorLicenseVerified'];
          setUnableToVerifyFields(prev => {
            const newSet = new Set(prev);
            fieldsToRemove.forEach(field => newSet.delete(field));
            return newSet;
          });

          await showAlert('Provider saved. You can now enter information for the next provider.');
        } else {
          const allProviders = [...enrolledProviders, providerData];

          if (allProviders.length === 1 && providerData.status === 'Already Enrolled and In Group') {
            const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
            const rejectionNote = `[${stepInfo}] Application rejected as duplicate - only provider is already enrolled and in group`;
            const updatedProviderData = {
              ...providerData,
              outreachNotes: [duplicateNote, rejectionNote]
            };

            setEnrolledProviders([updatedProviderData]);
            setOutreachNotes(prev => [...prev, rejectionNote]);

            const completionIndex = pages.findIndex(page => page.id === 'duplicate-rejection-completion');
            if (completionIndex !== -1) {
              setCurrentPage(completionIndex);
              setVisitedPages(prev => new Set([...prev, completionIndex]));
            }
            return;
          }

          const hasUnverifiedItems = allProviders.some(provider =>
            provider.outreachNotes && provider.outreachNotes.length > 0 &&
            provider.status === 'Unable to Verify - Requires Outreach'
          );

          if (hasUnverifiedItems) {
            // Save all providers including the current one
            setEnrolledProviders(allProviders);

            const completionIndex = pages.findIndex(page => page.id === 'question-20-unable-to-verify-completion');
            if (completionIndex !== -1) {
              setCurrentPage(completionIndex);
              setVisitedPages(prev => new Set([...prev, completionIndex]));
            }
          } else {
            const needsEnrollment = allProviders.some(p =>
              p.status === 'Verified - Ready to Enroll' &&
              p.providerAlreadyEnrolled === 'No'
            );

            if (needsEnrollment) {
              const firstReadyIndex = allProviders.findIndex(p =>
                p.status === 'Verified - Ready to Enroll' &&
                p.providerAlreadyEnrolled === 'No'
              );

              if (firstReadyIndex !== -1) {
                setEnrolledProviders(() => {
                  const updated = [...allProviders];
                  updated[firstReadyIndex] = {
                    ...updated[firstReadyIndex],
                    createEnrollmentComplete: false,
                    providerInfoComplete: false,
                    groupSpecialtiesChecked: false,
                    enrollmentTabComplete: false,
                    providerNameCorrect: false,
                    providerTypeCorrect: false,
                    applicationDateAdded: false,
                    cancelReasonCode: false,
                    providerAddressComplete: false,
                    paymentMailingAddressComplete: false,
                    providerInfoTabComplete: false,
                    npiTabComplete: false,
                    specialtyTabComplete: false,
                    claimTypeTabComplete: false,
                    licenseDeaTabComplete: false,
                    enrollOnMainframeComplete: false
                  };
                  return updated;
                });

                setCurrentEnrollingProviderIndex(firstReadyIndex);

                const createEnrollmentIndex = pages.findIndex(page => page.id === 'create-enrollment');
                if (createEnrollmentIndex !== -1) {
                  setFormData(prev => ({ ...prev, providerEnrollmentType: 'New Provider' }));
                  setCurrentPage(createEnrollmentIndex);
                  setVisitedPages(prev => new Set([...prev, createEnrollmentIndex]));
                  // Scroll to top after navigation
                  setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  }, 100);
                }
              }
            } else {
              // Save all providers including the current duplicate
              setEnrolledProviders(allProviders);

              setFormData(prev => ({
                ...prev,
                providerEnrollmentType: 'Existing Provider'
              }));

              const addToGroupIndex = pages.findIndex(page => page.id === 'existing-provider-add-to-group');
              if (addToGroupIndex !== -1) {
                const firstProviderIndex = allProviders.findIndex(p =>
                  p.status === 'Enrolled - Ready to be Added to Group'
                );

                if (firstProviderIndex !== -1) {
                  setCurrentAddingProviderIndex(firstProviderIndex);
                }

                setCurrentPage(addToGroupIndex);
                setVisitedPages(prev => new Set([...prev, addToGroupIndex]));
              }
            }
          }
        }
      };

      const handleAddOutreachNote = (reason, fieldName = null) => {
        const stepInfo = `Step ${currentPage + 1}: ${currentPageData.title}`;
        const noteWithStep = `[${stepInfo}] ${reason}`;
        setCurrentOutreachReason(noteWithStep);
        setShowOutreachModal(true);

        if (fieldName) {
          setPendingUnableToVerifyField(fieldName);
        }
      };

      const confirmAddOutreachNote = () => {
        if (currentOutreachReason && !outreachNotes.includes(currentOutreachReason)) {
          setOutreachNotes(prev => [...prev, currentOutreachReason]);
        }

        if (pendingUnableToVerifyField) {
          setUnableToVerifyFields(prev => new Set([...prev, pendingUnableToVerifyField]));
          setPendingUnableToVerifyField(null);
        }

        setShowOutreachModal(false);
        setCurrentOutreachReason('');
      };

      const cancelAddOutreachNote = () => {
        setShowOutreachModal(false);
        setCurrentOutreachReason('');
        setPendingUnableToVerifyField(null);
      };

      const handleRemoveNote = (index) => {
        setOutreachNotes(prev => prev.filter((_, i) => i !== index));
      };

      const handleProviderManualNoteChange = (providerIndex, note) => {
        setProviderManualNotes(prev => ({
          ...prev,
          [providerIndex]: note
        }));
      };

      const currentPageData = pages[currentPage];
      const isLastPage = currentPage === pages.length - 1;

      const canProceed = isPageValid();

      const getNextButtonText = () => {
        if (currentPageData.id === 'existing-provider-completion') {
          // Check if there are more providers to add to group
          const hasMoreProviders = enrolledProviders.some((p, idx) =>
            idx > currentAddingProviderIndex &&
            (p.status === 'Enrolled - Ready to be Added to Group' ||
             p.status === 'Verified - Ready to Add to Group')
          );
          return hasMoreProviders ? 'Next Provider' : 'Finish';
        }

        if (currentPageData.id === 'additional-providers-check') {
          // Check if there are more providers to enroll
          const hasMoreProviders = enrolledProviders.some((p, idx) =>
            idx > currentEnrollingProviderIndex &&
            p.status === 'Verified - Ready to Enroll' &&
            p.providerAlreadyEnrolled === 'No'
          );
          return hasMoreProviders ? 'Next Provider' : 'Add Providers to Group';
        }

        if (currentPageData.id === 'question-20') {
          return 'Next Provider';
        }

        if (isLastPage) return 'Submit';
        return 'Continue';
      };

      const getInstructionText = () => {
        if (currentPageData.id === 'additional-providers-check') {
          const providerNum = currentEnrollingProviderIndex !== null ? currentEnrollingProviderIndex + 1 : '';
          const buttonText = getNextButtonText();
          return `You have successfully enrolled Provider ${providerNum}.\n\nPlease click "${buttonText}" to continue.`;
        }

        if (currentPageData.id === 'existing-provider-completion') {
          const providerNum = currentAddingProviderIndex !== null ? currentAddingProviderIndex + 1 : '';
          const buttonText = getNextButtonText();
          const action = buttonText === 'Finish' ? 'to complete this application.' : 'to continue.';
          return `You have successfully added Provider ${providerNum} to the group.\n\nPlease click "${buttonText}" ${action}`;
        }

        return currentPageData.instructionText;
      };

      // ============================================================
      // COMPONENT RENDERING
      // ============================================================

      return (
        <div className="min-h-screen p-6 flex items-center justify-center" style={{backgroundColor: 'var(--bg-color)', transition: 'background-color 0.3s ease'}}>
          {/* Custom Styles */}
          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap');

            :root {
              --gainwell-teal: #3d5a66;
              --gainwell-cyan: #00e5b4;
              --gainwell-dark: #2a3f4a;
              --gainwell-light-teal: #527584;

              /* Light mode colors */
              --bg-color: #f3f4f6;
              --card-bg: white;
              --text-primary: #1f2937;
              --text-secondary: #6b7280;
              --border-color: #e5e7eb;
              --input-bg: white;
              --modal-bg: white;
            }

            html.dark {
              /* Dark mode colors */
              --bg-color: #111827;
              --card-bg: #1f2937;
              --text-primary: #f9fafb;
              --text-secondary: #d1d5db;
              --border-color: #374151;
              --input-bg: #374151;
              --modal-bg: #1f2937;
            }

            /* Dark mode text overrides */
            html.dark .text-slate-900,
            html.dark .text-slate-800,
            html.dark .text-slate-700 {
              color: #f3f4f6 !important;
            }

            html.dark .text-slate-600 {
              color: #d1d5db !important;
            }

            html.dark .text-slate-500 {
              color: #9ca3af !important;
            }

            html.dark .text-slate-400 {
              color: #9ca3af !important;
            }

            html.dark .placeholder-slate-400::placeholder {
              color: #6b7280 !important;
            }

            /* Dark mode background overrides */
            html.dark .bg-slate-50,
            html.dark .bg-slate-100 {
              background-color: #374151 !important;
            }

            html.dark .bg-white {
              background-color: var(--card-bg) !important;
            }

            html.dark .bg-indigo-50 {
              background-color: #1e3a5f !important;
            }

            html.dark .bg-blue-50,
            html.dark .bg-blue-100 {
              background-color: #1e3a5f !important;
            }

            /* Override text color in blue background sections for dark mode */
            html.dark .bg-blue-50 *,
            html.dark .bg-blue-100 *,
            html.dark .border-blue-200 *,
            html.dark .border-blue-400 * {
              color: #f3f4f6 !important;
            }

            /* Dark mode border overrides */
            html.dark .border-slate-100,
            html.dark .border-slate-200,
            html.dark .border-slate-300 {
              border-color: #4b5563 !important;
            }

            html.dark .border-indigo-200,
            html.dark .border-blue-200,
            html.dark .border-blue-400 {
              border-color: #4b5563 !important;
            }

            /* Ensure text is dark on light selected backgrounds (light mode) */
            .bg-cyan-50,
            .bg-cyan-100,
            .bg-indigo-50 {
              color: #1f2937 !important;
            }

            .bg-cyan-50 *,
            .bg-cyan-100 *,
            .bg-indigo-50 * {
              color: #1f2937 !important;
            }

            /* Override in dark mode for selected states */
            html.dark .bg-cyan-50,
            html.dark .bg-cyan-100 {
              background-color: #0d9488 !important;
              color: white !important;
            }

            html.dark .bg-cyan-50 *,
            html.dark .bg-cyan-100 * {
              color: white !important;
            }

            /* Override hardcoded light teal backgrounds in instruction boxes */
            html.dark div[style*="backgroundColor: rgb(224, 242, 241)"],
            html.dark div[style*="background-color: rgb(224, 242, 241)"],
            html.dark div[style*="backgroundColor:#e0f2f1"],
            html.dark div[style*="background-color:#e0f2f1"] {
              background-color: #1e3a5f !important;
            }

            /* Ensure text in instruction boxes with teal background is light in dark mode */
            html.dark div[style*="backgroundColor:#e0f2f1"] *,
            html.dark div[style*="background-color:#e0f2f1"] *,
            html.dark div[style*="backgroundColor: rgb(224, 242, 241)"] *,
            html.dark div[style*="background-color: rgb(224, 242, 241)"] * {
              color: #f3f4f6 !important;
            }

            /* Dark mode input and textarea styles */
            html.dark input[type="text"],
            html.dark input[type="email"],
            html.dark input[type="number"],
            html.dark input[type="tel"],
            html.dark input[type="date"],
            html.dark textarea,
            html.dark select {
              background-color: var(--input-bg) !important;
              color: #f3f4f6 !important;
              border-color: #4b5563 !important;
            }

            html.dark input::placeholder,
            html.dark textarea::placeholder {
              color: #9ca3af !important;
            }

            * {
              font-family: 'DM Sans', sans-serif;
            }

            .title-font {
              font-family: 'Crimson Pro', serif;
            }

            .field-input {
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .field-input:focus {
              transform: translateY(-2px);
              box-shadow: 0 8px 20px rgba(79, 70, 229, 0.15);
            }

            .btn-primary {
              position: relative;
              overflow: hidden;
            }

            .btn-primary::before {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
              transition: left 0.5s;
            }

            .btn-primary:hover::before {
              left: 100%;
            }

            .page-enter {
              animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes slideIn {
              from {
                opacity: 0;
                transform: translateX(20px);
              }
              to {
                opacity: 1;
                transform: translateX(0);
              }
            }

            .modal-overlay {
              position: fixed;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: rgba(0, 0, 0, 0.8);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 1000;
              animation: fadeIn 0.2s ease;
            }

            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }

            .theme-toggle {
              position: fixed;
              top: 1.5rem;
              right: 1.5rem;
              width: 3rem;
              height: 3rem;
              border-radius: 50%;
              background: var(--card-bg);
              border: 2px solid var(--gainwell-cyan);
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              transition: all 0.3s ease;
              z-index: 1001;
            }

            .theme-toggle:hover {
              transform: scale(1.1);
              box-shadow: 0 6px 12px rgba(0, 229, 180, 0.3);
            }

            .theme-toggle svg {
              width: 1.5rem;
              height: 1.5rem;
              color: var(--gainwell-cyan);
            }

            body {
              background-color: var(--bg-color);
              transition: background-color 0.3s ease;
            }
          `}</style>

          {/* Dark Mode Toggle */}
          <button
            className="theme-toggle"
            onClick={() => setIsDarkMode(!isDarkMode)}
            aria-label="Toggle dark mode"
          >
            {isDarkMode ? <Sun /> : <Moon />}
          </button>

          <div className="max-w-2xl w-full">
            {/* Form Card */}
            <div className="rounded-2xl shadow-2xl overflow-hidden page-enter" style={{backgroundColor: 'var(--card-bg)', borderColor: 'var(--border-color)', borderWidth: '1px', transition: 'all 0.3s ease'}}>
              {/* Header */}
              <div className="p-8 text-white relative" style={{background: 'linear-gradient(to right, var(--gainwell-teal), var(--gainwell-dark))'}}>
                <h1 className="title-font text-4xl font-bold mb-2">
                  {currentPageData.title}
                </h1>
                <p className="text-cyan-100 text-lg">
                  {typeof currentPageData.description === 'function' ? currentPageData.description(formData) : currentPageData.description}
                </p>
                {/* PWO Number Display */}
                {formData.pwoNumber && (
                  <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm border-2 border-white/40 rounded-lg px-4 py-2">
                    <div className="flex items-center gap-2">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      <span className="text-white font-bold text-base">
                        PWO#: {formData.pwoNumber}
                      </span>
                    </div>
                  </div>
                )}
                {/* Save Status Indicator */}
                {formData.pwoNumber && (
                  <div className="mt-3 flex items-center gap-2 text-sm">
                    {saveStatus.saving ? (
                      <div className="flex items-center gap-2 text-cyan-100">
                        <svg className="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Saving...</span>
                      </div>
                    ) : saveStatus.error ? (
                      <div className="flex items-center gap-2 text-red-200" title={saveStatus.error}>
                        <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Save failed: {saveStatus.error}</span>
                      </div>
                    ) : saveStatus.lastSaved ? (
                      <div className="flex items-center gap-2 text-cyan-100">
                        <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                        </svg>
                        <span>Saved at {saveStatus.lastSaved.toLocaleTimeString()}</span>
                      </div>
                    ) : null}
                  </div>
                )}
                {/* Current Provider Indicator */}
                {currentEnrollingProviderIndex !== null && formData.providerEnrollmentType === 'New Provider' && (
                  <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-4 py-2">
                    <div className="flex items-center gap-2">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      <span className="text-white font-semibold text-sm">
                        Currently Enrolling: Provider {currentEnrollingProviderIndex + 1} of {enrolledProviders.length}
                      </span>
                    </div>
                  </div>
                )}
                {/* Adding Provider to Group Indicator */}
                {currentAddingProviderIndex !== null && formData.providerEnrollmentType === 'Existing Provider' && (
                  <div className="mt-4 inline-block bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-4 py-2">
                    <div className="flex items-center gap-2">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                      <span className="text-white font-semibold text-sm">
                        Adding Provider to Group: Provider {currentAddingProviderIndex + 1} of {enrolledProviders.length}
                      </span>
                    </div>
                  </div>
                )}
              </div>

              {/* Form Content */}
              <div className="p-8 space-y-6">
                {/* Display Image */}
                {currentPageData.displayImage && (
                  <div className="mb-6">
                    <img
                      src={currentPageData.displayImage}
                      alt="Reference"
                      className="w-full rounded-lg border-2 border-slate-200 shadow-md"
                    />
                  </div>
                )}

                {/* Instruction Text */}
                {getInstructionText() && !currentPageData.isCompletionPage && (
                  <div className="border-l-4 p-4 rounded-r-lg mb-6" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                    <p className="text-slate-800 font-medium whitespace-pre-line">
                      {getInstructionText()}
                    </p>
                  </div>
                )}

                {/* Completion Page Instruction Text */}
                {getInstructionText() && currentPageData.isCompletionPage && (
                  <div className="border-l-4 p-4 rounded-r-lg mb-6" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                    <div className="text-slate-800 font-medium whitespace-pre-line">
                      {getInstructionText()}
                    </div>
                  </div>
                )}

                {/* Name Format Note */}
                {currentPageData.nameFormatNote && (
                  <div className="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg mb-6">
                    <div className="flex items-start gap-3">
                      <svg className="w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p className="text-purple-900 font-medium">
                        {currentPageData.nameFormatNote}
                      </p>
                    </div>
                  </div>
                )}

                {/* Note Text */}
                {currentPageData.noteText && (
                  <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4 mb-6">
                    <div className="flex items-start gap-3">
                      <div className="bg-amber-400 rounded-full p-1 mt-0.5 flex-shrink-0">
                        <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                      </div>
                      <p className="text-amber-900 font-semibold">
                        {currentPageData.noteText}
                      </p>
                    </div>
                  </div>
                )}

                {/* Resource Text and Buttons */}
                {currentPageData.resourceText && currentPageData.resources && (
                  <div className="bg-slate-50 border-2 border-slate-300 rounded-lg p-5 mb-6">
                    <p className="text-slate-800 font-semibold mb-4">
                      {currentPageData.resourceText}
                    </p>
                    <div className="flex flex-wrap gap-3">
                      {currentPageData.resources.map((resource, idx) => (
                        <button
                          key={idx}
                          onClick={() => openExternalUrl(resource.url, resource.label)}
                          className="inline-flex items-center gap-2 px-5 py-3 text-white font-semibold rounded-lg transition-all hover:shadow-lg cursor-pointer"
                          style={{backgroundColor: 'var(--gainwell-teal)'}}
                          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                        >
                          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                          </svg>
                          {resource.label}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {/* Page-specific Important Notes (before fields) */}
                {currentPageData.pageNotes && (
                  <div className="mt-8 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', border: '1px solid #b2dfdb'}}>
                    <h4 className="font-semibold text-sm mb-2 uppercase tracking-wide" style={{color: 'var(--gainwell-dark)'}}>Important Notes:</h4>
                    <ul className="space-y-2">
                      {currentPageData.pageNotes.map((note, idx) => (
                        <li key={idx} className="text-sm flex items-start" style={{color: 'var(--gainwell-teal)'}}>
                          <span className="mr-2 mt-1 flex-shrink-0">â€¢</span>
                          <span>{note}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                {currentPageData.fields.map((field, index) => {
                  if (currentPageData.id === 'question-20' && field.type === 'checkbox') {
                    return null;
                  }

                  if (currentPageData.id === 'next-provider-ready-check' && field.type === 'checkbox') {
                    return null;
                  }

                  if (currentPageData.id === 'questions-21-23') {
                    return null;
                  }

                  if (field.showWhen) {
                    let conditionMet;
                    if (typeof field.showWhen === 'function') {
                      conditionMet = field.showWhen(formData);
                    } else {
                      conditionMet = formData[field.showWhen.field] === field.showWhen.value;
                    }
                    if (!conditionMet) return null;
                  }

                  const value = formData[field.name] || (field.type === 'checkbox' ? false : '');
                  const isValid = field.validation ? field.validation(value) : !!value;
                  const showValidation = (typeof value === 'string' && value.length > 0) || field.type === 'checkbox';

                  return (
                    <div key={field.name} style={{ animationDelay: `${index * 0.1}s` }} className="page-enter">
                      {field.type !== 'checkbox' && (
                        <label className="block text-sm font-semibold text-slate-700 mb-2">
                          {typeof field.label === 'function' ? field.label(formData) : field.label}
                          {field.required && <span className="text-red-500 ml-1">*</span>}
                        </label>
                      )}
                      <div className="relative">
                        {field.type === 'checkbox' ? (
                          <>
                            {field.helperNotes ? (
                              <div className="border-2 rounded-lg p-5" style={{backgroundColor: '#e0f2f1', borderColor: '#b2dfdb'}}>
                                <div className="mb-4">
                                  {(typeof field.helperNotes === 'function' ? field.helperNotes(formData) : field.helperNotes).map((note, idx) => (
                                    <p key={idx} className="font-medium mb-2" style={{color: 'var(--gainwell-dark)'}}>
                                      {note}
                                    </p>
                                  ))}
                                </div>
                                <label className={`flex items-start p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                  value
                                    ? 'bg-cyan-100'
                                    : 'border-slate-300 hover:border-slate-400 bg-white'
                                }`} style={value ? {borderColor: 'var(--gainwell-cyan)'} : {}}>
                                  <input
                                    type="checkbox"
                                    checked={value || false}
                                    onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                    className="w-5 h-5 mt-0.5 flex-shrink-0"
                                    style={{accentColor: 'var(--gainwell-cyan)'}}
                                  />
                                  <span className="ml-3 font-medium text-slate-700">
                                    {typeof field.label === 'function' ? field.label(formData) : field.label}
                                    {field.required && <span className="text-red-500 ml-1">*</span>}
                                  </span>
                                </label>
                              </div>
                            ) : (
                              <label className={`flex items-start p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                value
                                  ? 'bg-cyan-50'
                                  : 'border-slate-200 hover:border-slate-300 bg-white'
                              }`} style={value ? {borderColor: 'var(--gainwell-cyan)'} : {}}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  className="w-5 h-5 mt-0.5 flex-shrink-0"
                                  style={{accentColor: 'var(--gainwell-cyan)'}}
                                />
                                <span className="ml-3 font-medium text-slate-700">
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                </span>
                              </label>
                            )}
                          </>
                        ) : field.type === 'radio' ? (
                          <div className="space-y-3">
                            {(typeof field.options === 'function' ? field.options(formData) : field.options).map((option) => (
                              <label
                                key={option}
                                className={`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${
                                  value === option
                                    ? 'bg-cyan-50'
                                    : 'border-slate-200 hover:border-slate-300 bg-white'
                                }`}
                                style={value === option ? {borderColor: 'var(--gainwell-cyan)'} : {}}
                              >
                                <input
                                  type="checkbox"
                                  checked={value === option}
                                  onChange={() => handleFieldChange(field.name, option)}
                                  className="w-5 h-5"
                                  style={{accentColor: 'var(--gainwell-cyan)'}}
                                />
                                <span className="ml-3 font-medium text-slate-700">{option}</span>
                              </label>
                            ))}
                          </div>
                        ) : field.type === 'textarea' ? (
                          <textarea
                            value={value}
                            onChange={(e) => handleFieldChange(field.name, e.target.value)}
                            placeholder={field.placeholder}
                            rows={4}
                            className={`field-input w-full px-4 py-3 border-2 rounded-xl focus:outline-none ${
                              showValidation
                                ? isValid
                                  ? 'border-green-300 focus:border-green-500'
                                  : 'border-red-300 focus:border-red-500'
                                : 'border-slate-200 focus:border-cyan-500'
                            }`}
                          />
                        ) : (
                          <input
                            type={field.type}
                            value={value}
                            onChange={(e) => handleFieldChange(field.name, e.target.value)}
                            placeholder={field.placeholder}
                            className={`field-input w-full px-4 py-3 border-2 rounded-xl focus:outline-none ${
                              showValidation
                                ? isValid
                                  ? 'border-green-300 focus:border-green-500'
                                  : 'border-red-300 focus:border-red-500'
                                : 'border-slate-200 focus:border-cyan-500'
                            }`}
                          />
                        )}
                        {showValidation && field.type !== 'radio' && field.type !== 'checkbox' && (
                          <div className="absolute right-3 top-1/2 -translate-y-1/2">
                            {isValid ? (
                              <CheckCircle2 className="w-5 h-5 text-green-500" />
                            ) : (
                              <Circle className="w-5 h-5 text-red-500" />
                            )}
                          </div>
                        )}
                      </div>
                      {field.helperText && (
                        <p className="text-sm text-slate-500 mt-1">{field.helperText}</p>
                      )}
                    </div>
                  );
                })}

                {/* Requirements Summary */}
                {!currentPageData.isCompletionPage && (
                <div className="mt-8 p-4 bg-slate-50 rounded-xl border border-slate-200">
                  <h3 className="font-semibold text-slate-700 mb-2 text-sm uppercase tracking-wide">
                    Requirements
                  </h3>

                  {currentPageData.id === 'group-practice' && formData.groupPracticeAttached === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that an application is required to make any changes.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'group-practice' && formData.questionsAnswered === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a revised application with the missing responses to required questions.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a revised application with the missing responses to required questions.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-6' && formData.question6Answered === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach group and request the practice address.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach group and request the practice address.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'payto-mailto' && formData.questions7and8Answered === 'Yes' ? (
                    <div className="bg-green-50 border-2 border-green-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-green-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-green-900 text-lg mb-2">Review Next Steps</h4>
                          <p className="text-green-800 font-medium mb-3">
                            Questions 7 and 8 are answered. Click below to view the next steps for updating addresses in CICS.
                          </p>
                          <button
                            onClick={() => setShowNextStepsModal(true)}
                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2"
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            View Next Steps
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'questions-9-17' && formData.questions9to17Answered === 'No' ? (
                    <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-blue-900 text-lg mb-2">OUTREACH</h4>
                          <p className="text-blue-800 font-medium mb-3">
                            Outreach the group and ask them to provide the missing answers for Questions 9, 11, 12, 16 and 17 on the group practice application (FD23)
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and ask them to provide the missing answers for Questions 9, 11, 12, 16 and 17 on the group practice application (FD23)')}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-20' && formData.question20Answered === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that Question 20 was not answered completely.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'question-20' && formData.question20Answered === 'Yes' ? (
                    <div className="space-y-3">
                      {currentPageData.fields
                        .filter(f => {
                          if (f.type !== 'checkbox') return false;
                          if (f.showWhen) {
                            if (typeof f.showWhen === 'function') {
                              return f.showWhen(formData);
                            } else {
                              return formData[f.showWhen.field] === f.showWhen.value;
                            }
                          }
                          return true;
                        })
                        .map((field, idx) => {
                          const value = formData[field.name] || false;
                          const isValid = field.validation ? field.validation(value) : !!value;

                          const hasUnableToVerifyButton = ['ssnVerified', 'dexSanctionsCheck', 'dobVerified', 'npiVerified', 'licensesVerified', 'boardCertificatesVerified', 'nextProviderFinalSsnVerified', 'nextProviderFinalDexSanctionsCheck', 'nextProviderFinalDobVerified', 'nextProviderFinalNpiVerified', 'nextProviderFinalLicensesVerified', 'nextProviderFinalBoardCertificatesVerified'].includes(field.name);

                          const isUnableToVerify = unableToVerifyFields.has(field.name);

                          return (
                            <div key={field.name} className={`p-4 border-2 rounded-xl transition-all page-enter ${
                              isUnableToVerify
                                ? 'border-slate-300 bg-slate-100 opacity-60'
                                : value
                                ? 'border-indigo-500 bg-indigo-50'
                                : 'border-slate-200 hover:border-slate-300 bg-white'
                            }`}>
                              <label className={`flex items-start ${isUnableToVerify ? 'cursor-not-allowed' : 'cursor-pointer'}`}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  disabled={isUnableToVerify}
                                  className="w-5 h-5 text-indigo-600 focus:ring-indigo-500 mt-0.5 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                                />
                                <span className={`ml-3 font-medium flex-1 ${isUnableToVerify ? 'text-slate-400' : 'text-slate-700'}`}>
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                  {isUnableToVerify && <span className="ml-2 text-xs font-semibold text-amber-600">(UNABLE TO VERIFY)</span>}
                                </span>
                              </label>
                              {(field.sovosUrl || field.npiRegistryUrl || field.licenseVerifyUrl || hasUnableToVerifyButton) && (
                                <div className="mt-3 flex justify-end gap-2">
                                  {field.sovosUrl && !isUnableToVerify && (
                                    <button
                                      onClick={() => openExternalUrl(field.sovosUrl)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm cursor-pointer"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Go to SOVOS
                                    </button>
                                  )}
                                  {field.npiRegistryUrl && !isUnableToVerify && (
                                    <button
                                      onClick={() => openExternalUrl(field.npiRegistryUrl)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm cursor-pointer"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Go to NPI Registry
                                    </button>
                                  )}
                                  {field.licenseVerifyUrl && !isUnableToVerify && (
                                    <button
                                      onClick={() => openExternalUrl(field.licenseVerifyUrl)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm cursor-pointer"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Verify License
                                    </button>
                                  )}
                                  {hasUnableToVerifyButton && !isUnableToVerify && (
                                    <button
                                      onClick={() => handleAddOutreachNote(`Unable to verify: ${typeof field.label === 'function' ? field.label(formData) : field.label}`, field.name)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white font-semibold rounded-lg transition-colors text-sm border-2 border-amber-500"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                      </svg>
                                      Unable to Verify
                                    </button>
                                  )}
                                </div>
                              )}
                            </div>
                          );
                        })}
                    </div>
                  ) : currentPageData.id === 'next-provider-ready-check' && formData.nextProviderFinalVerificationConfirm === 'No' ? (
                    <div className="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                      <div className="flex items-start gap-3">
                        <div className="bg-amber-400 rounded-full p-1 mt-0.5">
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                        </div>
                        <div>
                          <h4 className="font-bold text-amber-900 text-lg mb-2">RETURN TO PROVIDER</h4>
                          <p className="text-amber-800 font-medium">
                            Return to provider, notating that Question 20 was not answered completely.
                          </p>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'next-provider-ready-check' && formData.nextProviderFinalVerificationConfirm === 'Yes' ? (
                    <div className="space-y-3">
                      {currentPageData.fields
                        .filter(f => {
                          if (f.type !== 'checkbox') return false;
                          if (f.showWhen) {
                            if (typeof f.showWhen === 'function') {
                              return f.showWhen(formData);
                            } else {
                              return formData[f.showWhen.field] === f.showWhen.value;
                            }
                          }
                          return true;
                        })
                        .map((field, idx) => {
                          const value = formData[field.name] || false;
                          const isValid = field.validation ? field.validation(value) : !!value;

                          const isUnableToVerify = unableToVerifyFields.has(field.name);

                          return (
                            <div key={field.name} className={`p-4 border-2 rounded-xl transition-all page-enter ${
                              isUnableToVerify
                                ? 'border-slate-300 bg-slate-100 opacity-60'
                                : value
                                ? 'border-indigo-500 bg-indigo-50'
                                : 'border-slate-200 hover:border-slate-300 bg-white'
                            }`}>
                              <label className={`flex items-start ${isUnableToVerify ? 'cursor-not-allowed' : 'cursor-pointer'}`}>
                                <input
                                  type="checkbox"
                                  checked={value || false}
                                  onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                  disabled={isUnableToVerify}
                                  className="w-5 h-5 text-indigo-600 focus:ring-indigo-500 mt-0.5 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                                />
                                <span className={`ml-3 font-medium flex-1 ${isUnableToVerify ? 'text-slate-400' : 'text-slate-700'}`}>
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                  {isUnableToVerify && <span className="ml-2 text-xs font-semibold text-amber-600">(UNABLE TO VERIFY)</span>}
                                </span>
                              </label>
                              {(field.sovosUrl || field.licenseVerifyUrl) && (
                                <div className="mt-3 ml-8">
                                  {field.sovosUrl && (
                                    <button
                                      onClick={() => openExternalUrl(field.sovosUrl)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm cursor-pointer"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Go to SOVOS
                                    </button>
                                  )}
                                  {field.licenseVerifyUrl && !isUnableToVerify && (
                                    <button
                                      onClick={() => openExternalUrl(field.licenseVerifyUrl)}
                                      className="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm cursor-pointer"
                                    >
                                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                      </svg>
                                      Verify License
                                    </button>
                                  )}
                                </div>
                              )}
                            </div>
                          );
                        })}
                    </div>
                  ) : currentPageData.id === 'questions-21-23' ? (
                    <div className="space-y-6">
                      {currentPageData.fields.map((field, idx) => {
                        const value = formData[field.name] || false;
                        const isValid = field.validation ? field.validation(value) : !!value;

                        return (
                          <div key={field.name} className="space-y-3">
                            <label
                              className={`flex items-center p-5 border-2 rounded-xl cursor-pointer transition-all ${
                                value
                                  ? 'bg-cyan-50'
                                  : 'border-slate-200 hover:border-slate-300 bg-white'
                              }`}
                              style={value ? {borderColor: 'var(--gainwell-cyan)'} : {}}
                            >
                              <input
                                type="checkbox"
                                checked={value}
                                onChange={(e) => handleFieldChange(field.name, e.target.checked)}
                                className="w-6 h-6 rounded"
                                style={{accentColor: 'var(--gainwell-cyan)'}}
                              />
                              <div className="ml-4 flex-1">
                                <span className="font-semibold text-slate-800">
                                  {typeof field.label === 'function' ? field.label(formData) : field.label}
                                  {field.required && <span className="text-red-500 ml-1">*</span>}
                                </span>
                              </div>
                            </label>

                            {field.helperNotes && (
                              <div className="mt-3 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', border: '1px solid #b2dfdb'}}>
                                <h4 className="font-semibold text-sm mb-2" style={{color: 'var(--gainwell-dark)'}}>Important Notes:</h4>
                                <ul className="space-y-2">
                                  {(typeof field.helperNotes === 'function' ? field.helperNotes(formData) : field.helperNotes).map((note, noteIdx) => (
                                    <li key={noteIdx} className="text-sm flex items-start" style={{color: 'var(--gainwell-teal)'}}>
                                      <span className="mr-2 mt-1 flex-shrink-0">â€¢</span>
                                      <span>{note}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        );
                      })}

                      {(formData.question21Answered !== true || formData.question22Answered !== true || formData.question23Answered !== true || formData.question25Signed !== true) && (
                        <div className="bg-blue-50 border-2 border-blue-400 rounded-lg p-4 mt-6">
                          <div className="flex items-start gap-3">
                            <div className="bg-blue-400 rounded-full p-1 mt-0.5">
                              <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                              </svg>
                            </div>
                            <div className="flex-1">
                              <h4 className="font-bold text-blue-900 text-lg mb-2">OUTREACH</h4>
                              <p className="text-blue-800 font-medium mb-3">
                                Outreach group and request a revised application with the missing responses to required questions.
                              </p>
                              <button
                                onClick={() => handleAddOutreachNote('Outreach group and request a revised application with the missing responses to required questions (Questions 21-23 & 25).')}
                                className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                              >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                </svg>
                                Add to Notes
                              </button>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  ) : currentPageData.id === 'signature-authorization-form' && formData.signatureAuthFormAttached === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a completed Signature Authorization form.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a completed Signature Authorization form.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'agreement-of-understanding' && formData.agreementOfUnderstandingAttached === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a completed Agreement of Understanding form.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a completed Agreement of Understanding form.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'provider-agreement' && formData.providerAgreementAttached === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a completed Provider Agreement form.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a completed Provider Agreement form.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'disclosure-of-ownership' && formData.disclosureOfOwnershipAttached === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a completed Disclosure of Ownership form.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a completed Disclosure of Ownership form.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id === 'w9-or-irs-letter' && formData.w9OrIrsLetterAttached === 'No' ? (
                    <div className="border-2 rounded-lg p-4" style={{backgroundColor: '#e0f2f1', borderColor: 'var(--gainwell-cyan)'}}>
                      <div className="flex items-start gap-3">
                        <div className="rounded-full p-1 mt-0.5" style={{backgroundColor: 'var(--gainwell-cyan)'}}>
                          <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2" style={{color: 'var(--gainwell-dark)'}}>OUTREACH</h4>
                          <p className="font-medium mb-3" style={{color: 'var(--gainwell-teal)'}}>
                            Outreach the group and request a copy of the W9 or IRS letter.
                          </p>
                          <button
                            onClick={() => handleAddOutreachNote('Outreach the group and request a copy of the W9 or IRS letter.')}
                            className="text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2 text-sm border-2 border-red-500"
                            style={{backgroundColor: 'var(--gainwell-teal)'}}
                            onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-dark)'}
                            onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--gainwell-teal)'}
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            Add to Notes
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : currentPageData.id !== 'question-20' && currentPageData.id !== 'questions-21-23' ? (
                    <ul className="space-y-2">
                      {currentPageData.fields
                        .filter(f => {
                          if (!f.required) return false;
                          if (f.showWhen) {
                            return formData[f.showWhen.field] === f.showWhen.value;
                          }
                          return true;
                        })
                        .map(field => {
                          const value = formData[field.name] || (field.type === 'checkbox' ? false : '');
                          const isValid = field.validation ? field.validation(value) : !!value;
                          return (
                            <li key={field.name} className="flex items-start text-sm">
                              <CheckCircle2
                                className={`w-4 h-4 mr-2 mt-0.5 flex-shrink-0 ${
                                  isValid ? 'text-green-500' : 'text-slate-300'
                                }`}
                              />
                              <span className={isValid ? 'text-slate-700' : 'text-slate-400'}>
                                {field.type === 'checkbox' ? (typeof field.label === 'function' ? field.label(formData) : field.label) : `Complete: ${typeof field.label === 'function' ? field.label(formData) : field.label}`}
                              </span>
                            </li>
                          );
                        })}
                    </ul>
                  ) : null}
                </div>
                )}
              </div>

              {/* Navigation */}
              <div className="p-8 bg-slate-50 border-t border-slate-200 flex flex-wrap gap-2 justify-between items-center">
                {(() => {
                  // Check if we should show completion page buttons
                  if (currentPageData.isCompletionPage) {
                    // For additional-providers-check, NEVER show completion buttons
                    // If we reached this page, we enrolled providers, so we'll ALWAYS need to add them to the group
                    if (currentPageData.id === 'additional-providers-check') {
                      return false; // Always show regular navigation (either "Next Provider" or "Add Providers to Group")
                    }
                    // For existing-provider-completion, only show completion buttons if there are no more providers to add
                    if (currentPageData.id === 'existing-provider-completion') {
                      const hasMoreProviders = enrolledProviders.some((p, idx) =>
                        idx > currentAddingProviderIndex &&
                        (p.status === 'Enrolled - Ready to be Added to Group' ||
                         p.status === 'Verified - Ready to Add to Group')
                      );
                      // If there are more providers, show regular navigation instead
                      if (hasMoreProviders) {
                        return false; // Don't show completion buttons
                      }
                    }
                    return true; // Show completion buttons
                  }
                  return false; // Not a completion page
                })() ? (
                  <>
                    {/* Completion Page Buttons */}
                    <button
                      onClick={handleDownloadNotes}
                      className="flex items-center gap-2 px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:shadow-lg hover:scale-105 transition-all"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                      </svg>
                      Download Notes
                    </button>
                    <button
                      onClick={handleStartNewApplication}
                      className="flex items-center gap-2 px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:shadow-lg hover:scale-105 transition-all"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                      </svg>
                      Start New Application
                    </button>
                  </>
                ) : (
                  <>
                    {/* Regular Navigation */}
                    {currentPage === 0 ? (
                      <a
                        href="./index.html"
                        className="flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-semibold text-sm text-slate-700 hover:bg-slate-200 transition-all min-w-[90px]"
                      >
                        <ChevronLeft className="w-4 h-4" />
                        Go to Home
                      </a>
                    ) : (
                      <button
                        onClick={handlePrevious}
                        disabled={
                          (formData.providerEnrollmentType === 'New Provider' && pages[currentPage]?.id === 'create-enrollment') ||
                          (formData.providerEnrollmentType === 'Existing Provider' && pages[currentPage]?.id === 'existing-provider-open-cics')
                        }
                        className={`flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all min-w-[90px] ${
                          (formData.providerEnrollmentType === 'New Provider' && pages[currentPage]?.id === 'create-enrollment') ||
                          (formData.providerEnrollmentType === 'Existing Provider' && pages[currentPage]?.id === 'existing-provider-open-cics')
                            ? 'text-slate-400 cursor-not-allowed bg-slate-100'
                            : 'text-slate-700 hover:bg-slate-200'
                        }`}
                      >
                        <ChevronLeft className="w-4 h-4" />
                        Previous
                      </button>
                    )}

                    <button
                      onClick={() => setShowViewNotesModal(true)}
                      className="relative flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-semibold text-sm text-white transition-all hover:shadow-lg min-w-[120px]"
                      style={{background: '#00e5b4'}}
                    >
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Outreach Notes
                      {outreachNotes.length > 0 && (
                        <span className="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                          {outreachNotes.length}
                        </span>
                      )}
                    </button>

                    {enrolledProviders.length > 0 && (
                      <button
                        onClick={() => setShowEnrolledProvidersModal(true)}
                        className="relative flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-semibold text-sm text-white transition-all hover:shadow-lg min-w-[100px]"
                        style={{background: '#00e5b4'}}
                      >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        Providers
                        <span className="absolute -top-1.5 -right-1.5 bg-blue-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                          {enrolledProviders.length}
                        </span>
                      </button>
                    )}

                    <button
                      onClick={
                        currentPageData.id === 'next-provider-ready-check'
                          ? handleNext
                          : (isLastPage ? handleSubmit : handleNext)
                      }
                      disabled={!canProceed}
                      className={`btn-primary flex items-center justify-center gap-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all text-white hover:shadow-lg hover:scale-105 min-w-[120px] ${
                        canProceed
                          ? ''
                          : 'bg-slate-300 text-slate-500 cursor-not-allowed'
                      }`}
                      style={canProceed ? {background: '#14b8a6'} : {}}
                    >
                      {getNextButtonText()}
                      {!isLastPage && <ChevronRight className="w-4 h-4" />}
                    </button>
                  </>
                )}
              </div>
            </div>
          </div>

          {/* ==================== MODAL COMPONENTS ==================== */}

          {/* Next Steps Modal */}
          {showNextStepsModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowNextStepsModal(false)}
            >
              <div className="relative max-w-4xl" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowNextStepsModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-6 max-h-[80vh] overflow-y-auto">
                  <h2 className="text-2xl font-bold text-indigo-900 mb-4">Next Steps</h2>
                  <img
                    src={paytoMailtoCICSImage}
                    alt="Pay To / Mail To CICS Screen"
                    className="w-full rounded-lg border border-slate-200 mb-4"
                  />
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <p className="text-slate-800 font-medium mb-2">
                      Under the group in CICS, Check if the Pay To Address or Mail To Address is different from what is listed on the application, and update them if necessary.
                    </p>
                    <p className="text-slate-700">
                      From the 02 screen in CICS, hit F5 three times to reach the Pay To and Mail To addresses
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Outreach Notes Modal */}
          {showOutreachModal && (
            <div
              className="modal-overlay"
              onClick={cancelAddOutreachNote}
            >
              <div className="relative max-w-2xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={cancelAddOutreachNote}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-8 shadow-2xl">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-blue-100 rounded-full p-3">
                      <svg className="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                      </svg>
                    </div>
                    <div className="flex-1">
                      <h2 className="text-2xl font-bold text-slate-900 mb-2">Add Outreach Note</h2>
                      <p className="text-slate-600 text-sm">This outreach reason will be added to your notes list.</p>
                    </div>
                  </div>

                  <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                    <p className="text-slate-800 font-medium leading-relaxed">
                      {currentOutreachReason}
                    </p>
                  </div>

                  <div className="flex gap-3 justify-end">
                    <button
                      onClick={cancelAddOutreachNote}
                      className="px-6 py-3 rounded-lg font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={confirmAddOutreachNote}
                      className="px-6 py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transition-all hover:shadow-lg"
                    >
                      Add to Notes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* View Notes Modal */}
          {showViewNotesModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowViewNotesModal(false)}
            >
              <div className="relative max-w-3xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowViewNotesModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-white rounded-xl p-8 shadow-2xl max-h-[80vh] overflow-y-auto">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-amber-100 rounded-full p-3">
                      <svg className="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                    </div>
                    <div className="flex-1">
                      <h2 className="text-3xl font-bold text-slate-900 mb-2">Your Outreach Notes</h2>
                      <p className="text-slate-600">Review and manage your accumulated outreach reasons.</p>
                    </div>
                  </div>

                  {outreachNotes.length === 0 ? (
                    <div className="bg-slate-50 border-2 border-dashed border-slate-300 rounded-lg p-12 text-center">
                      <svg className="w-16 h-16 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      <h3 className="text-xl font-semibold text-slate-700 mb-2">No Notes Yet</h3>
                      <p className="text-slate-500">
                        When you encounter outreach messages, click "Add to Notes" to track them here.
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {outreachNotes.map((note, index) => (
                        <div key={index} className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 flex items-start gap-3 group hover:border-blue-300 transition-all">
                          <div className="flex-shrink-0 mt-1">
                            <div className="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">
                              {index + 1}
                            </div>
                          </div>
                          <p className="flex-1 text-slate-800 font-medium leading-relaxed">
                            {note}
                          </p>
                          <button
                            onClick={() => handleRemoveNote(index)}
                            className="flex-shrink-0 text-red-500 hover:text-red-700 hover:bg-red-100 rounded-lg p-2 transition-all opacity-0 group-hover:opacity-100"
                            title="Remove this note"
                          >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </button>
                        </div>
                      ))}
                    </div>
                  )}

                  <div className="mt-8 flex justify-between items-center">
                    <button
                      onClick={handleDownloadOutreachNotes}
                      className="px-6 py-3 rounded-lg font-semibold text-amber-700 bg-white border-2 border-amber-500 hover:bg-amber-50 transition-all hover:shadow-lg flex items-center gap-2"
                      disabled={outreachNotes.length === 0}
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Export Notes
                    </button>
                    <button
                      onClick={() => setShowViewNotesModal(false)}
                      className="px-8 py-3 rounded-lg font-semibold text-white transition-all hover:shadow-lg"
                      style={{background: '#00e5b4'}}
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Enrolled Providers Modal */}
          {showEnrolledProvidersModal && (
            <div
              className="modal-overlay"
              onClick={() => setShowEnrolledProvidersModal(false)}
            >
              <div className="relative max-w-4xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <button
                  onClick={() => setShowEnrolledProvidersModal(false)}
                  className="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors flex items-center gap-2 text-sm font-medium"
                >
                  <span>Close</span>
                  <X className="w-6 h-6" />
                </button>
                <div className="bg-slate-800 rounded-2xl shadow-2xl max-h-[80vh] overflow-y-auto border border-slate-700">
                  <div className="bg-slate-800 rounded-t-2xl p-6 border-b border-slate-700">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-xl flex items-center justify-center shadow-lg">
                        <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                      </div>
                      <div>
                        <h2 className="text-2xl font-bold text-white">Enrolled Providers</h2>
                        <p className="text-slate-300 mt-1">Review the providers you have successfully enrolled ({enrolledProviders.length} total).</p>
                      </div>
                    </div>
                  </div>

                  <div className="p-8 space-y-4">
                    {enrolledProviders.map((provider, index) => (
                      <div key={index} className={`rounded-2xl shadow-sm border-2 overflow-hidden transition-all duration-200 ${
                        index === currentEnrollingProviderIndex
                          ? 'border-blue-400 bg-blue-950/40'
                          : index === currentAddingProviderIndex
                          ? 'border-purple-400 bg-purple-950/40'
                          : 'border-emerald-400 bg-emerald-950/40'
                      }`}>
                        {/* Provider Header */}
                        <div className="p-6 border-b border-slate-700/50">
                          <div className="flex items-start justify-between">
                            <div className="flex items-center gap-4">
                              <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-md ${
                                index === currentEnrollingProviderIndex
                                  ? 'bg-gradient-to-br from-blue-500 to-blue-600'
                                  : index === currentAddingProviderIndex
                                  ? 'bg-gradient-to-br from-purple-500 to-purple-600'
                                  : 'bg-gradient-to-br from-emerald-500 to-teal-600'
                              }`}>
                                {index + 1}
                              </div>
                              <div>
                                <h2 className="text-xl font-bold text-white">Provider {index + 1}</h2>
                                {index === currentEnrollingProviderIndex && (
                                  <span className="text-sm text-blue-400 font-medium">(Currently Enrolling)</span>
                                )}
                                {index === currentAddingProviderIndex && (
                                  <span className="text-sm text-purple-400 font-medium">(Currently Being Added to Group)</span>
                                )}
                              </div>
                            </div>
                            <span className={`px-4 py-2 rounded-full text-sm font-semibold shadow-sm ${
                              provider.status === 'Complete - Enrolled and Added to Group'
                                ? 'bg-emerald-500 text-white'
                                : provider.status === 'Enrolled - Ready to be Added to Group'
                                ? 'bg-emerald-500 text-white'
                                : provider.status === 'Verified - Ready to Enroll'
                                ? 'bg-blue-500 text-white'
                                : provider.status === 'Verified - Ready to Add to Group'
                                ? 'bg-indigo-500 text-white'
                                : provider.status === 'Verified - Already in the Group'
                                ? 'bg-gray-500 text-white'
                                : 'bg-yellow-500 text-white'
                            }`}>
                              {provider.status || 'Verified - Ready to Enroll'}
                            </span>
                          </div>
                        </div>

                        {/* Status Grid */}
                        <div className="p-6">
                          {((provider.status === 'Verified - Ready to Add to Group' || provider.status === 'Verified - Already in the Group') ||
                            (provider.status === 'Enrolled - Ready to be Added to Group' && !provider.createEnrollmentComplete && !provider.npiTabComplete)) ? (
                            <div className="p-4 bg-indigo-500/30 border-2 border-indigo-400/60 rounded-xl">
                              <div className="flex items-center gap-2">
                                <svg className="w-5 h-5 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span className="text-sm font-semibold text-white">
                                {provider.status === 'Verified - Already in the Group'
                                  ? 'Provider is already enrolled and in the group'
                                  : 'Enrollment Details: Existing Provider'}
                              </span>
                            </div>
                          </div>
                        ) : (
                          <>
                            <div className="grid grid-cols-2 gap-3">
                              <div className={`flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all duration-200 hover:shadow-md ${
                                provider.createEnrollmentComplete
                                  ? 'bg-emerald-500/30 border-emerald-400/60 text-white font-bold'
                                  : 'bg-rose-500/30 border-rose-400/60 text-white font-bold'
                              }`}>
                                <div className={provider.createEnrollmentComplete ? 'text-emerald-400' : 'text-rose-400'}>
                                  {provider.createEnrollmentComplete ? (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                    </svg>
                                  ) : (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                                    </svg>
                                  )}
                                </div>
                                <span>{provider.createEnrollmentComplete ? 'Yes' : 'No'}</span>
                              </div>
                              <div className={`flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all duration-200 hover:shadow-md ${
                                provider.providerInfoComplete
                                  ? 'bg-emerald-500/30 border-emerald-400/60 text-white font-bold'
                                  : 'bg-amber-500/30 border-amber-400/60 text-white font-bold'
                              }`}>
                                <div className={provider.providerInfoComplete ? 'text-emerald-400' : 'text-amber-400'}>
                                  {provider.providerInfoComplete ? (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                    </svg>
                                  ) : (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                    </svg>
                                  )}
                                </div>
                                <span>{provider.providerInfoComplete ? 'Complete' : 'Incomplete'}</span>
                              </div>
                              <div className={`flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all duration-200 hover:shadow-md ${
                                provider.groupSpecialtiesChecked
                                  ? 'bg-emerald-500/30 border-emerald-400/60 text-white font-bold'
                                  : 'bg-rose-500/30 border-rose-400/60 text-white font-bold'
                              }`}>
                                <div className={provider.groupSpecialtiesChecked ? 'text-emerald-400' : 'text-rose-400'}>
                                  {provider.groupSpecialtiesChecked ? (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                    </svg>
                                  ) : (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                                    </svg>
                                  )}
                                </div>
                                <span>{provider.groupSpecialtiesChecked ? 'Verified' : 'Not Verified'}</span>
                              </div>
                              <div className={`flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all duration-200 hover:shadow-md ${
                                provider.enrollOnMainframeComplete
                                  ? 'bg-emerald-500/30 border-emerald-400/60 text-white font-bold'
                                  : 'bg-amber-500/30 border-amber-400/60 text-white font-bold'
                              }`}>
                                <div className={provider.enrollOnMainframeComplete ? 'text-emerald-400' : 'text-amber-400'}>
                                  {provider.enrollOnMainframeComplete ? (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                    </svg>
                                  ) : (
                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                    </svg>
                                  )}
                                </div>
                                <span>{provider.enrollOnMainframeComplete ? 'Complete' : 'Incomplete'}</span>
                              </div>
                            </div>

                            {/* View Details Toggle */}
                            <button
                              onClick={() => setExpandedProvider(expandedProvider === index ? null : index)}
                              className="mt-4 flex items-center gap-2 text-teal-400 hover:text-teal-300 font-semibold transition-colors"
                            >
                              {expandedProvider === index ? (
                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
                                </svg>
                              )}
                              View All Details
                            </button>

                            {/* Expanded Details */}
                            {expandedProvider === index && (
                              <div className="mt-4 p-4 bg-slate-900/50 rounded-xl border border-slate-700">
                                <div className="space-y-2 text-sm text-slate-200">
                                  <div>â€¢ Enrollment Tab: <span className={provider.enrollmentTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.enrollmentTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Provider Name: <span className={provider.providerNameCorrect ? 'text-emerald-400' : 'text-rose-400'}>{provider.providerNameCorrect ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Provider Type: <span className={provider.providerTypeCorrect ? 'text-emerald-400' : 'text-rose-400'}>{provider.providerTypeCorrect ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Application Date: <span className={provider.applicationDateAdded ? 'text-emerald-400' : 'text-rose-400'}>{provider.applicationDateAdded ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Cancel Reason Code: <span className={provider.cancelReasonCode ? 'text-emerald-400' : 'text-rose-400'}>{provider.cancelReasonCode ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Provider Address: <span className={provider.providerAddressComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.providerAddressComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Payment/Mailing Address: <span className={provider.paymentMailingAddressComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.paymentMailingAddressComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Provider Info Tab: <span className={provider.providerInfoTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.providerInfoTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ NPI Tab: <span className={provider.npiTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.npiTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Specialty Tab: <span className={provider.specialtyTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.specialtyTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ Claim Type Tab: <span className={provider.claimTypeTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.claimTypeTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                  <div>â€¢ License/DEA Tab: <span className={provider.licenseDeaTabComplete ? 'text-emerald-400' : 'text-rose-400'}>{provider.licenseDeaTabComplete ? 'âœ“' : 'âœ—'}</span></div>
                                </div>
                              </div>
                            )}
                          </>
                        )}
                        </div>

                        {/* Manual Notes */}
                        <div className="bg-slate-800 p-6 border-t border-slate-700">
                          <div className="flex items-center gap-2 mb-3">
                            <svg className="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            <h3 className="font-bold text-white">Manual Notes</h3>
                          </div>
                          <textarea
                            id={`manual-note-${index}`}
                            value={providerManualNotes[index] || ''}
                            onChange={(e) => handleProviderManualNoteChange(index, e.target.value)}
                            placeholder="Add any additional notes about this provider..."
                            className="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all resize-none"
                            rows="3"
                          />
                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="p-6 border-t border-slate-700 flex justify-between items-center">
                    <button
                      onClick={handleDownloadEnrolledProviders}
                      className="px-6 py-3 rounded-lg font-semibold text-white bg-slate-700 border-2 border-slate-600 hover:bg-slate-600 transition-all hover:shadow-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                      disabled={enrolledProviders.length === 0}
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Export Providers
                    </button>
                    <button
                      onClick={() => setShowEnrolledProvidersModal(false)}
                      className="px-8 py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 transition-all hover:shadow-lg"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Custom Confirmation Dialog */}
          {confirmDialog.show && (
            <div
              className="modal-overlay"
              onClick={confirmDialog.onCancel}
            >
              <div className="relative max-w-md w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <div className="bg-slate-800 text-white rounded-xl p-6 shadow-2xl border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">This page says</h3>
                  <p className="text-slate-200 mb-6 whitespace-pre-line leading-relaxed">{confirmDialog.message}</p>
                  <div className="flex gap-3 justify-end">
                    <button
                      onClick={confirmDialog.onCancel}
                      className="px-6 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors font-medium"
                    >
                      No
                    </button>
                    <button
                      onClick={confirmDialog.onConfirm}
                      className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors font-medium"
                      autoFocus
                    >
                      Yes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Custom Alert Dialog */}
          {alertDialog.show && (
            <div
              className="modal-overlay"
              onClick={alertDialog.onClose}
            >
              <div className="relative max-w-md w-full mx-4" onClick={(e) => e.stopPropagation()}>
                <div className="bg-slate-800 text-white rounded-xl p-6 shadow-2xl border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">This page says</h3>
                  <p className="text-slate-200 mb-6 whitespace-pre-line leading-relaxed">{alertDialog.message}</p>
                  <div className="flex justify-end">
                    <button
                      onClick={alertDialog.onClose}
                      className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors font-medium"
                      autoFocus
                    >
                      OK
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ============================================================
    // APPLICATION INITIALIZATION
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WalkthroughForm />);
  </script>
</body>
</html>
